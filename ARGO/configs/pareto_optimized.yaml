# Pareto实验优化配置
# ==========================================
# 设计目标：
# 1. 平衡的成本参数，避免策略急剧转换
# 2. 合理的效率比，让检索和推理各有优势
# 3. 适中的成功率，增加不确定性
#
# 理论分析：
#   检索效率 = p_s × delta_r / c_r = 0.7 × 0.20 / 0.08 = 1.75
#   推理效率 = delta_p / c_p = 0.05 / 0.02 = 2.50
#   推理略优，但检索信息增益更大
#   这样MDP会在中间找到平衡点

gpu:
  n_gpus: 8
  max_memory_per_gpu: 10
  default_gpu_ids: [4, 5, 6, 7]
  default_mode: "auto"

models:
  small:
    models:
      - "Qwen/Qwen2.5-1.5B-Instruct"
      - "Qwen/Qwen2.5-3B-Instruct"
    recommended_mode: "single"
    n_gpus_needed: 1

mdp:
  # 状态空间
  U_max: 1.0
  
  # ========================================
  # 优化后的状态转移参数
  # ========================================
  # 设计原则：
  # - delta_r > delta_p：检索带来更多信息
  # - 但考虑p_s后，期望增益接近
  #
  delta_r: 0.20       # 检索进度增量 (成功时)
  delta_p: 0.05       # 推理进度增量
  
  # 检索成功率 - 降低以增加不确定性
  p_s: 0.70           # 检索成功概率
  
  # ========================================
  # 优化后的成本参数
  # ========================================
  # 设计原则：
  # - c_r/c_p = 4.0 (检索成本是推理的4倍)
  # - 这样在μ变化时会有平滑的策略过渡
  #
  c_r: 0.08           # 检索成本
  c_p: 0.02           # 推理成本
  
  # ========================================
  # 效率分析
  # ========================================
  # 检索效率 = E[delta_r] / c_r = 0.7 × 0.20 / 0.08 = 1.75
  # 推理效率 = delta_p / c_p = 0.05 / 0.02 = 2.50
  # 
  # 推理成本效率略高，但：
  # - 检索单次信息增益更大 (0.20 vs 0.05)
  # - 检索带来真实文档context
  #
  # 预期行为：
  # - 低μ: 偏好检索 (追求高质量)
  # - 中μ: 混合策略
  # - 高μ: 偏好推理 (节省成本)
  
  # MDP求解参数
  mu: 0.5             # 默认值 (实验时会扫描)
  gamma: 0.98         # 折扣因子
  grid_size: 101      # U的离散化粒度
  
  # 质量函数
  quality_function: "linear"
  quality_k: 1.0
  
  # Reward Shaping
  reward_shaping:
    enabled: false
    k: 1.0

inference:
  batch_size: 4
  generation:
    max_new_tokens: 10
    temperature: 0.1
    do_sample: false
  dtype: "float16"

output:
  results_dir: "results/pareto_optimized"
  save_full_results: true
  verbose: true
