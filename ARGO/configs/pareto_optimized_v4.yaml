# Pareto实验优化配置 V4 - 正确校准的参数
# ==========================================
# 目标：实现正确的平滑Pareto边界
#
# 核心设计原则：
# 1. 低μ (质量优先): 检索提供更多信息增益 → 优先检索
# 2. 高μ (成本敏感): 推理成本更低 → 优先推理
# 3. 中间μ: 平滑过渡
#
# 数学推导：
# 策略选择取决于 "净价值" = 进度增益 - μ × 成本
# 
# 检索净价值 = E[delta_r] - μ × c_r = p_s × delta_r - μ × c_r
# 推理净价值 = delta_p - μ × c_p
#
# 交叉点 μ* = (p_s × delta_r - delta_p) / (c_r - c_p)
#
# 设计参数使 μ* ≈ 0.5 (在扫描范围中间)
# ==========================================

gpu:
  n_gpus: 8
  max_memory_per_gpu: 10
  default_gpu_ids: [4, 5, 6, 7]
  default_mode: "auto"

models:
  small:
    models:
      - "Qwen/Qwen2.5-1.5B-Instruct"
      - "Qwen/Qwen2.5-3B-Instruct"
    recommended_mode: "single"
    n_gpus_needed: 1

mdp:
  # 状态空间
  U_max: 1.0
  
  # ========================================
  # 校准参数 - 确保 μ* ≈ 0.5
  # ========================================
  # 
  # 检索参数: 高进度增益，但成本也高
  delta_r: 0.20       # 检索进度增量
  p_s: 0.75           # 检索成功概率
  c_r: 0.25           # 检索成本 (关键：必须 > c_p)
  
  # 推理参数: 低进度增益，但成本低
  delta_p: 0.06       # 推理进度增量
  c_p: 0.08           # 推理成本
  
  # ========================================
  # 效率与交叉点分析
  # ========================================
  # 
  # 预期进度:
  #   E[delta_r] = p_s × delta_r = 0.75 × 0.20 = 0.15
  #   delta_p = 0.06
  #   检索提供 2.5x 的信息增益
  #
  # 成本:
  #   c_r = 0.25
  #   c_p = 0.08
  #   c_r/c_p = 3.125 (检索贵3倍)
  #
  # 交叉点:
  #   μ* = (0.15 - 0.06) / (0.25 - 0.08) = 0.09 / 0.17 ≈ 0.53
  #
  # 预期行为:
  #   μ=0.0: 检索价值=0.15, 推理价值=0.06 → 检索优先
  #   μ=0.5: 检索价值=0.025, 推理价值=0.02 → 接近
  #   μ=1.0: 检索价值=-0.10, 推理价值=-0.02 → 推理优先
  #
  # ========================================
  # 验证:
  # - 低μ时θ_cont应该高 (多检索)
  # - 高μ时θ_cont应该低 (少检索)
  # - 单调递减
  # ========================================
  
  # MDP求解参数
  mu: 0.5             # 默认值 (实验时会扫描)
  gamma: 0.98         # 折扣因子
  grid_size: 101      # U的离散化粒度
  
  # 质量函数
  quality_function: "linear"
  quality_k: 1.0
  
  # Reward Shaping
  reward_shaping:
    enabled: false
    k: 1.0

inference:
  batch_size: 4
  generation:
    max_new_tokens: 10
    temperature: 0.1
    do_sample: false
  dtype: "float16"

output:
  results_dir: "results/pareto_optimized_v4"
  save_full_results: true
  verbose: true
