# Pareto实验优化配置 V5 - 效率平衡设计
# ==========================================
# 目标：实现真正平滑的Pareto边界
#
# 核心洞察：
# 之前的配置导致二元崩溃是因为效率差异太大。
# 当一种动作明显更高效时，MDP会在临界μ值突然切换。
#
# 解决方案：
# 让检索和推理的效率接近，使得μ的变化能够
# 逐渐影响策略选择，而不是突然切换。
#
# 设计原则：
# 1. 效率接近但不相等：检索效率 ≈ 推理效率
# 2. 检索：高进度高成本
# 3. 推理：低进度低成本
# 4. 检索有不确定性 (p_s < 1)
# ==========================================

gpu:
  n_gpus: 8
  max_memory_per_gpu: 10
  default_gpu_ids: [4, 5, 6, 7]
  default_mode: "auto"

models:
  small:
    models:
      - "Qwen/Qwen2.5-1.5B-Instruct"
      - "Qwen/Qwen2.5-3B-Instruct"
    recommended_mode: "single"
    n_gpus_needed: 1

mdp:
  # 状态空间
  U_max: 1.0
  
  # ========================================
  # 平衡效率设计
  # ========================================
  # 
  # 检索参数: 
  delta_r: 0.12       # 检索进度增量
  p_s: 0.80           # 检索成功概率
  c_r: 0.10           # 检索成本
  # E[delta_r] = 0.80 × 0.12 = 0.096
  # 检索效率 = 0.096 / 0.10 = 0.96
  
  # 推理参数:
  delta_p: 0.08       # 推理进度增量
  c_p: 0.08           # 推理成本
  # 推理效率 = 0.08 / 0.08 = 1.0
  
  # ========================================
  # 分析
  # ========================================
  # 效率比 = 0.96 / 1.0 = 0.96 (非常接近!)
  #
  # 这意味着:
  # - 两种动作的"性价比"几乎相同
  # - μ的变化会逐渐改变偏好
  #
  # 检索净值 = 0.096 - μ × 0.10 = 0.096 - 0.10μ
  # 推理净值 = 0.08 - μ × 0.08 = 0.08 - 0.08μ
  #
  # 交叉点: 0.096 - 0.10μ = 0.08 - 0.08μ
  #         0.016 = 0.02μ
  #         μ = 0.8
  #
  # 但由于不确定性和折扣因子，实际交叉会更复杂
  # ========================================
  
  # MDP求解参数
  mu: 0.5             # 默认值 (实验时会扫描)
  gamma: 0.98         # 折扣因子
  grid_size: 101      # U的离散化粒度
  
  # 质量函数
  quality_function: "linear"
  quality_k: 1.0
  
  # Reward Shaping
  reward_shaping:
    enabled: false
    k: 1.0

inference:
  batch_size: 4
  generation:
    max_new_tokens: 10
    temperature: 0.1
    do_sample: false
  dtype: "float16"

output:
  results_dir: "results/pareto_optimized_v5"
  save_full_results: true
  verbose: true
