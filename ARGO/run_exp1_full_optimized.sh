#!/bin/bash

###############################################################################
# 实验1: 多种子统计学有效实验 (推荐版)
# 
# 修正内容:
#   ✓ 多个随机种子 (5个) - 确保统计显著性
#   ✓ 多个难度级别 (Easy/Medium/Hard) - 展示泛化能力
#   ✓ 合理样本量 (100题/难度) - 平衡效率与精度
#   ✓ 预计算embeddings - 优化性能
#
# 预计运行时间: 10-12小时 (8 GPUs)
# 
# 对比旧版:
#   - 旧版: 12K题 × 1种子 × 1难度 = 20+小时, 无统计意义
#   - 新版: 100题 × 5种子 × 3难度 = 10-12小时, 发表级别
###############################################################################

echo "================================================================================"
echo "实验1: 检索成本影响 - 多种子统计学有效实验"
echo "================================================================================"
echo "配置:"
echo "  - 随机种子: 5个 (42-46)"
echo "  - 难度级别: Easy, Medium, Hard"
echo "  - 每难度问题数: 100"
echo "  - 总运行次数: 15 (5种子 × 3难度)"
echo "  - GPU: 8张 (0-7)"
echo "================================================================================"
echo "开始时间: $(date)"
echo ""

# 使用所有8张GPU
export CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7
export PYTHONUNBUFFERED=1

# 切换到工作目录
cd /data/user/huangxiaolin/ARGO2/ARGO

# 运行多种子实验
echo "运行多种子实验..."
echo ""

python -u Exp1_multi_seed_wrapper.py \
    --n-seeds 5 \
    --base-seed 42 \
    --n-questions 100 \
    --difficulties easy,medium,hard \
    --gpus 0,1,2,3,4,5,6,7

# 检查是否成功
if [ $? -ne 0 ]; then
    echo ""
    echo "❌ 实验失败!"
    exit 1
fi

echo ""
echo "================================================================================"
echo "✓ 实验完成!"
echo "================================================================================"
echo "结束时间: $(date)"
echo ""
echo "下一步:"
echo "  1. 聚合结果并生成统计分析:"
echo "     python Exp1_aggregate_and_analyze.py"
echo ""
echo "  2. 生成图表:"
echo "     python Exp1_plots.py draw_figs/data/exp1_aggregated_XXXXXX.csv"
echo ""
echo "================================================================================"
