# ç»Ÿä¸€ç­–ç•¥æ¡†æ¶éªŒè¯æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-09  
**æ–‡ä»¶**: `Exp_3B_quick_validation.py`  
**çŠ¶æ€**: âœ… å·²ä¿®å¤å¹¶éªŒè¯

---

## é—®é¢˜è¯Šæ–­

### åŸå§‹é—®é¢˜
ç”¨æˆ·æŒ‡å‡ºï¼š**æ‰€æœ‰å¯¹æ¯”å®éªŒçš„æµç¨‹åº”è¯¥ä¸€æ ·**ï¼Œåªæœ‰å†³å®šåŠ¨ä½œçš„æ–¹å¼ä¸åŒã€‚

### ä¹‹å‰çš„é”™è¯¯å®ç°

```
âŒ é”™è¯¯çš„å®ç°æ–¹å¼:
â”œâ”€â”€ ARGOç­–ç•¥: âœ… å®Œæ•´æµç¨‹
â”‚   â”œâ”€â”€ Decomposer â†’ åŠ¨ä½œé€‰æ‹©(MDP) â†’ ç”Ÿæˆå­ç­”æ¡ˆ â†’ ç»´æŠ¤å†å² â†’ Synthesizer
â”‚
â”œâ”€â”€ Always-Retrieve: âŒ ç®€åŒ–æµç¨‹ï¼ˆé”™è¯¯ï¼‰
â”‚   â””â”€â”€ ç›´æ¥å¯¹åŸå§‹é—®é¢˜é‡å¤æ£€ç´¢ â†’ æ— å†å² â†’ æ— synthesize
â”‚
â”œâ”€â”€ Always-Reason: âŒ ç®€åŒ–æµç¨‹ï¼ˆé”™è¯¯ï¼‰
â”‚   â””â”€â”€ ç›´æ¥å¯¹åŸå§‹é—®é¢˜é‡å¤æ¨ç† â†’ æ— å†å² â†’ æ— synthesize
â”‚
â””â”€â”€ Random: âŒ ç®€åŒ–æµç¨‹ï¼ˆé”™è¯¯ï¼‰
    â””â”€â”€ ç›´æ¥å¯¹åŸå§‹é—®é¢˜éšæœºåŠ¨ä½œ â†’ æ— å†å² â†’ æ— synthesize
```

**é—®é¢˜**: åŸºçº¿ç­–ç•¥æ²¡æœ‰ä½¿ç”¨ Decomposer å’Œ Synthesizerï¼Œå¯¼è‡´ä¸å…¬å¹³å¯¹æ¯”ï¼

---

## ä¿®å¤æ–¹æ¡ˆ

### ç»Ÿä¸€çš„ç­–ç•¥æ¡†æ¶

æ‰€æœ‰ç­–ç•¥ç°åœ¨éƒ½éµå¾ªç›¸åŒçš„5æ­¥æµç¨‹ï¼š

```
âœ… ç»Ÿä¸€çš„ç­–ç•¥æ¡†æ¶:

æ‰€æœ‰ç­–ç•¥ (ARGO, Always-Retrieve, Always-Reason, Random)
â”‚
â”œâ”€â”€ æ­¥éª¤1: Decomposer
â”‚   â””â”€â”€ decompose_query(original_question, history, U_t, step)
â”‚       â†’ ç”Ÿæˆå­æŸ¥è¯¢ q_t
â”‚
â”œâ”€â”€ æ­¥éª¤2: åŠ¨ä½œé€‰æ‹© (å”¯ä¸€ä¸åŒçš„éƒ¨åˆ†!)
â”‚   â”œâ”€â”€ ARGO:            æ ¹æ® U_t ä¸ Î¸_cont æ¯”è¾ƒå†³å®š
â”‚   â”œâ”€â”€ Always-Retrieve: å›ºå®šé€‰æ‹© a_t = 0 (Retrieve)
â”‚   â”œâ”€â”€ Always-Reason:   å›ºå®šé€‰æ‹© a_t = 1 (Reason)
â”‚   â””â”€â”€ Random:          éšæœºé€‰æ‹© (50% Retrieve, 50% Reason)
â”‚
â”œâ”€â”€ æ­¥éª¤3: æ‰§è¡ŒåŠ¨ä½œ â†’ ç”Ÿæˆå­ç­”æ¡ˆ r_t
â”‚   â”œâ”€â”€ Retrieve: æ£€ç´¢æ–‡æ¡£ â†’ generate_answer(context, is_retrieval=True)
â”‚   â””â”€â”€ Reason:   çº¯æ¨ç† â†’ generate_answer(context="", is_retrieval=False)
â”‚
â”œâ”€â”€ æ­¥éª¤4: ç»´æŠ¤å†å²
â”‚   â””â”€â”€ history.append((q_t, r_t))
â”‚       H_t = {(q_1, r_1), ..., (q_t, r_t)}
â”‚
â”œâ”€â”€ æ­¥éª¤5: åˆ¤æ–­ç»ˆæ­¢æ¡ä»¶
â”‚   â””â”€â”€ if U_t >= Î¸*: break
â”‚
â””â”€â”€ æ­¥éª¤6: Synthesizer (å¾ªç¯ç»“æŸå)
    â””â”€â”€ synthesize_answer(original_question, history)
        â†’ æœ€ç»ˆç­”æ¡ˆ O
```

---

## ä»£ç éªŒè¯

### è‡ªåŠ¨åŒ–æ£€æŸ¥ç»“æœ

```
================================================================================
éªŒè¯æ‰€æœ‰ç­–ç•¥æ˜¯å¦éµå¾ªç»Ÿä¸€æµç¨‹
================================================================================

ã€ARGOã€‘
  âœ… 1ï¸âƒ£ Decomposer (decompose_query)
  âœ… 2ï¸âƒ£ åŠ¨ä½œé€‰æ‹© (retrieve/reason)
  âœ… 3ï¸âƒ£ ç»´æŠ¤å†å² (history.append)
  âœ… 4ï¸âƒ£ Synthesizer (synthesize_answer)
  âœ… 5ï¸âƒ£ è¿”å›history_length
  ğŸ‰ ARGOç­–ç•¥éµå¾ªç»Ÿä¸€æµç¨‹!

ã€Always-Retrieveã€‘
  âœ… 1ï¸âƒ£ Decomposer (decompose_query)
  âœ… 2ï¸âƒ£ åŠ¨ä½œé€‰æ‹© (retrieve/reason)
  âœ… 3ï¸âƒ£ ç»´æŠ¤å†å² (history.append)
  âœ… 4ï¸âƒ£ Synthesizer (synthesize_answer)
  âœ… 5ï¸âƒ£ è¿”å›history_length
  ğŸ‰ Always-Retrieveç­–ç•¥éµå¾ªç»Ÿä¸€æµç¨‹!

ã€Always-Reasonã€‘
  âœ… 1ï¸âƒ£ Decomposer (decompose_query)
  âœ… 2ï¸âƒ£ åŠ¨ä½œé€‰æ‹© (retrieve/reason)
  âœ… 3ï¸âƒ£ ç»´æŠ¤å†å² (history.append)
  âœ… 4ï¸âƒ£ Synthesizer (synthesize_answer)
  âœ… 5ï¸âƒ£ è¿”å›history_length
  ğŸ‰ Always-Reasonç­–ç•¥éµå¾ªç»Ÿä¸€æµç¨‹!

ã€Randomã€‘
  âœ… 1ï¸âƒ£ Decomposer (decompose_query)
  âœ… 2ï¸âƒ£ åŠ¨ä½œé€‰æ‹© (retrieve/reason)
  âœ… 3ï¸âƒ£ ç»´æŠ¤å†å² (history.append)
  âœ… 4ï¸âƒ£ Synthesizer (synthesize_answer)
  âœ… 5ï¸âƒ£ è¿”å›history_length
  ğŸ‰ Randomç­–ç•¥éµå¾ªç»Ÿä¸€æµç¨‹!

================================================================================
æµç¨‹ç»Ÿä¸€æ€§æ£€æŸ¥å®Œæˆ! âœ… æ‰€æœ‰ç­–ç•¥å·²ç»Ÿä¸€
================================================================================
```

---

## å…³é”®ä¿®æ”¹

### 1. `simulate_always_retrieve_policy` ä¿®å¤

**ä¿®æ”¹å‰**:
```python
def simulate_always_retrieve_policy(...):
    for step in range(max_steps):
        # âŒ ç›´æ¥å¯¹åŸå§‹é—®é¢˜æ£€ç´¢
        docs = self.retrieve_documents(question['question'], ...)
        final_answer, _ = self.generate_answer(question, context, ...)
    # âŒ æ²¡æœ‰ decompose å’Œ synthesize
    return {'correct': correct, ...}
```

**ä¿®æ”¹å**:
```python
def simulate_always_retrieve_policy(...):
    history = []  # âœ… ç»´æŠ¤å†å²
    
    for step in range(max_steps):
        # âœ… Decomposer: ç”Ÿæˆå­æŸ¥è¯¢
        sub_query = self.decompose_query(question['question'], history, U, step)
        
        # âœ… å›ºå®šç­–ç•¥: æ€»æ˜¯æ£€ç´¢
        docs = self.retrieve_documents(sub_query, ...)
        sub_answer, _ = self.generate_answer({'question': sub_query, ...}, context, ...)
        
        # âœ… æ›´æ–°å†å²
        history.append((sub_query, sub_answer))
    
    # âœ… Synthesizer: ç»¼åˆç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
    final_answer = self.synthesize_answer(question['question'], history)
    
    return {'correct': correct, 'history_length': len(history), ...}
```

### 2. `simulate_always_reason_policy` ä¿®å¤

åŒæ ·çš„ä¿®å¤æ¨¡å¼ï¼š
- âœ… æ·»åŠ  `decompose_query`
- âœ… ç»´æŠ¤ `history`
- âœ… æ·»åŠ  `synthesize_answer`
- âœ… è¿”å› `history_length`

### 3. `simulate_random_policy` ä¿®å¤

åŒæ ·çš„ä¿®å¤æ¨¡å¼ï¼š
- âœ… æ·»åŠ  `decompose_query`
- âœ… ç»´æŠ¤ `history`
- âœ… æ·»åŠ  `synthesize_answer`
- âœ… è¿”å› `history_length`

---

## ç†è®ºæ„ä¹‰

### ä¸ºä»€ä¹ˆç»Ÿä¸€æ¡†æ¶å¾ˆé‡è¦ï¼Ÿ

1. **å…¬å¹³æ€§**: æ‰€æœ‰ç­–ç•¥ä½¿ç”¨ç›¸åŒçš„é—®é¢˜åˆ†è§£å’Œç­”æ¡ˆç»¼åˆèƒ½åŠ›
2. **å¯æ¯”æ€§**: å”¯ä¸€å˜é‡æ˜¯åŠ¨ä½œé€‰æ‹©ç­–ç•¥ï¼Œå…¶ä»–æ¡ä»¶å®Œå…¨ä¸€è‡´
3. **ç†è®ºä¸€è‡´æ€§**: ç¬¦åˆè®ºæ–‡ä¸­çš„å½¢å¼åŒ–å®šä¹‰
   - Decomposer: $q_t = D(Q, H_t, U_t)$
   - Action: $a_t = \pi(U_t, \theta_{\text{cont}})$
   - Synthesizer: $O = S(Q, H_T)$

### ä¿®å¤å‰åçš„å½±å“

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **Decomposer** | ä»…ARGOä½¿ç”¨ | **æ‰€æœ‰ç­–ç•¥ä½¿ç”¨** |
| **å†å²ç»´æŠ¤** | ä»…ARGOç»´æŠ¤ | **æ‰€æœ‰ç­–ç•¥ç»´æŠ¤** |
| **Synthesizer** | ä»…ARGOä½¿ç”¨ | **æ‰€æœ‰ç­–ç•¥ä½¿ç”¨** |
| **å¯¹æ¯”å…¬å¹³æ€§** | âŒ ä¸å…¬å¹³ | âœ… å…¬å¹³ |
| **ç†è®ºä¸€è‡´æ€§** | âŒ ä¸ä¸€è‡´ | âœ… ä¸€è‡´ |

**é¢„æœŸå½±å“**:
- Always-Retrieve/Reason/Randomçš„**å‡†ç¡®ç‡å¯èƒ½æå‡**ï¼ˆå› ä¸ºæœ‰äº†Decomposerå’ŒSynthesizerï¼‰
- ARGOçš„**ç›¸å¯¹ä¼˜åŠ¿å¯èƒ½å‡å°**ï¼ˆåŸºçº¿å˜å¼ºäº†ï¼‰
- ä½†**è¿™æ‰æ˜¯å…¬å¹³çš„å¯¹æ¯”**ï¼

---

## å®éªŒå»ºè®®

### éœ€è¦é‡æ–°è¿è¡Œå®éªŒ

ç”±äºæ¡†æ¶ä¿®å¤ï¼Œå»ºè®®ï¼š

1. âœ… **é‡æ–°è¿è¡Œå®éªŒ**: ä½¿ç”¨ä¿®å¤åçš„ä»£ç 
2. âœ… **ä¿ç•™æ—§ç»“æœ**: ä½œä¸ºå¯¹æ¯”ï¼ˆæ”¾åœ¨é™„å½•ä¸­è¯´æ˜ä¿®å¤å‰åå·®å¼‚ï¼‰
3. âœ… **åœ¨è®ºæ–‡ä¸­å¼ºè°ƒ**: æ‰€æœ‰ç­–ç•¥ä½¿ç”¨ç»Ÿä¸€æ¡†æ¶ï¼Œç¡®ä¿å…¬å¹³å¯¹æ¯”

### é¢„æœŸç»“æœå˜åŒ–

| ç­–ç•¥ | ä¿®å¤å‰é¢„æœŸ | ä¿®å¤åé¢„æœŸ | å˜åŒ–åŸå›  |
|------|-----------|-----------|---------|
| **ARGO** | Acc: 68% | Acc: 65-70% | åŸºçº¿å˜å¼ºï¼Œç›¸å¯¹ä¼˜åŠ¿å¯èƒ½å‡å° |
| **Always-Retrieve** | Acc: 60% | Acc: 65-70% | å¢åŠ Decomposer+Synthesizer |
| **Always-Reason** | Acc: 55% | Acc: 60-65% | å¢åŠ Decomposer+Synthesizer |
| **Random** | Acc: 58% | Acc: 62-68% | å¢åŠ Decomposer+Synthesizer |

**é‡è¦**: å³ä½¿ç›¸å¯¹å·®è·ç¼©å°ï¼ŒARGOçš„**åŠ¨æ€è‡ªé€‚åº”èƒ½åŠ›**ï¼ˆæ ¹æ®æˆæœ¬è°ƒæ•´ç­–ç•¥ï¼‰ä»ç„¶æ˜¯æ ¸å¿ƒä¼˜åŠ¿ï¼

---

## æ€»ç»“

### âœ… ä¿®å¤å®Œæˆ

- **é—®é¢˜**: åŸºçº¿ç­–ç•¥æœªä½¿ç”¨ç»Ÿä¸€æ¡†æ¶
- **ä¿®å¤**: æ‰€æœ‰ç­–ç•¥ç°åœ¨éƒ½éµå¾ª 5 æ­¥ç»Ÿä¸€æµç¨‹
- **éªŒè¯**: è‡ªåŠ¨åŒ–æ£€æŸ¥é€šè¿‡ âœ…

### ğŸ¯ å…³é”®æ”¹è¿›

1. **Decomposer**: æ‰€æœ‰ç­–ç•¥éƒ½ä¼šåˆ†è§£å­æŸ¥è¯¢
2. **å†å²ç»´æŠ¤**: æ‰€æœ‰ç­–ç•¥éƒ½ä¼šè®°å½• H_t = {(q_1, r_1), ..., (q_t, r_t)}
3. **Synthesizer**: æ‰€æœ‰ç­–ç•¥éƒ½ä¼šç»¼åˆå†å²ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ
4. **å”¯ä¸€å·®å¼‚**: åŠ¨ä½œé€‰æ‹©æ–¹å¼ï¼ˆMDP vs å›ºå®š vs éšæœºï¼‰

### ğŸ“Š ä¸‹ä¸€æ­¥

- âœ… ä»£ç å·²ä¿®å¤å¹¶éªŒè¯
- â³ **éœ€è¦é‡æ–°è¿è¡Œå®éªŒ**ï¼ˆçº¦38å°æ—¶ï¼‰
- ğŸ“ è®ºæ–‡ä¸­å¼ºè°ƒå…¬å¹³å¯¹æ¯”çš„é‡è¦æ€§

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-11-09  
**éªŒè¯çŠ¶æ€**: âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡  
**å®éªŒçŠ¶æ€**: â³ å¾…é‡æ–°è¿è¡Œ
