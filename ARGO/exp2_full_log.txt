`torch_dtype` is deprecated! Use `dtype` instead!
================================================================================
完整实验2: 检索成功率影响 (真实LLM)
================================================================================
模型: Qwen2.5-3B-Instruct
参数: 30道Hard题, 7个p_s点, 8张GPU
策略: ARGO (动态) vs 3种基线 (固定)
预计时间: ~40-50分钟
================================================================================


策略说明:
--------------------------------------------------------------------------------
1. ARGO策略 (动态自适应):
   - 根据MDP阈值 θ_cont 和 θ* 动态决策
   - U < θ_cont: 执行Retrieve
   - θ_cont ≤ U < θ*: 执行Reason
   - U ≥ θ*: Terminate
   - 没有固定步数限制!

2. Always-Retrieve (固定检索):
   - 固定执行Retrieve直到 U ≥ θ* (0.9)
   - 不会切换到Reason

3. Always-Reason (固定推理):
   - 固定执行Reason直到 U ≥ θ* (0.9)
   - 不会执行Retrieve

4. Random (随机策略):
   - 50%概率Retrieve, 50%概率Reason
   - 直到 U ≥ θ*
--------------------------------------------------------------------------------

初始化实验环境...

================================================================================
实验2: 检索成功率影响 (真实LLM版本)
================================================================================
LLM模型: /data/user/huangxiaolin/ARGO/RAG_Models/models/Qwen2.5-3B-Instruct
嵌入模型: /data/user/huangxiaolin/ARGO/models/all-MiniLM-L6-v2
问题难度: HARD
问题数量: 30
================================================================================

GPU配置:
  可用GPU: 8张
  使用GPU: [0, 1, 2, 3, 4, 5, 6, 7]
    GPU 0: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 1: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 2: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 3: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 4: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 5: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 6: NVIDIA GeForce RTX 3060 (12.6GB)
    GPU 7: NVIDIA GeForce RTX 3060 (12.6GB)

加载ORAN-Bench-13K数据集...
Loaded ORAN-Bench-13K:
  Easy: 1139 questions
  Medium: 9570 questions
  Hard: 3243 questions
  Total: 13952 questions
✓ 加载了 30 道 HARD 问题

加载嵌入模型: /data/user/huangxiaolin/ARGO/models/all-MiniLM-L6-v2
✓ 嵌入模型加载成功 (GPU 0)

连接Chroma数据库: /data/user/huangxiaolin/ARGO2/ARGO/Environments/chroma_store
✓ Chroma集合加载成功 (文档数: 436279)

加载LLM模型: /data/user/huangxiaolin/ARGO/RAG_Models/models/Qwen2.5-3B-Instruct
  使用 8 张GPU加载模型...
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:01<00:01,  1.54s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.14s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:02<00:00,  1.20s/it]
The following generation flags are not valid and may be ignored: ['temperature', 'top_p', 'top_k']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
✓ LLM模型加载成功
  Device map: {'model.embed_tokens': 0, 'lm_head': 0, 'model.layers.0': 0, 'model.layers.1': 1, 'model.layers.2': 1, 'model.layers.3': 1, 'model.layers.4': 1, 'model.layers.5': 1, 'model.layers.6': 1, 'model.layers.7': 2, 'model.layers.8': 2, 'model.layers.9': 2, 'model.layers.10': 2, 'model.layers.11': 2, 'model.layers.12': 2, 'model.layers.13': 3, 'model.layers.14': 3, 'model.layers.15': 3, 'model.layers.16': 3, 'model.layers.17': 3, 'model.layers.18': 3, 'model.layers.19': 4, 'model.layers.20': 4, 'model.layers.21': 4, 'model.layers.22': 4, 'model.layers.23': 4, 'model.layers.24': 4, 'model.layers.25': 5, 'model.layers.26': 5, 'model.layers.27': 5, 'model.layers.28': 5, 'model.layers.29': 5, 'model.layers.30': 5, 'model.layers.31': 6, 'model.layers.32': 6, 'model.layers.33': 6, 'model.layers.34': 6, 'model.layers.35': 6, 'model.norm': 6, 'model.rotary_emb': 6}

================================================================================
初始化完成!
================================================================================


================================================================================
开始实验 - 检索成功率影响
================================================================================
p_s范围: 0.50 ~ 0.95 (扫描 7 个点)
问题数量: 30
总评估次数: 7 × 3策略 × 30题 = 630
================================================================================


================================================================================
开始实验 - 检索成功率影响
================================================================================
p_s范围: 0.50 ~ 0.95 (扫描 7 个点)
c_r固定: 0.050
问题数量: 30
总评估次数: 7 × 3策略 × 30题 = 630
================================================================================


[1/7] p_s = 0.50
--------------------------------------------------------------------------------
  求解MDP (p_s=0.50)... θ_cont=0.000, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.260, Retrievals=0.0, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.392, Retrievals=7.8, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[2/7] p_s = 0.57
--------------------------------------------------------------------------------
  求解MDP (p_s=0.57)... θ_cont=0.000, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.260, Retrievals=0.0, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.360, Retrievals=7.2, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[3/7] p_s = 0.65
--------------------------------------------------------------------------------
  求解MDP (p_s=0.65)... θ_cont=0.060, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.265, Retrievals=1.3, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.305, Retrievals=6.1, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[4/7] p_s = 0.72
--------------------------------------------------------------------------------
  求解MDP (p_s=0.72)... θ_cont=0.070, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.265, Retrievals=1.3, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.277, Retrievals=5.5, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[5/7] p_s = 0.80
--------------------------------------------------------------------------------
  求解MDP (p_s=0.80)... θ_cont=0.080, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.267, Retrievals=1.3, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.255, Retrievals=5.1, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[6/7] p_s = 0.88
--------------------------------------------------------------------------------
  求解MDP (p_s=0.88)... θ_cont=0.090, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.255, Retrievals=1.1, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.227, Retrievals=4.5, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

[7/7] p_s = 0.95
--------------------------------------------------------------------------------
  求解MDP (p_s=0.95)... θ_cont=0.140, θ*=1.000

  评估 30 道问题...
    进度: 10/30
    进度: 20/30
    进度: 30/30
  ARGO                : Quality=1.000, Cost=0.253, Retrievals=1.1, Accuracy=70.0%
  Always-Retrieve     : Quality=1.000, Cost=0.212, Retrievals=4.2, Accuracy=93.3%
  Always-Reason       : Quality=0.960, Cost=0.240, Retrievals=0.0, Accuracy=70.0%

================================================================================
实验完成!
================================================================================


================================================================================
✅ 完整实验2完成!
================================================================================
Traceback (most recent call last):
  File "/data/user/huangxiaolin/ARGO2/ARGO/run_exp2_full.py", line 124, in <module>
    main()
  File "/data/user/huangxiaolin/ARGO2/ARGO/run_exp2_full.py", line 114, in main
    print(f"结果已保存: {results['save_path']}")
                    ~~~~~~~^^^^^^^^^^^^^
TypeError: list indices must be integers or slices, not str
