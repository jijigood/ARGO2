# 实验3修复说明

## 问题诊断

之前实验3的所有μ值(0.0~10.0)都产生了**完全相同的MDP阈值**:
- θ_cont = 0.08 (固定)
- θ_star = 1.0 (固定)

**根本原因**: MDP求解器虽然读取了μ参数,但在奖励函数中**从未使用**。

## 修复方案

修改了 `/data/user/huangxiaolin/ARGO2/ARGO_MDP/src/mdp_solver.py` 中的 `reward()` 函数:

### 修复前:
```python
# Step cost (没有μ权重)
if action == 0:
    return -self.c_r
elif action == 1:
    return -self.c_p
```

### 修复后:
```python
# Step cost weighted by μ
# Higher μ means more penalty for cost
if action == 0:
    return -self.mu * self.c_r  # 检索成本 × μ
elif action == 1:
    return -self.mu * self.c_p  # 推理成本 × μ
```

## 修复验证

测试不同μ值的阈值变化:

| μ值  | θ_cont | θ_star | 策略倾向              |
|------|--------|--------|----------------------|
| 0.0  | 0.920  | 1.000  | 质量优先,多检索       |
| 1.0  | 0.080  | 1.000  | 均衡策略             |
| 3.0  | 0.030  | 1.000  | 倾向成本,少检索       |
| 5.0  | 0.000  | 1.000  | 成本优先,极少检索     |
| 10.0 | 0.000  | 1.000  | 成本优先,极少检索     |

✅ **验证成功**: θ_cont随μ增大而降低,符合预期!

## 阈值含义解释

- **θ_cont (检索阈值)**: 
  - 高θ_cont → U需要很高才会切换到Reason → 更多Retrieve → 质量优先
  - 低θ_cont → 很早就切换到Reason → 更少Retrieve → 成本优先

- **θ_star (终止阈值)**: 
  - 达到此不确定性水平后终止
  - 当前实验中固定为1.0 (需要完全消除不确定性)

## 预期实验结果

修复后的实验3应该展示**Pareto边界曲线**:

```
Quality
  ^
  |     ARGO曲线 (Pareto前沿)
  |    ╱
  |   ╱  μ=0
  |  ╱   (质量优先)
  | ╱
  |╱ μ=10 (成本优先)
  |
  |  • Always-Reason
  |    • Always-Retrieve
  |
  +------------------------> Cost
```

- **ARGO曲线**: 随μ变化,从高质量/高成本 → 低质量/低成本
- **基线策略**: 单点,落在ARGO曲线下方 (次优)

## 当前状态

🔄 **实验3正在重新运行** (修复版)
- 进程ID: 1547789
- 日志文件: `exp3_fixed_log.txt`
- 当前进度: [1/10] μ=0.00, 已完成10/30道题
- 预计完成时间: 1-2小时

监控命令:
```bash
bash monitor_exp3_fixed.sh
```

## 关键改进

1. ✅ μ参数现在正确影响MDP求解
2. ✅ 不同μ值产生不同阈值
3. ✅ 符合理论预期: μ↑ → θ_cont↓ → 成本优先
4. ✅ 应该能观察到完整的Pareto边界

---

**总结**: 通过在步骤奖励中引入μ权重,MDP求解器现在能正确权衡成本和质量,从而为不同的μ值计算出不同的最优策略阈值,最终形成Pareto边界曲线。
