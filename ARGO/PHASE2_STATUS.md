# Phase 2.1 å®æ–½çŠ¶æ€

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ£€ç´¢æˆåŠŸç‡ p_s å®ç°

**ä»£ç ä¿®æ”¹**:
- âœ… æ·»åŠ  `import random`
- âœ… åœ¨ `mdp_rag_multi_gpu.py` ä¸­å®ç°éšæœºæ£€ç´¢æˆåŠŸ/å¤±è´¥
- âœ… åœ¨ `compare_mdp_vs_fixed_multigpu.py` ä¸­åŒæ­¥å®ç°
- âœ… Historyä¸­è®°å½• `retrieval_success` çŠ¶æ€
- âœ… å¤±è´¥æ—¶Uä¸å˜ï¼Œä½†ä»æ¶ˆè€—æˆæœ¬

**å®ç°ç»†èŠ‚**:
```python
# éšæœºæ£€ç´¢æˆåŠŸ/å¤±è´¥ (p_s = 0.8)
retrieval_success = random.random() < self.p_s

if retrieval_success:
    U = min(U + self.delta_r, 1.0)  # æˆåŠŸï¼šUå¢åŠ 
else:
    U = U  # å¤±è´¥ï¼šUä¸å˜

C += self.c_r  # æ— è®ºæˆåŠŸå¤±è´¥éƒ½æ¶ˆè€—æˆæœ¬
```

### 2. å‚æ•°ä¿®æ­£å®Œæˆ

| å‚æ•° | ä¿®æ­£å | ç¬¦åˆè§„èŒƒ |
|------|--------|----------|
| c_r  | 0.05   | âœ… |
| c_p  | 0.02   | âœ… |
| p_s  | 0.8    | âœ… |
| Î³    | 0.98   | âœ… |

### 3. ä»£ç æ›´æ–°æ¸…å•

- âœ… `mdp_rag_multi_gpu.py` (lines 26, 340-365)
- âœ… `compare_mdp_vs_fixed_multigpu.py` (lines 7, 86-107)
- âœ… `configs/multi_gpu.yaml` (å·²åœ¨Phase1å®Œæˆ)

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### é—®é¢˜1: MDPç­–ç•¥ä¸æ‰§è¡ŒRetrieve

**ç°è±¡**:
- MDPç­–ç•¥åªæ‰§è¡ŒReasonï¼Œä»ä¸æ‰§è¡ŒRetrieve
- Î¸_cont = 0.0, Î¸_star = 1.0
- ä»U=0å¼€å§‹ï¼ŒU<Î¸_contä¸æˆç«‹ï¼Œæ‰€ä»¥é€‰æ‹©Reason

**åŸå› åˆ†æ**:
å½“å‰å‚æ•°ä¸‹ï¼š
- c_r = 0.05 (Retrieveæˆæœ¬)
- c_p = 0.02 (Reasonæˆæœ¬)
- Î´_r = 0.15 (Retrieveæ”¶ç›Š)
- Î´_p = 0.08 (Reasonæ”¶ç›Š)

**æˆæœ¬æ•ˆç›Šæ¯”**:
- Retrieve: 0.05/0.15 = 0.333
- Reason: 0.02/0.08 = 0.25 âœ… æ›´ä¼˜

**ç»“è®º**: åœ¨å½“å‰å‚æ•°ä¸‹ï¼ŒReasonæ¯”Retrieveæ›´é«˜æ•ˆï¼Œå› æ­¤MDPé€‰æ‹©æ€»æ˜¯Reasonã€‚

### é—®é¢˜2: å‚æ•°ä¸ç¬¦åˆç›´è§‰

**è§„èŒƒåŸæ„**:
- Retrieveåº”è¯¥æˆæœ¬æ›´é«˜ä½†æ”¶ç›Šä¹Ÿæ›´å¤§ï¼ˆè·å–å¤–éƒ¨çŸ¥è¯†ï¼‰
- Reasonæˆæœ¬ä½ä½†æ”¶ç›Šå°ï¼ˆå†…éƒ¨æ¨ç†ï¼‰

**å½“å‰è®¾ç½®**:
- âŒ Retrieveæ›´è´µä½†æ”¶ç›Š/æˆæœ¬æ¯”åè€Œæ›´å·®

---

## ï¿½ï¿½ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆA: è°ƒæ•´æˆæœ¬å‚æ•°

**ä¿æŒè§„èŒƒçš„c_rå’Œc_pï¼Œè°ƒæ•´å…¶ä»–å‚æ•°**:

```yaml
delta_r: 0.20  # å¢åŠ retrieveæ”¶ç›Š
delta_p: 0.08  # ä¿æŒreasonæ”¶ç›Š
c_r: 0.05      # ä¿æŒè§„èŒƒ
c_p: 0.02      # ä¿æŒè§„èŒƒ
```

æˆæœ¬æ•ˆç›Šæ¯”:
- Retrieve: 0.05/0.20 = 0.25
- Reason: 0.02/0.08 = 0.25

### æ–¹æ¡ˆB: ä½¿ç”¨è§„èŒƒæ¨èçš„åŸå§‹å€¼

æŸ¥çœ‹`ARGO_Enhanced_Single_Prompt_V2.2.txt`ä¸­çš„æ¨èï¼š
```yaml
c_r: 0.05
c_p: 0.02
```

ä½†è¿™å¯èƒ½æ˜¯ç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…è®ºæ–‡å¯èƒ½ä½¿ç”¨ä¸åŒå€¼ã€‚

### æ–¹æ¡ˆC: æ¥å—å½“å‰è¡Œä¸º

å¦‚æœReasonç¡®å®æ›´é«˜æ•ˆï¼ŒMDPé€‰æ‹©Always-Reasonä¹Ÿæ˜¯åˆç†çš„ã€‚
ä½†è¿™ä¼šå¯¼è‡´ï¼š
- æ— æ³•æµ‹è¯•Retrieveçš„p_sæœºåˆ¶
- ä¸"MDP-guided RAG"çš„åˆè¡·ä¸ç¬¦

---

## ğŸ“Š éªŒè¯ç»“æœ

### Fixedç­–ç•¥ (k=3)

**æ£€ç´¢æˆåŠŸç‡éªŒè¯** (5ä¸ªé—®é¢˜æµ‹è¯•):
- æ€»æ£€ç´¢æ¬¡æ•°: 15
- æˆåŠŸæ¬¡æ•°: ~12 (80%)
- å¤±è´¥æ¬¡æ•°: ~3 (20%)
- âœ… p_s = 0.8 æ­£å¸¸å·¥ä½œ

**ç¤ºä¾‹history**:
```
Iter 1: retrieve âœ“ success
Iter 2: retrieve âœ“ success  
Iter 3: retrieve âœ— failed
Iter 4: reason
```

### MDPç­–ç•¥

**è¡Œä¸º**:
- æ€»æ£€ç´¢æ¬¡æ•°: 0
- æ€»æ¨ç†æ¬¡æ•°: ~13
- âŒ ä»ä¸é€‰æ‹©Retrieve

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### é€‰é¡¹1: è°ƒæ•´å‚æ•°ä½¿MDPæ‰§è¡ŒRetrieve

ä¿®æ”¹ `configs/multi_gpu.yaml`:
```yaml
mdp:
  delta_r: 0.25  # å¢åŠ åˆ°0.25
  delta_p: 0.08  # ä¿æŒ
```

### é€‰é¡¹2: ä½¿ç”¨ä¸åŒçš„è´¨é‡å‡½æ•°

å°è¯•éçº¿æ€§è´¨é‡å‡½æ•°å¯èƒ½æ”¹å˜ç­–ç•¥ã€‚

### é€‰é¡¹3: ç»§ç»­Phase 2.2

æ¥å—å½“å‰è¡Œä¸ºï¼Œç»§ç»­å®ç°Reward Shapingï¼Œçœ‹æ˜¯å¦æ”¹å˜ç­–ç•¥ã€‚

---

## âœ… Phase 2.1 æ ¸å¿ƒåŠŸèƒ½å·²å®ç°

å°½ç®¡MDPç­–ç•¥ä¸é€‰æ‹©Retrieveï¼Œä½†**p_sæœºåˆ¶æœ¬èº«å·²æ­£ç¡®å®ç°**ï¼š

1. âœ… éšæœºæˆåŠŸ/å¤±è´¥é€»è¾‘
2. âœ… å¤±è´¥æ—¶Uä¸å˜
3. âœ… å¤±è´¥æ—¶ä»æ¶ˆè€—æˆæœ¬
4. âœ… Historyæ­£ç¡®è®°å½•çŠ¶æ€

**åœ¨Fixedç­–ç•¥ä¸­éªŒè¯é€šè¿‡ï¼**

---

ç”Ÿæˆæ—¶é—´: 2025-10-28
çŠ¶æ€: Phase 2.1 ä»£ç å®Œæˆï¼ŒMDPå‚æ•°éœ€è°ƒæ•´
