Copyright © 2024 by the O-RAN ALLIANCE e.V.
The copying or incorporation into any other work of part or all of the material available in this specification in any form without the prior written permission of O-RAN ALLIANCE e.V.  is prohibited, save that you may print or download extracts of the material of this specification for your personal use, or copy the material of this specification for the purpose of sending to individual third parties for their information provided that you acknowledge O-RAN ALLIANCE as the source of the material and that you inform the third party that these conditions apply to them and that they must comply with them.
O-RAN ALLIANCE e.V., Buschkauler Weg 27, 53347 Alfter, Germany
Register of Associations, Bonn VR 11238, VAT ID DE321720189
Introductory Material
Scope
This Technical Specification has been produced by the O-RAN Alliance.
The contents of the present document are subject to continuing work within O-RAN and may change following formal O-RAN approval. Should the O-RAN Alliance modify the contents of the present document, it will be re-released by O-RAN with an identifying change of release date and an increase in version number as follows:
Release x.y.z
where:
x	the first digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc. (the initial approved document will have x=01).
y	the second digit is incremented when editorial only changes have been incorporated in the document.
z	the third digit included only in working versions of the document indicating incremental changes during the editing process.
The present document describes a REST API that allows Event Consumers (EC) such as a O-RAN NFs to subscribe to events/status from the O-Cloud.  The O-Cloud shall provide Event Producers (EP) to enable workloads to receive events/status that might be known only to the Cloud Infrastructure (CInf).
References
The following documents contain provisions which, through reference in this text, constitute provisions of this specification (see also https://www.o-ran.org/specifications).
3GPP TR 21.905, Vocabulary for 3GPP Specifications.
3GPP TS 28.622, Telecommunication management; Generic Network Resource Model (NRM) Integration Reference Point (IRP); Information Service (IS).
O-RAN WG1, O-RAN Architecture Description – v02.00, Technical Specification.
O-RAN WG1, Operations and Maintenance Architecture – v03.00, Technical Specification.
O-RAN WG4, Control, User and Synchronization Plane Specification – v06.00, Technical Specification.
O-RAN WG6, Cloud Architecture and Deployment Scenarios for O-RAN Virtualized RAN – v02.01, Technical Report.
O-RAN Infrastructure Project, https://wiki.o-ran-sc.org/display/IN/Infrastructure+Home
IETF RFC 7540: "Hypertext Transfer Protocol Version 2 (HTTP/2)".
IETF RFC 8259: "The JavaScript Object Notation (JSON) Data Interchange Format".
IETF RFC 7231: "Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content".
IETF RFC 7230: "Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing".
IETF RFC 7807: "Problem Details for HTTP APIs".
IETF RFC 7235 for authentication mechanisms over HTTP/1.1,
3GPP TS 29.501, 5G System; Principles and Guidelines for Services Definition
CloudEvents.io specification, https://github.com/cloudevents/
Definitions and Abbreviations
Definitions
For the purposes of the present document, the terms given in O-RAN.WG6.CADS [6] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in [6].
Abbreviations
For the purposes of the present document, the abbreviations given in O-RAN.WG6.CADS [6] and the following apply. An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in [6].
EC	Event Consumer
EP		Event Producer
REST	Representational State Transfer
Introduction
This document describes a REST API that allows Event Consumers (EC) such as a vO-DU or CNF to subscribe to events/status from the O-Cloud.  The cloud infrastructure will provide Event Producers (EP) to enable cloud workloads to receive events/status that might be known only to the infrastructure.
An EC will use the REST API to subscribe to specific event types or categories of events by specifying the event / status producer address.   The addressing scheme is covered in Resource Addressing.  An EC will be able to unsubscribe from receiving events and status by deleting the subscription through the REST API.  The REST API is an integration point to an event and status framework that is running in the underlying O-Cloud (IMS and/or DMS).
The REST API and associated event framework implementation is intended to be used in situations where the path from event detection to event consumption must have the lowest possible latency.  Intra-node delivery of events is a primary focus with inter-node delivery also supported.
The event framework described here is not intended to be an island of communication and should interact with north-bound interfaces such as O2 through the IMS. Hence, this Event Consumers API is not intended to replace O2ims notifications (including PTP loss of sync), but rather to complement it. Please see the CAD [6] for more information.
Interfacing with external entities is necessary for communication with orchestrating entities and for permanent storage of event information for root-cause analysis.  Communication with external entities is intended to be in one direction with events flowing from this framework outward.  The flow of events from this framework to external entities must not affect the latency performance of the framework for intra-node or inter-node delivery.
Please note that while this API document describes an interface to general events and status provided by the cloud infrastructure, the discussions and examples in this document will focus on events and status related to PTP / Synchronization as it this is the first defined use case that affects the vO-DU per the CUSP [5] requirements.
“If an O-DU transits to the FREERUN state, the O-DU shall disable RF transmission on all connected O-RUs, and keep it turned off until synchronization is reacquired.”
“Whether in ‘synchronized’ or ‘Holdover’ state, it is expected that O-DU monitors the ‘SYNCED/HOLDOVER’ status of the O-RUs under its management.”
Please note that the timing requirements for notification regarding FREERUN should follow WG4 guidelines when available in the CUSP document. These guidelines may influence the future evolution and design of this API. Please see the CUSP [5] for more information.
Subscription/Publication use case:
Subscription by the Event Consumer (e.g. vO-DU or other CNF) triggers the readiness of the Event Consumer to receive the notifications.
The REST API handler implementation, provided by the Cloud infrastructure, resides in the application (workload) and is an application appropriate implementation of a REST API handler.
Upon subscription, the EC will receive an initial notification of the EP resource status. For example, the current synchronization status of the PTP system will be sent to the EC when subscribing to the sync-status address. Or as another example, the current interface carrier status will be sent to the EC when subscribing to the interface-status address.  This initial notification allows the joining application to synchronize to the current status of the system being observed.
Event Consumers will be able to subscribe to resource status notifications offered by the cloud.
Multiple Event Consumers in the same container, Pod, or VM can subscribe to events and status as the REST API allows multiple receive endpoint URI.
If the eventing framework cannot provide the requested subscription the eventing framework will deny the subscription request and Event Consumer (vO-DU, vO-CU etc) will be able to make a decision if to proceed with its operation
Usage of HTTP
General
HTTP/2, IETF RFC 7540, shall be used.
HTTP/2 shall be transported over Transmission Control Protocol (TCP), as required by HTTP/2 (see IETF RFC 7540 [8]) HTTP standard headers
Request header fields
This clause describes the usage of selected HTTP header fields of the request messages in the O-Cloud APIs.
Table 3.1.3.2-1: Header fields supported in the request message
Response header fields
This clause describes the usage of selected HTTP header fields of the response messages in the O-Cloud APIs.
Table 3.1.3.3-1: Header fields supported in the response message
Content type
JSON, IETF RFC 8259 shall be used as content type of the HTTP bodies specified in the present specification.The use of the JSON format shall be signaled by the content type "application/json".
"Problem Details" JSON object shall be used to indicate additional details of the error in a HTTP response body and shall be signalled by the content type "application/problem+json", as defined in IETF RFC 7807.
Void
.
Resource addressing
The format of the resource address is shown in Table 1.  The resource address specifies the Event Producer with a hierarchical path.  The path format provides the ability for management and monitoring to extend beyond a single cluster and node.
Table 1: Resource address format
An example hierarchy could include an IMS and DMS designator i.e., /ims-1/dms-2/node1/sync/sync-status/sync-state.  The event framework is minimally required to support nodeName addressing.  The event framework addressing nomenclature for nodeName shall match the O-Cloud technology naming scheme.
This hierarchy path is part of the environment variables provided to the CNF by the Downward API (see https://kubernetes.io/docs/tasks/inject-data-application/environment-variable-expose-pod-information/#the-downward-api)
Field definitions are shown in Table 2.
Table 2: Resource address fields
Subscription API Definition
Resource Structure
Figure 1 shows the overall resource URI structure defined for the subscription’s API. Table 3 lists the individual resources defined, and the applicable HTTP methods with the message flow diagram, Figure 2.
Figure 1: Resource URI structure of the subscription’s API
Figure 2: Message flow diagram
Resources and HTTP Methods
An Event Consumer (e.g. vDU or other CNF) will use a POST request to subscribe to receive notifications per its desirable resource.  This resource is mapped to a data type/payload (see data model).
The POST’s payload will also include the notification endpoint (callback URI) for the API Producer to send the notifications back to the EC.
The API Producer, in this case the Helper (see appendix A), will validate that the resource requested is offered by the cluster and available at the particular address.  If the resource does not exist an error code will be sent to the client’s EndpointURI. This will be followed by a sanity check of the requested notification endpoint and creating the resource if communication to the notification endpoint is successful. To reduce security concerns and lifecycle management burden the notification endpoint URI must be part of the same localhost, this is the localhost shared by the Event Consumer and Helper, with the assumption that they are located in the same POD or VM.
Subscription resource definition
The resource URI is:
{apiRoot}/ocloudNotifications/{apiMajorVersion}/subscriptions
The resource URI variables supported by the resource shall be defined as Table 4 illustrates.
Table 4: Resource URI variables for this resource
Subscription POST Method
The POST method creates a subscription resource for the Event Consumer.  As the result of successfully executing this method, a new subscription resource shall exist as defined in clause 1.2, and a variable value (subscriptionId) will be used in the representation of that resource. An initial status notification for the type of event  (for example, PTP synchronization status) shall be triggered.  The status describes the initial status of the producer resource when successfully executing this method as defined in clause 1.1.4, followed by any PTP status notifications (triggered if there is a change in PTP status).
URI query parameters supported by the method shall be defined as Table 5 illustrates.
Table 5: URI query parameters supported by a method on the resource
Data structures supported by the request body of the POST method shall be specified as Table 6 illustrates.
Table 6: Data structures supported by the request body on the resource
Note: The Subscriptioninfo is defined in the subscription data model section
Data structures supported by the response body of the method shall be specified as Table 7 illustrates.
Table 7: Data structures supported by the response body on the resource
Note: The SubscriptionInfo is defined in the subscription data model section, see Table 30
The following example shows a subscription request/response for /sync-state which would deliver notifications for the event.sync.sync-status.synchronization-state-change event only.
Example Create Subscription Resource: JSON request
Example Create Subscription Resource: JSON response
Subscription GET Method
The GET method queries the subscription object and its associated properties.  As a result of a successful execution of this method a list of subscription object(s) and their associated properties will return by the API Producer.
URI query parameters supported by the method shall be defined as Table 8 illustrates.
Table 8: URI query parameters supported by a method on the resource
Data structures supported by the response body of the method shall be specified as Table 9 illustrates.
Table 9: Data structures supported by the response body on the resource
Note: The SubscriptionInfo is defined in the subscription data model section, see Table 30
Individual subscription resource definition
The resource URI is:
{apiRoot}/ocloudNotifications/{apiMajorVersion}/subscriptions/{subscriptionId}
The resource URI variables supported by the resource shall be defined as Table 10 illustrates.
Table 10: Resource URI variables for this resource
Individual Subscription DELTE Method
The DELETE method deletes an individual subscription resource object and its associated properties. As the result of a successful execution of this method a subscription resource object (the one associated with the subscriptionId) and its associated properties will be deleted by the API Producer.
URI query parameters supported by the method shall be defined as Table 11 illustrates.
Table 11: URI query parameters supported by a method on the resource
Data structures supported by the request body of the DELETE method shall be specified as Table 12 illustrates.
Table 12: Data structures supported by the request body on the resource
Data structures supported by the response body of the method shall be specified as Table 13 illustrates.
Table 13: Data structures supported by the response body on the resource
Individual Subscription GET Method
The GET method combined with the subscriptionId variable queries an individual subscription object and its associated properties. As a result of successful execution of this method an individual subscription resource object (the one associated with the subscriptionId) and its associated properties will return by the API Producer.
URI query parameters supported by the method shall be defined as Table 14 illustrates.
Table 14: URI query parameters supported by a method on the resource
Data structures supported by the request body of the GET method shall be specified as Table 15 illustrates.
Table 15: Data structures supported by the request body on the resource
Data structures supported by the response body of the method shall be specified as Table 16 illustrates.
Table 16: Data structures supported by the response body on the resource
Note: The SubscriptionInfo is defined in the subscription Data Model section
Status Notifications API Definition
Description
After a successful subscription (a subscription resource was created) the Event Consumer (e.g. vO-DU or other CNF) shall be able to receive event notifications from the subscribed resource.
Events are sent by the Event Framework when a change of resource state occurs.  The significance of the change of state is dependent upon the Event Producer service.  An example for the PTP use case might be that a synchronization-state-change has occurred, i.e. FREERUN->LOCKED or LOCKED->HOLDOVER.
The HTTP method for delivering the notification (push) to the EC shall be POST and the notification shall be sent to the endpoint reference provided by the EC client during the creation of the subscription resource (see Table 17  The payload body of the POST request shall contain the event payload (see event data model).
Figure 3 illustrates an intra-node (local notification) event delivery.  In this example, the following occurs:
The Event Framework determines that an event condition has occurred
The Event Consumer (vO-DU etc) has previously subscribed to the event type and the API Producer performs a POST to the EV (vO-DU etc) with the complete JSON event payload
Figure 3: Local Notification
Table 17: API Producer Notification methods overview
Event Consumer Notification Resource Definition
The EC’s endpoint URI is used by the API Producer (Helper) to deliver events to the Event Consumer (e.g. vO-DU or CNF).
The EC’s Endpoint URI2 is:
http://localhost:{port}/{path}
The resource URI variables supported by the resource shall be defined as Table 18 illustrates.
Table 18 Resource URI variables for this resource
Consumer Notification Delivery Method
The HTTP method for the notification that corresponds to an explicit subscription shall be POST and the notification shall be sent to the endpoint reference provided during the creation of the subscription resource. The payload body of the POST request shall contain the event notification payload (see event data model).
URI query parameters supported by the method shall be defined as Table 19 illustrates.
__________________________________________________________
2Note: To reduce security concerns and lifecycle management burden the endpoint URI must be part of the same localhost, this is the localhost shared by the EC and API Producer in a POD or VM.
Table 19: URI query parameters supported by a method on the resource
Data structures supported by the request body of the POST method shall be specified as Table 20 illustrates.
Table 20: Data structures supported by the request body on the resource
Data structures supported by the response body of the method shall be specified as Table 21 illustrates.
Table 21: Data structures supported by the response body on the resource
__________________________________________
3Note: The Notification is defined in the notification Data Model section
Figure 4 shows an example event notification payload received by an Event Consumer.
Figure 4: Example Push Event Notification: request body in JSON
Notification Sanity Check Method
The Event Consumer POST request to create a subscription resource will trigger the initial delivery of producer status of the resource that will be sent to the endpoint URI provided by Event Consumer. The purpose is to confirm that the endpoint URI is valid and to send the initial status for the resource. If the validation fails, the subscription for the resource will not be created.
URI query parameters supported by the method shall be defined as Table 22 illustrates.
Table 22: URI query parameters supported by a method on the resource
Data structures supported by the request body of the POST method shall be specified as Table 23 illustrates.
Table 23: Data structures supported by the request body on the resource
Note: The Notification is defined in the notification Data Model section
Data structures supported by the response body of the method shall be specified as Table 24 illustrates.
Table 24: Data structures supported by the response body on the resource
Event Pull Status Notifications API Definition
Description
In addition to receiving event status notifications the Event Consumer (e.g. vO-DU or CNF) shall be able to pull event status notifications. This status notifications will be limited only to the node that the vO-DU resides on.
Figure 5 illustrates event pull status notifications and Table 25 describes resources and methods.
Figure 5: Pull Notifications
Table 25: Pull Events Notifications methods overview
Resources Pull Status Notification Definition
The resource URI is:
{apiRoot}/ocloudNotifications/{apiMajorVersion}/{ResourceAddress}/CurrentState
The resource URI variables supported by the resource shall be defined as Table 26 illustrates.
Table 26: Resource URI variables for this resource
Event Pull Status Notification GET Method
The GET method combined with the ResourceAddress variable pulls the event status notifications. As a result of successful execution of this method the Event Consumer will receive the current event status notifications of the node that the Event Consumer resides on.
URI query parameters supported by the method shall be defined as Table 27 illustrates.
Table 27: URI query parameters supported by a method on the resource
Data structures supported by the request body of the GET method shall be specified as Table 28 illustrates.
Table 28: Data structures supported by the request body on the resource
Data structures supported by the response body of the method shall be specified as Table 29 illustrates.
Table 29: Data structures supported by the response body on the resource
Editor’s note: Currently the pull status operator returns the PTP Sync State event as defined in PTP Sync-State.  In future versions of this specification, status information can be expanded to other metrics / information pertinent to the operation of the system.
Event Data Model
Subscription Data Model
This clause specifies the subscription data model supported by the API.
Structured data types
This clause defines the structures to be used in resource representations.
Type: SubscriptionInfo
Table 30 shows the data types used for subscription.
Table 30: Definition of type <SubscriptionInfo>
Note 1: The API Producer (Helper) shall ignore SubscriptionId and UriLocation if sent by the EC for creating subscription.
Status Notifications Data Model
This clause specifies the event Status Notification data model supported by the API.  The current model supports JSON encoding of the CloudEvents.io specification [15]  for the event payload.
Structured data types
This clause defines the structures to be used in notification representations.
Table 31 shows the data types used in the event data model JSON.
Table 31: Data Model Types
Event Data Model
Table 32: Top-Level JSON Schema
Table 35: Data Array Object Schema
Synchronization Event Specifications
The following sections define the events related to synchronization events.
Editor's Note: synchronization state change events are addressed first due to priority of the RAN use cases, the event distribution infrastructure and associated interfaces are not limited to one specific event category, and events from other subsystems will be added in the future versions of this document.
Editor's Note: the present event set is aligned with / based on the WG4/WG5 YANG models; however, use of some other definitions such as composite clock modes in G.8275 (10/2020), Appendix VIII (or composite of the two approaches) *may* be more useful to convey the information in detail required to adequately specify the states in the cloud nodes context.
Synchronization State
This notification abstracts the underlying technology that the node is using to synchronize itself. It provides the overall synchronization health of the node. This notification includes the health of the OS System Clock which is consumable by application(s).
Table 36: Synchronization State Notification
PTP Synchronization State
Table 37: Synchronization State Notification
Void
Void
GNSS-Sync-State
Table 40: GNSS-Sync-State Notification
Void
OS Clock Sync-State
Table 37: OS clock Sync-State Notification
SyncE Lock-Status-Extended
This notification is a SyncE Lock-state notification that provides detail about the synce PLL states.
Table 39: SyncE-Extended Lock-State Notification
PTP Clock Class Change
A PTP Clock Class change notification is generated when the PTP clock change attribute in the Announce message changes.
Table 36: PTP Clock class change Notification
SyncE Clock Quality Change
A SyncE Clock Quality change notification is generated when the SyncE clock quality attribute in the ESMC message changes.
Table 43: SyncE Clock class change Notification
Appendix A
Helper/Sidecar containers
Reference: https://kubernetes.io/blog/2015/06/the-distributed-system-toolkit-patterns/
Helper/Sidecar containers extend and enhance the "main" container, they take existing containers and make them better.
As an example, consider a container that runs the Nginx web server.  Add a different container that syncs the file system with a git repository, share the file system between the containers and one has built built Git push-to-deploy. And it has been done in a modular manner where the git synchronizer can be built by a different team, and can be reused across many different web servers (Apache, Python, Tomcat, etc).  Because of this modularity, the git synchronizer may be written and tested only once and reused across numerous apps.
Helper/Sidecar value:
Interacts with the notification framework on behalf of the vO-DU
Decouples the app logic from the notification framework, hence removes the burden of implementing a lot of code on the vO-DU and maintaining this code
Single secure and reliable API endpoint since it is exposed over the localhost
Eliminating the discovery of an external pod implementation
Annex (informative): 
Change History