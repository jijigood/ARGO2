O-RAN.WG8.AAD.0-v03.00

                                 O-RAN.WG8.AAD.0-v03.00

Technical Specification

O-RAN Working Group 8

Base Station O-DU and O-CU Software Architecture and APIs

	This is a re-published version of the attached final specification.

	For this re-published version, the prior versions of the IPR Policy will apply, except that the previous requirement for Adopters (as defined in the earlier IPR Policy) to agree to an O-RAN Adopter License Agreement to access and use Final Specifications shall no longer apply or be required for these Final Specifications after 1st July 2022.

	The copying or incorporation into any other work of part or all of the material available in this specification in any form without the prior written permission of O-RAN ALLIANCE e.V.  is prohibited, save that you may print or download extracts of the material on this site for your personal use, or copy the material on this site for the purpose of sending to individual third parties for their information provided that you acknowledge O-RAN ALLIANCE as the source of the material and that you inform the third party that these conditions apply to them and that they must comply with them.

                                 O-RAN.WG8.AAD.0-v03.00

Technical Specification

O-RAN Working Group 8

Base Station O-DU and O-CU Software Architecture and APIs

	© 2021 O-RAN Alliance e.V. All rights reserved.

Copyright © 2021 by O-RAN ALLIANCE e.V.

By using, accessing or downloading any part of this O-RAN specification document, including by copying, saving, distributing, displaying or preparing derivatives of, you agree to be and are bound to the terms of the O-RAN Adopter License Agreement contained in the Annex ZZZ of this specification. All other rights reserved.

O-RAN ALLIANCE e.V.

Buschkauler Weg 27, 53347 Alfter, Germany

Register of Associations, Bonn VR 11238

VAT ID DE321720189

Revision History

Date

Revision

Company

Description

08/09/2019

v01.0.0

O-RAN WG8

First published version for Base Station O-DU and O-CU Software Architecture and APIs

02/14/2020

V02.0.0

O-RAN WG8

Release 2 updates:

Added Physical Broadcast Channel, Physical Random Access Channel, L1 Tasks Processing Flow, Front Haul Module, O-DU Timing Synchronization

L2 and L3 APIs: Corrections and new APIs

MAC-Scheduler APIs: New APIs added to list. All APIs defined fully in this release.

11/9/2020

V3.00

O-RAN WG8

Release 3 updates:

L2/L3 API updates based on OSC feedback

L1 timing sync section update

O1 interface and E2 interface description

New call flows in Appendix

Contents

Chapter 1 Introductory Material	7

1.1 Scope	7

1.2 References	7

1.3 Definitions and Abbreviations	8

1.3.1 Definitions	8

1.3.2 Abbreviations	8

1.3.3 Reference design APIs	10

Chapter 2 RAN Deployment Scenarios and Requirements	10

2.1 Deployment Scenario - Example	10

2.2 Requirements	10

Chapter 3 RAN Architecture	12

3.1 O-CU/O-DU Lower Layer Split Architecture	13

Chapter 4 O-DU Software Architecture	14

4.1 O1 Interface	14

Chapter 5 O-DU L1 Functional Blocks	15

5.1 Physical Uplink Shared Channel	15

5.2 Uplink Control Channels	16

5.3 Uplink Reference Signals	16

5.4 Physical Downlink Shared Channel	16

5.5 Physical Downlink Control Channel	17

5.6 Downlink Reference Signals	17

5.7 Physical Broadcast Channel	17

5.8 Physical Random Access Channel	18

5.9 L1 Tasks Processing Flow	19

5.10 Front Haul Module	20

5.11 O-DU Timing Synchronization	20

Chapter 6 O-DU L2 Functional Blocks	21

6.1 L2 MAC Scheduler	23

6.2 Supporting E2 service models	24

6.3 O-DU Cloudification	25

Chapter 7 O-CU Software Architecture	25

7.1 O1 Interface	26

7.2 F1 Interface	26

7.3 E2 Interface	26

7.4 O-CU Cloudification Aspects	26

Chapter 8 O-CU Functional Blocks	26

8.1 O-CU-CP Functional Blocks	27

8.1.1 O-CU-CP-OAM-Agent	27

8.1.2 gNB Procedure Management	27

8.1.3 Cell Procedure Management	28

8.1.4 UE Procedure Management	28

8.1.5 RRC Encoder and Decoder	28

8.1.6 NGAP Encoder and Decoder	29

8.1.7 XnAP Encoder and Decoder	29

8.1.8 F1AP Encoder and Decoder	29

8.1.9 O-CU-UP Control	29

8.2 Mobility	29

8.2.1 Inter-O-CU Handover 	29

8.2.2 Inter-O-DU Handover within an O-CU	32

8.3 O-CU-UP Functional Blocks	32

8.3.1 O-CU-UP-OAM-Agent	32

8.3.2 eGTPu	32

8.3.3 NR PDCP	33

8.3.4 SDAP	33

Chapter 9 O-DU Interfaces	33

9.1 L1/L2 Interface	33

9.2 L2 Interfaces	34

9.2.1 RLC-MAC Interface	34

9.2.1.1 Data Transfer (DL)	34

9.2.1.2 Data Transfer (UL)	34

9.2.1.3 Schedule Result Reporting (DL)	35

9.2.1.4 Buffer Status Report (DL)	35

9.2.2 MAC – Scheduler Interface	35

9.2.2.1 Common Information Elements in MAC-Scheduler APIs	38

9.2.2.1.1 Air Interface Time	38

9.2.2.1.2 (Debug) Timing Information	38

9.2.2.2 MAC to Scheduler APIs	38

9.2.2.2.1 Cell Configuration Request	38

9.2.2.2.2 Cell Delete Request	39

9.2.2.2.3 Add UE Configuration Request	39

9.2.2.2.4 Modify UE Reconfiguration Request	41

9.2.2.2.5 Delete UE Request	43

9.2.2.2.6 DL HARQ Indication	43

9.2.2.2.7 UL HARQ (CRC) Indication	43

9.2.2.2.8 UL Channel Quality Information	44

9.2.2.2.9 DL Channel Quality Information	44

9.2.2.2.10 RACH Indication Contents	45

9.2.2.2.11 Paging Indication Contents	45

9.2.2.2.12 RACH Resource Request	45

9.2.2.2.13 RACH Resource Release	46

9.2.2.2.14 DL RLC Buffer Status Information	46

9.2.2.2.15 Scheduling Request Indication	47

9.2.2.2.16 UL Buffer Status Report Indication	47

9.2.2.2.17 Power Headroom Indication	47

9.2.2.3 Scheduler to MAC APIs	48

9.2.2.3.1 Cell Configuration Response	48

9.2.2.3.2 Cell Deletion Response	48

9.2.2.3.3 UE Reconfiguration Response	49

9.2.2.3.4 UE Deletion Response	49

9.2.2.3.5 DL Scheduling Information	50

9.2.2.3.6 UL Scheduling Information	52

9.2.2.3.7 RAR Information	54

9.2.2.3.8 Downlink Control Channel Information	54

9.2.2.3.9 Downlink Broadcast Allocation	57

9.2.2.3.10 Downlink Paging Allocation	60

9.2.3 F1AP handler – MAC Interface	62

9.2.3.1 Cell Start	64

9.2.3.2 Cell Stop	64

9.2.3.3 UE Create Request	64

9.2.3.4 UE Create Response	66

9.2.3.5 UE Reconfiguration Request	66

9.2.3.6 UE Reconfiguration Response	68

9.2.3.7 UE Delete Request	69

9.2.3.8 UE Delete Response	69

9.2.3.9 RACH Resource Request	69

9.2.3.10 RACH Resource Response	70

9.2.3.11 RACH Resource Release	70

9.2.3.12 UE Reset Request	71

9.2.3.13 UE Reset Response	71

9.2.3.14 UE Sync Status Indication	71

9.2.3.15 UL CCCH Indication	72

9.2.3.16 DL CCCH Indication	72

9.2.3.17 DL PCCH Indication	72

9.2.3.18 DL Broadcast Request	72

9.2.4 F1AP Handler – RLC Interface	73

9.2.4.1 UE Create	74

9.2.4.2 UE Create Response	75

9.2.4.3 UE Reconfiguration	75

9.2.4.4 UE Reconfiguration Response	77

9.2.4.5 UE Delete	77

9.2.4.6 UE Delete Response	77

9.2.4.7 DL RRC Message Transfer	78

9.2.4.8 UL RRC Message Transfer	78

9.2.4.9 UL RRC Message Delivery Report	78

9.2.4.10 RLC Max Retransmission Reached	78

9.2.4.11 UL RLC Re-establishment Request	79

9.2.5 O1 Interface	79

9.2.6 Support for Hierarchical DU-RU mode	79

Chapter 10 O-CU Interface	79

10.1 RRC-SDAP Interface	79

10.1.1 QoS Flow to DRB Mapping	80

10.1.2 DRB Release	80

10.2 SDAP-PDCP Interface	80

10.2.1 Transfer Data PDU (DL)	80

10.2.2 Transfer Data PDU (UL)	81

10.2.3 End-marker Control PDU (DL)	81

10.3 RRC-PDCP Interface	81

10.3.1 PDCP Entity Establishment	82

10.3.2 PDCP Entity Re-establishment	82

10.3.3 SRB Data Request	82

10.3.4 SRB Data Indication	83

10.4 SDAP-eGTPU Interface	83

10.4.1 Transfer Data SDAP SDU (UL)	83

10.4.2 Transfer Data SDAP SDU (DL)	83

10.5 PDCP-eGTPU Interface	84

10.5.1 Transfer Data PDCP PDU (DL)	84

10.5.2 Transfer Data PDCP PDU (UL)	84

10.6 Ciphering and Integrity Protection	84

10.7 Header Compression	85

	Annex A	(Informative)	85

A.1 L1 APIs	85

A.2 Call Flows	87

A.2.1 F1 Startup and Cells Activation	87

A.2.2 UE registration	87

A.2.3 RACH procedure	90

A.2.4 SR procedure	90

A.2.5 UL Grant procedure	91

A.2.6 PDU Session Establishment	91

Annex ZZZ : O-RAN Adopter License Agreement	92

Section 1: DEFINITIONS	93

Section 2: COPYRIGHT LICENSE	93

Section 3: FRAND LICENSE	93

Section 4: TERM AND TERMINATION	94

Section 5: CONFIDENTIALITY	94

Section 6: INDEMNIFICATION	94

Section 7: LIMITATIONS ON LIABILITY; NO WARRANTY	94

Section 8: ASSIGNMENT	95

Section 9: THIRD-PARTY BENEFICIARY RIGHTS	95

Section 10: BINDING ON AFFILIATES	95

Section 11: GENERAL	95

Introductory Material

Scope

This Technical Specification has been produced by the O-RAN Alliance.

The contents of the present document are subject to continuing work within O-RAN and may change following formal O-RAN approval. Should O-RAN modify the contents of the present document, it will be re-released by O-RAN with an identifying change of release date and an increase in version number as follows:

Version x.y.z

where:

x	the first digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc. (the initial approved document will have x=01).

y	the second digit is incremented when editorial only changes have been incorporated in the document.

z	the third digit included only in working versions of the document indicating incremental changes during the editing process.

This document contains RAN Requirements, reference O-CU and O-DU Software Architecture, Functional Blocks and API definitions. O-RU and Low-PHY references in this document are only informational to complete the architecture description. All hardware and/or software implementations of O-RU and Low-PHY are not in the scope of this document.

References

The following documents contain provisions which, through reference in this text, constitute provisions of the present document.

3GPP TR 21.905: Vocabulary for 3GPP Specifications

3GPP TS 29.281: "General Packet Radio System (GPRS) Tunneling Protocol User Plane (GTPv1-U)".

3GPP TR 38.104: "NR; Base Station (BS) radio transmission and reception".

3GPP TS 38.211: "NR; Physical channels and modulation".

3GPP TS 38.212: "NR; Multiplexing and channel coding".

3GPP TR 38.300: "NR; NR and NG-RAN Overall Description".

3GPP TR 38.321: "NR; Medium Access Control (MAC) protocol specification".

3GPP TR 38.322: "NR; Radio Link Control (RLC) protocol specification".

3GPP TR 38.323: "NR; Packet Data Convergence Protocol (PDCP) specification".

3GPP TR 37.324: "NR; Service Data Adaptation Protocol (SDAP) specification".

3GPP TS 38.331: "NR; Radio Resource Control (RRC) Protocol specification".

3GPP TS 38.401: "NG-RAN; Architecture description".

3GPP TS 38.413: "NG-RAN; NG Application Protocol (NGAP)".

3GPP TS 38.423: "NG-RAN; Xn Application Protocol (XnAP)".

3GPP TS 38.425: "NG-RAN; NR user plane protocol".

3GPP TS 38.470: "NG-RAN; F1 general aspects and principles".

3GPP TS 38.472: "NG-RAN; F1 signaling transport".

3GPP TS 38.473: "NG-RAN; F1 Application Protocol (F1AP)".

3GPP TS 38.474: "NG-RAN; F1 data transport".

ORAN-WG4.CUS.0-v02.00 Technical Specification, ‘O-RAN Fronthaul Working Group Control, User and Synchronization Plane Specification’.

ORAN-WG1 Technical Specification, ‘O-RAN Working Group 1 Architecture Description’

ORAN-WG7-DSC.0-v01.00 Technical Specification, “Deployment Scenarios and Base Station Classes for White Box Hardware”

O-RAN-WG5-MP.0-v01.00 Technical Specification, “O1 Interface specification for O-DU”

O-RAN.WG3.E2GAP-v01.01 Technical Specification, "Near-Real-time RAN Intelligent Controller Architecture & E2 General Aspects and Principles"

O-RAN.WG3.E2AP-v01.01 Technical Specification, "Near-Real-time RAN Intelligent Controller E2 Application Protocol (E2AP)"

SCF Release 10.0, Document 222.10.02, 5G FAPI: PHY API Specification, March 2020

SCF Release 1.0, Document SCF225.1.0, 5G nFAPI Specifications, Sep 2020

Definitions and Abbreviations

Definitions

For the purposes of the present document, the terms and definitions given in 3GPP TR 21.905 [1] and the following apply. A term defined in the present document takes precedence over the definition of the same term, if any, in 3GPP TR 21.905 [1]. For the base station classes of Pico, Micro and Macro, the definitions are given in 3GPP TR 38.104 [3].

O-CU: O-RAN Control Unit – a logical node hosting PDCP, RRC, SDAP and other control functions.

O-DU: O-RAN Distributed Unit: a logical node hosting RLC, MAC, and High-PHY layers based on a lower layer functional split.

O-RU: O-RAN Radio Unit: a logical node hosting Low-PHY layer and RF processing based on a lower layer functional split.

E1 interface: The interface defined by 3GPP TS 38.460, 3GPP TS 38.462 and 3GPP TS 38.463 between CU control plane and CU user plane.

F1 interface:  The interface defined by 3GPP TS 38.470 [16], 3GPP TS 38.472 [17] and 3GPP TS 38.473 [18], to be further interpreted as per O-RAN WG5 specification for interoperability between O-CU and O-DU from different vendors.

Abbreviations

For the purposes of the present document, the abbreviations given in 3GPP TR 21.905 [1] and the following apply.
An abbreviation defined in the present document takes precedence over the definition of the same abbreviation, if any, in 3GPP TR 21.905 [1].

3GPP	Third Generation Partnership Project

5G	Fifth-Generation Mobile Communications

AMC	Adaptive Modulation and Coding

BWP	Bandwidth Part

CCCH	Common Control Channel

CSI	Channel State Information

CU	Centralized Unit as defined by 3GPP

DCI	Downlink Control Information

DPDK	Data Plane Development Kit

DL	Downlink

DRB	Dedicated Radio Bearer

DMRS	Demodulation Reference Signal

DU	Distributed Unit as defined by 3GPP

E1AP	E1 Application Protocol

FAPI	Functional Application Platform Interface

F1AP	F1 Application Protocol

FDD	Frequency Division Duplex

FFT	Fast Fourier Transform

FSM	Finite State Machine

GMC	Grand Master Clock

HARQ	Hybrid Automatic Repeat Request

IE	Information Element

LCID	Logical Channel Identifier

LDPC	Low Density Parity Check code

LLR	Log Likelihood Ratio

MAC	Medium Access Control protocol

MIMO	Multiple Input Multiple Output

MT	Mobile-Termination

MU-MIMO	Multiple User MIMO

NG-RAN	Next Generation Radio Access Network

NIC	Network Interface Card

nFAPI	Network Functional Application Platform Interface

NGAP		NG Application Protocol

NR	New Radio

O-CU	O-RAN Centralized Unit as defined by O-RAN

O-DU	O-RAN Distributed Unit as defined by O-RAN

OFH	Open Front Haul protocol defined by O-RAN

OFH-C	OFH Control plane

OFH-U	OFH User plane

O-RU	O-RAN Radio Unit as defined by O-RAN

PBCH	Physical Broadcast Channel

PDCCH	Physical Downlink Control Channel

PDCP	Packet Data Control Protocol

PF	Proportional Fair (scheduling algorithm)

PHC	PTP Hardware Clock

PHY	Physical (L1) access layer of RAN

PRACH	Physical Random Access Channel

PUCCH	Physical Uplink Control Channel

PUSCH	Physical Uplink Shared Channel

PSS	Primary Synchronization Signal

PTRS	Phase Tracking Reference Signal

QAM	Quadrature Amplitude Modulation

QPSK	Quadrature (Quaternary) Phase Shift Keying

QoS	Quality of Service

RAN	Radio Access Network

Rel-x	Release number: where x is the actual release number

RF	Radio Frequency

RLC	Radio Link Control protocol

RRC	Radio Resource Control protocol

RU	Radio Unit as defined by 3GPP

Rx	Receiver

SCS	Sub-Carrier Spacing

SDAP	Service Data Adaptation Protocol

SDU	Service Data Unit

SRIOV	Single Root Input/Output Virtualization

SRB	Signalling Radio Bearer

SRS	Sounding Reference Signal

SSS	Secondary Synchronization Signal

SU-MIMO	Singer User MIMO

TA	Timing Advance

TDD	Time Division Duplex

TS	Technical Specification

TTI	Transmission Time Interval

Tx	Transmitter

UE	User Equipment

UL	Uplink

URLLC	Ultra-Reliable Low Latency Communication

WG	Working Group

Reference design APIs

A few of 3GPP and O-RAN specific calls flows are described in this specification. All messages shown from or to  the following interfaces are 3GPP messages.

NG

F1

Xn

 Refer to appropriate 3GPP specifications for the details of those messages. All the other internal APIs of O-CU and O-DU are described in this document.

RAN Deployment Scenarios and Requirements

Deployment Scenario - Example

The reference design of the O-CU and O-DU is specified in this document to support all deployment scenarios. In this version, the deployment scenario of indoor pico cell is used as an example.

Requirements

Table 21 lists the features and requirements supported by the reference design based on the target release specification. Requirements marked “R1” and ‘R2” are addressed in this release of the document. Requirements below are aligned to deployment requirements in  [22].

Table 21 Requirements

Feature

Requirement

WG8 Specification Release

L1

Carrier BW

100MHz

R1

Subcarrier Spacing

30kHz, 120kHz

R1

Number of carriers

1

R1

Frame structural format

Static TDD

R1

Number of spatial streams (after precoder)

2T2R

R1

4T4R

R1

Numerology/BWP number

1

R1

4

R3

BWP change

RRC signaling

R3

MAC CE

R3

MIMO

30K   DL:2*2MIMO   UL:2*2MIMO

R1

30K DL:4*4MIMO   UL:2*2MIMO

R1

Modulation

DL: QPSK,16QAM,64QAM,256QAM
UL: π/2-bpsk, QPSK, 16QAM, 64QAM

R1

UL: 256QAM

R2

Capacity

Support at least 4 100MHz bandwidth 2T2R TrxPs

R1

Support at least 2 100MHz bandwidth 4T4R TrxPs

R3

Support at least 8 100MHz bandwidth 2T2R TrxPs

R2

Support at least 4 100MHz bandwidth 4T4R TrxPs

R3

Peak Data Throughput

With 100MHz bandwidth and TDD frames DL:UL (1:1), the DL peak throughput of one cell shall not be lower than 750 Mbps and the UL peak throughput of one cell shall not be lower than 250 Mbps. (2T2R）

R3

Data Compression

Support

R3

PRACH Format

Format 0

R1

Format B4

R1

Format C2

R1

PDCCH Format

DCI 0-0

R1

DCI 0-1

R1

DCI 1-0

R1

DCI 1-1

R1

PUCCH Format

Format0

R1

Format1 + Format2

R1

Format 3

R2

SCS of PBCH

30 kHz

R1

Power control

Enable

R2

L2

HARQ

Enable

R1

AMC

Enable

R1

SRS

Enable

R2

Scheduling algorithm

Round Robin

R1

PF (Proportional Fair)

R1

Latency

Control Plane: 10 ms

User Plane DL: 4 ms (eMBB)

R1

L3

Handover

R3

Paging

R3

F1AP

R1

E1AP

R3

RAN Architecture

	3GPP specifies the 5G RAN architecture and interfaces between the logical functional blocks. The following diagram presents the overall 5G network architecture [12] as well as the logical partition of the main functions.

Figure 31 3GPP RAN Architecture

As shown in Figure 32 [21], O-RAN defines the RAN architecture with a focus on new, open interfaces between the logical nodes and physical partitions of the RAN functions.

Figure 32 O-RAN Architecture and Interfaces

O-CU/O-DU Lower Layer Split Architecture

In some RAN deployment scenarios, e.g., a microcell, the physical layer is split between the O-DU and O-RU. O-RAN WG4 defines the open front haul interface which is adopted in the split architecture as shown in Figure 33. The O-DU contains the higher physical layer High-PHY functions while the O-RU contains the lower physical layer Low-PHY functions as specified in [20]. The fronthaul software interface is discussed in section 5.10 of this specification.

Figure 33 O-CU, O-DU and O-RU (Control and user plane)

O-DU Software Architecture

The O-DU software architecture is illustrated in Figure 41. The O-DU is composed of L1 and L2 functional blocks which interface through the FAPI interface [22]. The functional blocks are further described in the following sections.

Figure 41 O-DU software architecture

Figure 41 O-DU software architecture

O1 Interface

The O-DU O1 interface supports the following management capabilities:

Transport establishment, startup sequence and heartbeat management

Software management

Performance (KPIs) management

Fault management

File management

Provisioning management

Synchronization

Fronthaul delay management

The protocol stack for this interface is shown in Figure 42

Figure 42 O1 interface protocol stack

O-DU L1 Functional Blocks

In O-RAN architecture (refer to Figure 32), PHY layer functionality is realized as High-PHY in O-DU and Low-PHY in O-RU. Some of the PHY functionalities may be realized using hardware acceleration.

Below is a list of PHY related functional blocks.

PUSCH, PUCCH, PRACH

PDSCH, PDCCH, PBCH

UL/DL Reference Signals (DMRS, PTRS, SRS, PSS, SSS)

Fronthaul handler

FAPI handler

Hardware accelerator handler

Timing sync

L1 Task Control Module

In the following sections, the functional blocks are described in detail.

Physical Uplink Shared Channel

The uplink physical layer processing of transport channels consists of the following steps as described in [6]:

Transport Block CRC attachment

Code Block segmentation and Code Block CRC attachment

Channel coding: LDPC coding

Physical layer hybrid-ARQ processing

Rate matching

Scrambling

Modulation: π/2 BPSK (with transform precoding only), QPSK, 16QAM, 64QAM and 256QAM

Layer mapping, transform precoding (enabled/disabled by configuration), and precoding

Mapping to assigned resources and antenna ports

The frequency domain IQ data received by the fronthaul module are sent to the L1 PUSCH processing functions and the output of the PUSCH is the user bit stream. Figure 51 illustrates the PUSCH functional blocks.

Figure 51 PUSCH functional blocks

Resource Element (RE) Demapper: The RE Demapper function separates the DMRS REs and the user data REs. The DMRS REs are provided to the channel estimation function.

Channel Estimation: The channel estimation functional block provides a channel estimate based on the DMRS of resource elements of the user data.

MIMO Equalizer: The MIMO equalizer function processes the received IQ data signals to reverse the distortion incurred during the signal transmission over the air. Using the channel information acquired via the channel estimation, the equalizer tries to restore the IQ symbol sent by the transmitter. The symbols may be conveyed as log-likelihood ratios (LLRs) for use by the LDPC decoder.

Rate Dematching: The rate dematching function performs the reverse operation steps of rate matching for LDPC code in clause 5.4.2 in 3GPP TS38.212 [5].

LDPC Decoder: The LDPC decoder function uses received log-likelihood ratios (LLRs) to compute the data bits based on selected decoder algorithm. The selection of the decoder algorithm is out of scope of this specification.

CRC Check: The CRC function block checks the parity bits using the generator polynomials in Subclause 5.1 of 3GPP TS38.212 [5]. Refer to the 3GPP specification for details.

Uplink Control Channels

Physical Uplink Control Channel (PUCCH) conveys Uplink Control Information (UCI) and supports all the formats defined in clause 6.3.2 of 3GPP TS38.211 specification [4]. Refer to this specification for details of the formats as well as the control message including:

HARQ-ACK (Hybrid Automated Repeat Request Acknowledgement).

Scheduling Request (SR)

Channel State Information (CSI)

Uplink Reference Signals

5G NR introduces the following reference signals.

Demodulation Reference Signal (DMRS) for PUSCH and PUCCH

Phase Tracking Reference Signal (PTRS)

Sounding Reference Signal (SRS)

Refer to clause 6.4.1 in 3GPP TS38.211 specification [4] for more details of the reference signals.

Physical Downlink Shared Channel

The downlink physical layer processing of transport channels consists of the following steps as described in [6]:

Transport Block CRC attachment

Code Block segmentation and Code Block CRC attachment

Channel coding: LDPC coding

Physical-layer hybrid-ARQ processing

Rate matching

Scrambling

Modulation: QPSK, 16QAM, 64QAM and 256QAM

Layer mapping

Mapping to assigned resources and antenna ports

Figure 52 illustrates the functional blocks of the PDSCH.

Figure 52 PDSCH Functional Blocks

Cyclic Redundancy Check Generation: The CRC function block computes the parity bits using the generator polynomials in Subclause 5.1 of 3GPP TS38.212 [5]. Refer to the 3GPP specification for details.

Segmentation: The transport block is segmented when it exceeds the code block size specified by 3GPP TS38.212 [5]. Refer to Subclause 7.2.3 for details.

LDPC Encoder: Refer to Subclause 5.3.2 in 3GPP TS38.212 [5] for details.

Rate Matching: Refer to Subclause 5.4.2 in 3GPP TS38.212 [5] for details.

Scrambler: Refer to Subclause 7.3.1.1 in 3GPP TS38.211 [4] for details.

Modulation Mapper: Refer to Subclause 7.3.1.2 in 3GPP TS38.211 [4] for details.

Layer Mapper: Refer to Subclause 7.3.1.3 in 3GPP TS38.211 [4] for details.

RE Mapper: Refer to Subclause 7.3.1.5 and Subclause 7.3.1.6 in 3GPP TS38.211 [4] for details.

Physical Downlink Control Channel

A Physical Downlink Control Channel (PDCCH) carries control information (DCI) such as scheduling information and resource grant to UEs. The PDCCH includes one or more Control Channel Elements (CCE, consists of 6 resource element group) based on the aggregation level defined by 3GPP specification [4]. The PDCCH processing flow is similar to the PDSCH. The PDCCH uses a polar code instead of LDPC. QPSK modulation is the designated modulation scheme for the PDCCH bits block.

Downlink Reference Signals

The Downlink Reference Signals include:

Demodulation Reference Signal (DMRS) for PDSCH, PDCCH and PBCH.

Phase Tracking Reference Signal (PTRS)

Channel State Information Reference Signal (CSI-RS)

Primary Synchronization Signal (PSS)

Secondary Synchronization Signal (SSS)

Refers to clause 7.4.1 in 3GPP TS38.211 specification [4] for more details related to the reference signals. The PSS and SSS combined with PBCH is known as SS/PBCH block, which consists of:

1 symbol PSS, 1 symbol SSS and 2 symbol PBCH.

Physical Broadcast Channel

PBCH carries 5G NR system information for UEs. UEs need to decode the PBCH information in order to access the 5G cell. PBCH information includes: downlink bandwidth, SFN, timing information in radio frame and SS burst periodicity. Polar codes are used as error correcting code for PBCH.

Figure 53: PBCH processing flow diagram

PBCH Payload Generation: Creates the PBCH payload message, Refer to Subclause 7.1.1 in 3GPP TS38.212 [5] for details.

Scrambling: Refer to Subclause 7.1.2 in 3GPP TS38.212 [5] for details.

CRC attachment: Refer to Subclause 7.1.3 in 3GPP TS38.212 [5] for details.

Channel Encoding: Refer to Subclause 7.1.4 in 3GPP TS38.212 [5] for details.

Rate Matching: Refer to Subclause 7.1.5 in 3GPP TS38.212 [5] for details.

Data Scrambling: Refer to Subclause 7.3.1.3 in 3GPP TS38.211 [4] for details.

Data Modulation: Refer to Subclause 7.3.3.2 in 3GPP TS38.211 [4] for details.

Resource Element Mapping: Refer to Subclause 7.3.3.3 in 3GPP TS38.211 [4] for details.

DMRS Sequence Generation: Refer to Subclause 7.4.1.4 in 3GPP TS38.211 [4] for details.

DMRS Scrambling: Refer to Subclause 7.4.1.4 in 3GPP TS38.211 [4] for details.

DMRS Modulation: Refer to Subclause 7.3.3.2 in 3GPP TS38.211 [4] for details.

Physical Random Access Channel

Physical Random Access Channel (PRACH) is used to carry preamble from UE to gNB. Based on PRACH, gNB is able to calculate the timing advance of each UE and make adjustments on Rx timing for all UEs. PRACH adopts ZC (Zero Correlation) sequences as preamble. It supports two sequence lengths (139 and 839) with various formats targeted for different deployment scenarios. As O-RAN fronthaul separates the PRACH processing into two parts,  the CP removal, frequency shift, samples decimation/filter, FFT and de-mapping function are handled by O-RU; the O-DU PRACH processing flow is shown in Figure 54.

Figure 54: PRACH processing flow diagram

Each O-DU PRACH processing function blocks are described below. The details of the PRACH signal generation, formats are described in 3GPP specifications.

Root Sequence Generation: Refer to Subclause 6.3.3.1 in 3GPP TS38.211 [4] for details.

Correlation: Perform correlation operation between root sequence and received signals.

iFFT: Perform the iFFT operation of received signals.

Antenna Combination: Combine the received signals from all the antennas.

Noise Estimation: Perform the noise estimation operation

Peak Search: Detect the peak for different root sequences.

Preamble Detection and Timing Advance (TA) Estimation: Determine the preamble sequence and timing advance estimation.

L1 Tasks Processing Flow

The L1 function processes are described in previous sections. Those processing blocks focus on specific task that needs to be completed in a timely fashion.  Figure 55 shows the L1 related task processing blocks.

Figure 55: L1 tasks processing diagram

L2 FAPI processing: Handle L2 interface request/response based on FAPI protocol. And triggers additional processing task if required.

Timing events processing: Handle timing related operations, and triggers any pre scheduled periodic tasks.

FEC acceleration processing: Handle FEC related operations and passes the FEC request to hardware and invokes call back function when the acceleration processing is completed.

Front haul processing: Handle all the front haul related Tx/Rx operations, and queue task if further processing is needed.

UL task scheduling: Manage all queued UL tasks and starts the processing operation accordingly.

DL task scheduling: Manage all queued DL tasks and starts the processing operation accordingly.

PUSCH processing: Process the PUSCH related tasks, refer to section 5.1 for details of processing requirements.

PUCCH processing: Process the PUCCH related tasks, refer to section 5.2 for details of processing requirements.

PRACH processing: Process the PRACH related tasks, refer to section 5.8 for details of processing requirements.

PDSCH processing: Process the PDSCH related tasks, refer to section 5.4 for details of processing requirements.

PDCCH processing: Process the PDCCH related tasks, refer to section 5.5 for details of processing requirements.

PBCH processing: Process the PBCH related tasks, refer to section 5.7 for details of processing requirements

Front Haul Module

The fronthaul module supports the open fronthaul interface specified by WG4 [20] lower level split distributed gNB architecture [20]. The detailed requirements and control and data plane protocols are described in O-RAN WG4 CUS-plane specification. The module is responsible for communication between the O-DU and O-RU. The fronthaul module processes incoming WG4 CUS-plane packets and constructs outgoing CUS-plane packets. Figure 56 illustrates an example implementation of hardware accelerated packet processing related to the fronthaul interface.

Figure 56: Fronthaul library and interfaces

The FH library APIs are listed in the following table.

Table 51 Fronthaul library APIs

API Name

Parameters

Description

FH Init

Returns handle which is used later

Instantiate the lib memory model and thread

FH start

FH handle

Start processing front haul packets for DL and UL

FH stop

FH handle

Stop processing of DL and UL

FH close

FH handle

Remove usage of front haul resources

FH mm destroy

FH handle

Destroy memory structure

O-DU Timing Synchronization

In order to meet the timing accuracy in microsecond to sub-microsecond precision requirement over the air interface, O-DU clock needs to synchronize with the Grand Master Clock (GMC). The location of GMC and its connectivity to DU is out of scope of this specification. Please refer to Chapter 9 of [20] for details of S-plane (synchronization) aspects.

O-RAN fronthaul defines several timing distribution network topologies. IEEE1588 is used for O-RAN nodes timing synchronization protocol. GNSS based timing synchronization is another option for O-DU acquiring high accuracy timing. With GNSS based timing synchronization, first, the satellite timing messages are decoded by GNSS receiver, then the 1PPS output signal is generated. As described in O-RAN white box hardware reference specification, the 1PPS signal is connected with the PHC on fronthaul NIC. The O-DU is able to choose either IEEE1588 or GNSS synchronization method. Or it can use either one as primary timing synchronization source while keeping the other one as the backup. Here, a LinuxPTP based timing synchronization method is shown as an example. It may be used for O-DU to synchronize with GMC and distribute the clock to O-RU.

Figure 57: O-DU Timing Synchronization

In Figure 57, first, O-DU syncs up backhaul NIC PHC with GMC; second, the system clock syncs up with backhaul PHC using PHC2Sys; then the O-DU software (fronthaul library) gets the system clock using Linux kernel function call. The fronthaul NIC PHC syncs up with system clock through PTP4L. The O-DU becomes boundary clock and is able to distribute the clock through front haul network to O-RU.

O-DU L2 Functional Blocks

Figure 61 illustrates the L2 functional blocks of O-DU as a reference design. An implementation may specify the modules differently.

Figure 61 O-DU L2 functional blocks

O-DU-OAM-Agent: This module terminates O1 interface from the SMO or the management system. The OAM agent module:

performs startup and registration procedure with SMO

establishes and maintains transport and NETCONF connections

handles configuration and reconfiguration messages on O1

stores the latest configuration

relays configuration parameters to appropriate L1 (High-PHY) and L2 modules

receives and relays notifications over O1

handles software management for O-DU and O-RU

collects and send performance data files for O-DU and O-RU performance counters

The procedures and call flows for the above operations are described in [23]. The management plane for fronthaul supports only hierarchical mode as defined currently in [23].

E2 handler: This module terminates E2 interface from near real-time RIC. This module handles the following:

E2/SCTP interface termination

E2AP protocol message send/receive

Configure appropriate KPI measurements in L2 and L1 modules

Report metrics over E2

Actions to be relayed to other modules (based on E2 messages)

Relaying response over E2

The E2 global procedures and functional procedures are defines in [24] and [25] respectively. The E2 service models for different use case implemented by following the generic design described in 6.2.

F1 Control Plane interface handling modules (F1AP handler): It consists of tasks related to cell management, UE management and semi-static Air Interface Resource Management at the cell level. It does tasks defined in 3GPP TS 38.473 [18].

Cell State Manager: It handles all the tasks related to the handling of cells at O-DU Cell Start, Cell Stop, etc. It also manages a Finite State Machine (FSM) for handling cell specific procedures. This includes maintaining the cell broadcast information. There would be per cell FSM which would run independently of another cell’s FSM.

UE State Manager: It handles the procedures related to a UE, e.g., SRB packet transfer, UE Context Setup, Release procedure, UE Context Modification procedure, etc. It also manages an internal state machine for handling UE specific procedures. It interacts with other layers like RLC/MAC/F1U for UE level interactions and signaling.

F1AP Interface Manager: This interacts with the O-CU-CP (Control Unit) to control communication setup, and it exchanges F1AP messages over SCTP interface. It also decodes/encodes the messages and exchanges the same messages with other tasks.

Resource Manager: This block performs tasks like Admission Control, Bearer Control, etc. It also takes care of managing all the air interface resources for a UE, e.g., physical level resource allocation (SR, CSI resources), etc.

F1 User Plane interface handling modules: It consists of tasks related to Tunnel management, DL and UL Data and Downlink flow control. It does tasks defined in 3GPP TS 29.281 [2] and TS 38.425 [15].

Data Plane Application: Handles DL Data packets received within 3GPP TS 29.281 [2] defined NR RAN Container and performs UL Data packet transmission for packets received from RLC. This Application invokes eGTPU encapsulation/decapsulation functionality for eGTPU header processing.

eGTPU encaps/decaps: This functional block performs eGTPU header decapsulation and processing in DL and eGTPU header encapsulation for the UL packets at F1-U.

Downlink Flow Control: Downlink Data Delivery Status generation with feedback received from RLC.

RLC Protocol modules: These modules handle processing related to SRB and DRB plane. It does tasks defined in 3GPP TS 38.322 [8]. RLC uses the logical channel for data transfer. MAC layer indicates the downlink data notification request for a logical channel along with the desired RLC PDU size. RLC segments (optionally) the SDUs depending upon the size requested from MAC and sends the RLC PDUs to MAC. MAC layer also indicates uplink data by sending RLC PDUs. RLC layer forms SDUs by reassembling the received PDUs and transmits SDUs to upper Layer via F1 interface. It does tasks defined in 3GPP TS 38.322 [8].

UE and Bearer Context management

RLC Mode Receiver and Transmitter

TM Mode

UM Mode

AM Mode

MAC Protocol modules: MAC modules include RACH management, HARQ Management, DL and UL Data, BCCH/PCCH/CCCH processing, MAC Transport Block formation, etc. It does tasks defined in 3GPP TS 38.321 [7].

UE and Bearer Context Management: Stores the semi-static information on air interface resources for the UE. It keeps the QoS related information for the scheduler.

HARQ Management: Performs DL and UL HARQ management by keeping track of HARQ feedback, HARQ timer and providing free HARQ processes information to the scheduler.

RACH Manager: RACH (Preamble) resource management, CRNTI Assignment, Message-2,3,4 resource allocation and handling.

CCCH Manager: Handles the DL and UL CCCH message and corresponding HARQ.

Resource Assign: PDCCH, PDSCH, PUCCH and PUSCH Resource Assignment based on resource allocation schedule from the scheduler.

MAC Encoder: It creates MAC Transport block based on input from the scheduler. It interfaces with RLC to get RLC PDUs.

Demultiplexer: Demultiplexing UL Transport block containing MAC CE and RLC PDUs and sends it to respective tasks.

CSI Manager: Configuration of “Channel State Information” and informing the CSI feedback from UE to the scheduler.

PHY-MAC Interface: Receive and transmit the L1-L2 interface messages.

L2 MAC Scheduler

Figure 62 illustrates the MAC scheduler components present in O-DU architecture. It is assumed that the DU includes complete MAC and scheduler functions implemented in the same physical platform.

NR Scheduler

UL Resource Scheduler

DL Resource Scheduler

DL Link Adaptation

UL Tx Power Control

UL Link Adaptation

DL MIMO Mode Control

TA Manager

UL MIMO Mode Control

NR Scheduler

UL Resource Scheduler

DL Resource Scheduler

DL Link Adaptation

UL Tx Power Control

UL Link Adaptation

DL MIMO Mode Control

TA Manager

UL MIMO Mode Control

Figure 62 L2 MAC scheduler components

NR Scheduler functional block has been further expanded into indicative smaller functional sub-blocks to capture the scheduler functionality.

Note: An actual implementation may divide the scheduler into functional sub-blocks differently.

DL/UL Resource Scheduler: This corresponds to functionality of time-domain and frequency domain scheduling in DL and UL, respectively. Resource scheduling is performed per scheduling period and may be performed for a single slot or multiple slots. It may include functions such as beam selection, selecting of UEs and associated bearers per scheduling period, allocation of radio resources for PDCCH, PUSCH, PDSCH and associated channels like DMRS.

DL/UL Link Adaptation (LA): This functionality performs per UE Link Adaptation in DL and UL, respectively. Link Adaptation may be performed based on channel quality reported by UE or estimated at gNB corrected by BLER. LA would return effective MCS to be used for channel allocation to the UE.

UL Tx Power Control: Performs Closed loop UL power control for PUSCH, SRS and PUCCH. It may estimate the UL Tx power based on UE feedback (eg: Power Headroom Report) or measured UL channels.

DL/UL MIMO Mode Control: Determines per UE the MIMO mode, in DL and UL, respectively, to be used along with the corresponding precoding matrix.

TA Manager: Estimating the TA Command for UE based on feedback from L1 using PUSCH, PUCCH and SRS.

Performance metrics (Capacity, throughput etc.) will be dependent on software implementation and underlying hardware.

Supporting E2 service models

E2 service models are supported as per call flows as per specifications from O-RAN WG5. Each service model enables a use case across O-RAN nodes. The following generic design in O-DU and O-CU supports any service model with report/insert/control/policy services with the neat real-time RIC.

Figure 63 E2 service model support in O-DU

When an E2 message is received at O-DU, the E2 handler module interacts with SM (Service Model) Fanout module to deliver the messages to internal module related to the service model. The SM fanout module consults the SM catalog module and finds the SM specific modules and APIs to be invoked The SM-Service-API-Table module contains maps the following:

SM service, E2 messages corresponding

Receiver module(s) for each E2 message and the message contents to be relayed

When the O-DU sends an E2 message , it is sent through the E2 Sender module which consults SM Catalog module and maps the respective E2 message API. The E2 sender uses KPIs in KPI module when KPIs are reported in an E2 message.

O-DU Cloudification

To be addressed in accordance with recommendations from WG6 on O-DU cloudification in later release of this specification.

O-CU Software Architecture

O-CU node interacts with one or more O-DU nodes through F1 interface.

Figure 71 O-CU interfaces

O1 Interface

To be addressed in a later release of this specification.

F1 Interface

F1 interface supports control plane and user plane separation. The following describe the functions supported over F1-C and F1-U.

The main services and functions of F1-C:

F1 interface management function

System Information management function

F1 UE context management function

RRC message transfer function

Paging function

Warning messages information transfer function

The main services and functions of F1-U:

Transfer of user data

Flow control function

E2 Interface

To be addressed in later release of this specification.

O-CU Cloudification Aspects

To be addressed in accordance with recommendations from WG6 on O-DU cloudification.

O-CU Functional Blocks

Figure 81 below outlines the O-CU functional blocks. An implementation may specify the modules differently.

Figure 81 O-CU Functional Blocks

The O-CU comprises of O-CU-CP and O-CU-UP.

O-CU-CP Functional Blocks

O-CU-CP handles the control plane functionality of O-CU.

O-CU-CP-OAM-Agent

O-CU-CP-OAM-Agent manages following services of O-CU-CP:

Configuration and Control Management

Performance Counter Management

Fault Management

O-CU-CP-OAM receives the configuration for O-CU-CP and configures all the modules of O-CU-CP. It may perform operations like spawning of O-CU-CP modules, and software downloading for O-CU-CP.

O-CU-CP-OAM collects the performance counters of O-CU-CP and reports it to performance management entity present in the network.

O-CU-CP-OAM manages the faults and alarms raised at O-CU-CP and reports it to fault management entity present in the network.

gNB Procedure Management

Figure 82 shows the detailed view of gNB Procedure Management functional block. gNB Procedure Management manages the non-UE associated NGAP and XnAP procedures like NG/Xn Interface Management and Configuration Transfer procedures as defined in 3GPP TS 38.413 [13], TS 38.423 [14] and TS 38.473 [18]. The functional sub-blocks shown in figure below are indicatively used to capture the functionality of gNB Procedure Management functional block and could be realized differently.

NGAP Interface Procedure Management

F1AP Interface Procedure Management

gNB Multi-cell Procedure Management

XnAP Interface  Procedure Management

NGAP Interface Procedure Management

F1AP Interface Procedure Management

gNB Multi-cell Procedure Management

XnAP Interface  Procedure Management

Figure 82 gNB Procedure Management Functional Blocks

Procedure Management: This functionality handles procedures and business logic involving application of the procedure across multiple cells of the gNB. For example, reset triggered due to NGAP link down involving coordination among multiple cells and UE specific paging as described in 3GPP TS 38.413 [12].

NGAP Interface Management: This functionality manages Interface Management procedures, Configuration Transfer procedures, and Warning Message Transmission Procedures over NGAP interface with AMFs as described in 3GPP TS 38.413 [12]. It establishes the association with AMFs. It monitors the association with AMFs. It also maintains context for each AMF with which O-CU is connected and stores information like link status with AMF.

XnAP Interface Management: This functionality manages the Global procedures over XnAP interface with peer O-CUs as described in 3GPP TS 38.423 [13]. It establishes the association with peer O-CUs and also accepts association requests from peer O-CUs based on configuration provided by higher layers. It monitors the association with peer O-CUs. It also maintains context for each peer O-CU with which O-CU is connected and stores information like link status with peer O-CU.

F1AP Interface Procedure Management: This functionality manages Interface Management procedures over F1AP interface with O-DUs as described in 3GPP TS 38.470 [16] and 38.473 [18]. It establishes the association with O-DUs and also accepts association requests from O-DUs based on configuration provided by higher layers. It monitors the association with O-DUs. It also maintains context for each O-DU with which O-CU is connected and stores information like link status with O-DU.

Cell Procedure Management

Cell Procedure Management manages the cell level procedures at O-CU like system information management described in 3GPP TS 38.331, procedures for dual connectivity, global procedures like Cell Activation described in 3GPP TS 38.423 [13], Warning Message Transmission procedures, and System Information Procedures described in 3GPP TS 38.473 [18].

It maintains multiple state machines to handle various cell level procedures. It may have separate state machines for various cell procedures like Cell Setup, Cell Delete, Cell Start, Cell Stop, and Cell Reconfiguration. It also maintains context of each cell to store information like cell state, number of UEs served by the cell, and cell broadcast information.

It manages the cell level performance counters and provides this information to O-CU-CP-OAM.

UE Procedure Management

UE Procedure Management manages the UE Access Control and signalling procedures at O-CU by binding together UE associated RRC, NGAP, XnAP, and F1AP signalling transactions into end-to-end procedures.

This functionality binds together the following signalling procedures on different 3GPP interfaces:

3GPP TS 38.331 defined procedures like RRC Connection Control, Inter-RAT mobility, Measurements, UE capabilities and other UE associated procedures.

3GPP TS 38.413 [12] defined procedures like UE Context Management procedures, UE Mobility Management procedures, PDU Session Management procedures, Transport of NAS Messages procedures, Trace Procedures, Location Reporting procedures, UE Radio Capability Management procedures, and Data Usage Reporting Procedures.

3GPP TS 38.423 [13] defined inter-gNB procedures for Basic mobility and for gNB-gNB Dual Connectivity.

3GPP TS 38.473 [18] defined procedures like UE Context Management procedures, and RRC Message Transfer procedures.

This functionality maintains multiple state machines to handle various UE associated procedures. It may have separate state machines for different UE procedures like UE attach, UE handover, UE context modification, and UE measurement. The single FSM handles NGAP and RRC messages involved in a UE associated procedure, coordinating among AMF, UE, O-DU and other modules of O-CU. It also maintains context of each UE to store information like UE state, various UE AP Ids, and ongoing procedure related information.

RRC Encoder and Decoder

RRC Encoder and Decoder encodes and decodes all RRC ASN content as described in 3GPP TS 38.331. RRC ASN encoding is performed for sending message to UE and for preparing containers to be exchanged during handover, etc. RRC ASN decoding is performed on receiving messages from UE and on receiving containers exchanged during handover, etc.  RRC Encoder and Decoder is accessed by Cell Procedure Management and UE Procedure Management functional blocks. Cell Procedure Management accesses it for RRC ASN encoding of broadcast messages and paging message. UE Procedure Management accesses it for encoding and decoding of all the messages exchanged with UE and for populating the RRC ASN content in handover containers.

NGAP Encoder and Decoder

NGAP Encoder and Decoder encodes and decodes all NGAP ASN message as described in 3GPP TS 38.413 [12]. NGAP ASN encoding is be performed for sending message to AMF. NGAP ASN decoding is performed on receiving messages from AMF. NGAP Encoder and Decoder is accessed by gNB Procedure Management and UE Procedure Management functional blocks. gNB Procedure Management accesses it for non-UE associated procedures between O-CU and AMF. UE Procedure Management accesses it for encoding and decoding of all the UE associated messages exchanged with AMF.

XnAP Encoder and Decoder

XnAP Encoder and Decoder encodes and decodes all XnAP ASN message as described in 3GPP TS 38.423 [13]. XnAP ASN encoding is performed for sending message to peer O-CU. XnAP ASN decoding is performed on receiving messages from peer O-CU. XnAP Encoder and Decoder is accessed by gNB Procedure Management and UE Procedure Management functional blocks. gNB Procedure Management accesses to perform non-UE associated procedures with peer O-CU. UE Procedure Management accesses it for encoding and decoding of all the UE associated messages exchanged with peer O-CU.

F1AP Encoder and Decoder

F1AP Encoder and Decoder encodes and decodes all F1AP ASN content at O-CU as described in 3GPP TS 38.473 [18]. F1AP ASN encoding is performed for sending message to O-DU. F1AP ASN decoding is performed on receiving messages from O-DU. F1AP Encoder and Decoder is accessed by gNB Procedure Management and UE Procedure Management functional blocks. gNB Procedure Management accesses it to perform non-UE associated procedures with O-DU. UE Procedure Management accesses it for encoding and decoding of all the UE associated messages exchanged with O-DU.

O-CU-UP Control

O-CU-UP Control function configures and controls the CU User Plane entities as per the E1 interface defined by 3GPP. This function is invoked primarily by the UE Procedure Management functionality though the non-UE associated procedures would be invoked by the gNB and Cell Procedure Management functionality.

Mobility

Inter-O-CU Handover

Handover between O-CUs is described in the call flow below.

F1AP

PDCP

O-DU

NGU

RRC

F1AP

PDCP

F1U

NGU

RRC

AMF

Source gNB

Target gNB

1. Handover Decision

2. HO Preparation Info Request

3. HO Preparation Info Response

5. UE Context Modification Request

4. UE Context Modification Request

6. UE Context Modification Response

7. UE Context Modification Response

8. Start TNGRELOCprep Timer

9. Handover Required

10. Handover Request

11. Admission Control

12. PDCP Entity Establishment Request

13. PDCP Entity Establishment Response

14. F1U Entity Establishment Request

15. F1U Entity Establishment Response

16. UE Context Setup Request

17. UE Context Setup Request

18. UE Context Setup Response

19. UE Context Setup Response

20. F1U Entity Reconfigure Request

21. F1U Entity Reconfigure Response

22. NGU Entity Establishment Request

23. NGU Entity Establishment Response

24. Handover Request Acknowledge

25. Handover Command

26. Stop TNGRELOCprep and Start TNGRELOCoverall

29. NGU Entity Reconfiguration Request

30. NGU Entity Reconfiguration Response

32. UE Context Modification Request

31. UE Context Modification Request

34. UE Context Modification Response

35. UE Context Modification Response

33. Downlink Data Delivery Status

36. RAN Status Transfer Request

37. RAN Status Transfer Response

38. Uplink RAN Status Transfer

39. Downlink RAN Status Transfer

40. RAN Status Transfer Indication

43. SRB Data Request

41. UL RRC Message Transfer

42. UL RRC Message Transfer

46. UE Context Release Command

47. UE Context Release Procedure

48. UE Context Release Complete

44. Data Buffer Stop Indication

45. Handover Notify

27. PDCP Entity Suspend Request

28. PDCP Entity Suspend Response

O-CU

O-CU

O-DU

F1AP

PDCP

O-DU

NGU

RRC

F1AP

PDCP

F1U

NGU

RRC

AMF

Source gNB

Target gNB

1. Handover Decision

2. HO Preparation Info Request

3. HO Preparation Info Response

5. UE Context Modification Request

4. UE Context Modification Request

6. UE Context Modification Response

7. UE Context Modification Response

8. Start TNGRELOCprep Timer

9. Handover Required

10. Handover Request

11. Admission Control

12. PDCP Entity Establishment Request

13. PDCP Entity Establishment Response

14. F1U Entity Establishment Request

15. F1U Entity Establishment Response

16. UE Context Setup Request

17. UE Context Setup Request

18. UE Context Setup Response

19. UE Context Setup Response

20. F1U Entity Reconfigure Request

21. F1U Entity Reconfigure Response

22. NGU Entity Establishment Request

23. NGU Entity Establishment Response

24. Handover Request Acknowledge

25. Handover Command

26. Stop TNGRELOCprep and Start TNGRELOCoverall

29. NGU Entity Reconfiguration Request

30. NGU Entity Reconfiguration Response

32. UE Context Modification Request

31. UE Context Modification Request

34. UE Context Modification Response

35. UE Context Modification Response

33. Downlink Data Delivery Status

36. RAN Status Transfer Request

37. RAN Status Transfer Response

38. Uplink RAN Status Transfer

39. Downlink RAN Status Transfer

40. RAN Status Transfer Indication

43. SRB Data Request

41. UL RRC Message Transfer

42. UL RRC Message Transfer

46. UE Context Release Command

47. UE Context Release Procedure

48. UE Context Release Complete

44. Data Buffer Stop Indication

45. Handover Notify

27. PDCP Entity Suspend Request

28. PDCP Entity Suspend Response

O-CU

O-CU

O-DUFigure 83 Inter NG-RAN NG based handover (C-Plane Handling)

The source gNB RRC decides for handover.

Source gNB RRC requests PDCP to provide HO preparation info by sending message HO Preparation Info Request. In this message, RRC shall provide target Cell Id and may provide list of cells under control of target gNB, required for potential re-establishment by the UE in these cells to succeed.

PDCP sends HO Preparation Info Response to RRC containing list of ShortMAC-I prepared for the cell list received in HO Preparation Info Request. PDCP may also report ue-InactiveTime.

RRC sends UE Context Modification Request to GNB CU F1AP to query gNB DU configuration.

GNB CU F1AP sends UE Context Modification Request to DU to query gNB DU configuration by setting GNB-DU Configuration Query to TRUE.

gNB DU provides CellGroupConfig in DU to CU RRC Information IE in UE Context Modification Response to gNB CU F1AP.

gNB CU F1AP provides the information received from DU to RRC in UE Context Modification Response.

Note: If RRC maintains the DU CellGroupConfig then steps 4 to 7 are not required.

Starts TNGRELOCprep timer.

Source gNB RRC sends Handover Required message to target gNB.

Target gNB RRC receives Handover Request from AMF.

RRC performs UE admission control and allocates resources for the UE.

RRC creates UE entity at PDCP by sending message PDCP Entity Establishment Request.

After creating UE entity, PDPC sends response message PDCP Entity Establishment Response to RRC.

RRC creates UE entity at F1U by sending message F1U Entity Establishment Request.

After creating UE entity, F1U sends response message F1U Entity Establishment Response to RRC. This message shall include UL tunnel information for each DRB to be shared with DU to receive uplink data from DU.

RRC sends UE Context Setup Request message to F1AP to create UE entity at DU.

F1AP sends UE Context Setup Request message to DU to create UE entity at DU.

After creating UE entity at DU, sends UE Context Setup Response message to F1AP. This message shall include DL tunnel information for each DRB to be shared with gNB CU F1U to receive downlink data from CU.

F1AP sends UE Context Setup Response message to RRC.

RRC reconfigures UE entity at F1U by sending message F1U Entity Reconfigure Request. In this, RRC shall provide the DL tunnel information received from DU.

After reconfiguring UE entity, F1U sends response message F1U Entity Reconfigure Response to RRC.

RRC creates UE entity at NGU by sending message NGU Entity Establishment Request. RRC will also provide forwarding tunnels configuration to NGU, if required.

After creating UE entity, NGU sends response message NGU Entity Establishment Response to RRC.

After preparing the target gNB for UE, RRC sends Handover Request Acknowledge message to AMF. This message shall also contain HandoverCommand IE for UE.

Source gNB RRC receives Handover Command message from target gNB.

Source gNB RRC stops TNGRELOCprep timer and start TNGRELOCOverall timer.

RRC sends PDCP Entity Suspend Request to suspend data in downlink for the UE.

After suspending the data, PDCP sends PDCP Entity Suspend Response to RRC.

RRC reconfigures NGU with message NGU Entity Reconfiguration Request to configure forwarding tunnels for DRBs for which target gNB has provided DL Forwarding UP TNL Information or UL Forwarding UP TNL Information or both.

NGU sends NGU Entity Reconfiguration Response after configuring the forwarding tunnels. After this, source gNB will start forwarding data to target gNB.

Note: If target gNB does not provide DL Forwarding UP TNL Information or UL Forwarding UP TNL Information, data forwarding will not be configured. In that case, step 29 and step 30 shall not be performed.

RRC sends UE Context Modification Request to GNB CU F1AP to stop DL data transmission.

gNB CU F1AP sends UE Context Modification Request to DU which includes RRCReconfiguration message and indicates to stop the data transmission for the UE.

DU may indicate RRCReconfiguration message delivery to UE status to gNB CU F1AP.

DU responds with UE Context Modification Response to gNB CU F1AP.

gNB CU F1AP responds with UE Context Modification Response to RRC.

RRC requests PDCP to provide uplink PDCP-SN and HFN receiver status and the downlink PDCP SN and HFN transmitter status of RLC AM DRBs for which PDCP status preservation applies in message RAN Status Transfer Request so that same can be provided to target gNB.

PDCP reports uplink PDCP-SN and HFN receiver status and the downlink PDCP SN and HFN transmitter status of RLC AM DRBs in RAN Status Transfer Request message.

RRC provides uplink PDCP-SN and HFN receiver status and the downlink PDCP SN and HFN transmitter status of RLC AM DRBs to target gNB in Uplink RAN Status Transfer message. After sending this, source gNB RRC waits for UE Context Release Command message from AMF.

Target gNB receives source gNB Downlink RAN Status Transfer for RLC AM DRBs on which PDCP status preservation applies.

RRC sends RAN Status Transfer Indication to PDCP to provide uplink PDCP-SN and HFN receiver status and the downlink PDCP SN and HFN transmitter status of RLC AM DRBs received from source gNB via AMF.

Note: If RLC AM DRB is not configured, steps 36 to 40 shall not be performed. In that case, source gNB RRC can receive UE Context Release Command from AMF any time after performing step 32.

After handover execution at source gNB, UE sends RRCReconfigurationComplete to target gNB DU which target gNB DU sends to target gNB CU F1AP in UL RRC Message Transfer message.

gNB CU F1AP sends the received RRCReconfigurationComplete message to PDCP in UL RRC Message Transfer message for decryption and deciphering.

PDPC decrypt and decipher RRCReconfigurationComplete and sends it to RRC as payload in SRB Data Request message.

On receiving RRCReconfigurationComplete, RRC sends Data Buffer Stop Indication to PDCP so that PDCP can process the buffered data and resume the data at target gNB.

Target gNB RRC sends Handover Notify to AMF to indicate successful completion of handover procedure at target gNB.

After successful handover of UE at target gNB, AMF sends UE Context Release Command to source gNB which is handled by source gNB RRC.

Source gNB initiates local UE release procedure.

After completion of UE release, source gNB RRC sends UE Context Release Complete message to AMF.

Inter-O-DU Handover within an O-CU

This will be added in the later release.

O-CU-UP Functional Blocks

O-CU-UP handles the user plane functionality at O-CU.

O-CU-UP-OAM-Agent

O-CU-UP-OAM-Agent manages following services of O-CU-UP:

Configuration and Control Management

Performance Counter Management

Fault Management

O-CU-UP-OAM receives the configuration for O-CU-UP and configures all the modules of O-CU-UP. It may perform operations like spawning of O-CU-UP modules and software downloading for O-CU-UP.

O-CU-UP-OAM collects the performance counters of O-CU-UP and reports it to performance management entity present in the network.

O-CU-UP-OAM manages the faults and alarms raised at O-CU-UP and reports it to fault management entity present in the network.

eGTPu

Figure 83 shows the detailed view of eGTPu functional block.

Data Application

NGU

eGTPu encaps & decaps

XnU

F1U

Data Application

NGU

eGTPu encaps & decaps

XnU

F1U

Figure 83 eGTPu Functional Blocks

eGTPu encaps and decaps: It handles the eGTPu protocol stack. It performs eGTPu encapsulation and decapsulation as described in 3GPP TS 29.281 [2] and TS 38.425 [15].

Data Application: This function receives the data packet from UPF, peer O-CU and O-DU over eGTPu interface. It calls eGTPu encaps and decaps to remove the eGTPu header. It identifies the corresponding UE and DRB Id based on mapping of TEID and IP address maintained at eGTPu. It then forwards the data packet to SDAP, which maps the PDU Session to appropriate DRB and passes data to NR PDCP along with information of UE and DRB Id. While sending packet to NR PDCP, it also indicates from which interface this packet has been received, i.e., from UPF or from peer O-CU or from O-DU.

Data Application also processes the data packets received from SDAP. On receiving data packet, it adds the eGTPu header by calling eGTPu encaps and decaps. On the basis of destination, UE and DRB Id received from NR PDCP, packet relay fetches the TEID and IP address from the mapping maintained at eGTPu and sends the data packet to the destination provided by NR PDCP.

NGU: It exchanges ECHO request and response over NGU interface. It takes care of the error handling on NGU interface.

XnU: It exchanges ECHO request and response over XnU interface. It takes care of the error handling on XnU interface. It also takes care of data flow control on XnU interface.

F1U: It exchanges ECHO request and response over F1U interface defined in [19]. It takes care of the error handling on F1U interface. It also takes care of data flow control on F1U interface.

NR PDCP

NR PDCP transfers user plane and control plane data. It maintains PDCP SNs of 12 bits or 18 bits for DRBs and 12 bits for SRBs. It performs header compression and decompression, integrity protection and verification, ciphering and deciphering, timer based SDU discard, routing for split bearers, duplication, reordering and in-order delivery, out of order delivery, and duplicate discarding as described in 3GPP TS 38.323 [9].

SDAP

It performs QoS flow to DRB mapping and implements the procedure described in 3GPP TS 37.324 [10]. In case of a DRB where SDAP header to/from UE is not configured, SDAP entity may not be present.

O-DU Interfaces

L1/L2 Interface

MAC (L2) and High-PHY (L1) layers in O-DU interface using the APIs defined 5G FAPI specifications [22] from Small Cell Forum. In implementations where L2 and L1 of O-DU are on different hosts, a virtualized nFAPI interface will be used. nFAPI is under standardization in Small Cell Forum.

Small Cell Forum 5G FAPI includes the following interfaces:

P5: –PHY configuration interface

P7: –Main data path interface

P19:   RF control interface

O-RAN based implementation of O-DU will use an adaptation module at Frontend to handle P19 interface.

L2 Interfaces

It is expected that the software implementation of the APIs defined in this section will be in conformance with the API message definition and the fields or message elements. Data types and encoding/decoding of the message contents will be implementation dependent. Message elements (IEs) referring to definitions in 3GPP specifications are italicized for ease of reference.

RLC-MAC Interface

The following table details the interactions between RLC and MAC for data transfer and reporting operations.

Table 91 RLC-MAC Interface

Direction

Message/API

Description

RLC to MAC

Data transfer (DL)

API to transfer downlink data

MAC to RLC

Data transfer (UL)

API to transfer uplink data

MAC to RLC

Schedule result reporting (DL)

DL schedule result Reporting to RLC

RLC to MAC

Buffer status reporting (DL)

DL data volume in the RLC entity

Note:

DL:

RLC -> MAC: the Buffer status in RLC

MAC -> RLC: the schedule result Reporting to RLC, then RLC decide how to implement the RLC segment.

RLC->MAC: DL data

UL:

MAC-> RLC: UL data

Data Transfer (DL)

Table 92 RLC-MAC Data transfer (DL) message contents

Element

Presence

Description

Frame Number

M

Air interface time

Slot Number

M

Air interface time

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Number of RLC PDUs

M

Number of RLC PDUs to be sent

RLC PDU info (RB Type, LCID, PDU LEN, RLC PDU)

M

Radio Bearer type, LCID and length for the RLC PDU, RLC PDU data

Data Transfer (UL)

Table 93 RLC-MAC Data transfer (UL) message contents

Element

Presence

Description

Frame Number

M

Air interface time

Slot Number

M

Air interface time

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Number of RLC PDUs

M

Number of RLC PDUs receive from MAC

RLC PDU info (RB Type, RB id, PDU LEN, RLC PDU)

M

Radio Bearer type, Radio Bearer ID, LCID and length for the RLC PDU, RLC PDU data

Schedule Result Reporting (DL)

Table 94 RLC-MAC Schedule result reporting (DL) message contents

Element

Presence

Description

Frame Number

M

Air interface time

Slot Number

M

Air interface time

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Number of RB

M

Number of RBs to send

RLC PDU info (RB id, overall length for each RB)

M

RB id and length overall length for each RB

Buffer Status Report (DL)

Table 95 RLC-MAC Buffer Status reporting (DL) message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Number of RLC PDU

M

Number of RLC PDU in RLC buffer

RLC PDU info (RB id, PDU LEN)

M

LCID and length for each RLC PDU

MAC – Scheduler Interface

5G NR MAC and scheduler modules interact via well-defined APIs. The APIs ensure any scheduler implementation interworks with MAC. This ensures the freedom of choice for OEMs and operators to plug in a scheduler implementation of choice from a third-party vendor in O-DU.

The functionalities of  the scheduler module are restricted to optimal allocation of radio resources at every TTI while catering to the need of gNB for transmission of:

UE specific UL/DL data and signalling messages and

broadcast messages

To achieve the above objective, the APIs defined below abstract the scheduler of any protocol specific operations like handling payloads. The interfaces shown below and the APIs may evolve/change further in future releases of this document to achieve a more optimized scheduler implementation.

Figure 91 MAC-Scheduler interface

The following tables detail the interactions between MAC and scheduler both for configuration and data transfer operations.

Table 96 MAC to Scheduler APIs

Direction

Message/API

Description

MAC to SCH

Cell configuration Request

MAC provides SCH the cell configuration

MAC to SCH

Cell Delete Request

MAC initiates deletion of a cell at SCH

MAC to SCH

Add UE configuration Request

MAC provides SCH the configuration/capabilities of a UE

MAC to SCH

Modify UE configuration Request

MAC provides SCH the re-configuration of UE, also used to add/release/modify existing bearers

MAC to SCH

Delete UE Request

MAC initiates deletion of a UE at SCH

MAC to SCH

DL HARQ Indication

Contains the list of UEs for which DL HARQ ACK / NACK received from UE in a given TTI.

Note: It is the responsibility of the SCH to associate the DL HARQ ACK/NACKs received in a TTI to the corresponding HARQ process Ids.

MAC to SCH

UL HARQ Indication

Contains the list of UEs for which UL Data on PUSCH was received. Per UE, indication of CRC check success or failure is sent by MAC to SCH based on CRC Indication received from L1.

Note: It is the responsibility of the SCH to associate the UL HARQ Indication received in a TTI to the corresponding HARQ process Ids.

MAC to SCH

Uplink channel quality information

MAC provides SCH channel condition (including RI, PMI, CQI) information for UEs for scheduling UL

MAC to SCH

Downlink channel quality information

MAC provides SCH channel condition (including RI, PMI, CQI) information for UEs for scheduling DL

MAC to SCH

RACH Indication Contents

MAC receives the RACH Indication and shares the contents with SCH

MAC to SCH

Paging Indication Contents

MAC indicates Paging message (F1AP Paging) contents to scheduler

MAC to SCH

RACH Resource Request

This API is used to get CRNTI, preamble information from MAC for Contention Free Random Access

MAC to SCH

RACH Resource Release

This API is used to release the Contention Free RACH Resources at MAC

MAC to SCH

RLC Buffer Status Info

DL data volume in the RLC entity

MAC to SCH

Scheduling request indication

MAC provides SCH scheduling request information for UL

MAC to SCH

UL Buffer status report indication

MAC provides SCH buffer status report for UL scheduling

MAC to SCH

UL Power headroom indication

MAC provides SCH power headroom for UL scheduling

Table 97 Scheduler to MAC APIs

Direction

Message/API

Description

SCH to MAC

UE configuration Response

SCH provides response to MAC for a UE configuration Request

SCH to MAC

UE Reconfiguration Response

SCH provides response to MAC for a UE Reconfiguration Request

SCH to MAC

Cell configuration Response

SCH provides response to MAC for a Cell configuration Request

SCH to MAC

Cell Deletion Response

SCH provides response to MAC for a Cell Deletion Request

SCH to MAC

UE Deletion Response

SCH provides response to MAC for a UE Deletion Request

SCH to MAC

Scheduled Bytes in DL

SCH provides scheduling information for a given TTI for scheduling DL data. The scheduling information provides time and frequency domain resources to be scheduled with a list of Logical Channels (LC) and transport block size opportunity per LC.

SCH to MAC

Scheduled Bytes in UL

SCH provides scheduling information for a given TTI for scheduling UL data. The scheduling information provides time and frequency domain resources to be scheduled based on the LC Group (LCG) buffer status or Scheduling Request from UE.

SCH to MAC

RAR Information

SCH shares the RAR and uplink scheduling and Msg3 scheduling information with MAC

SCH to MAC

Downlink control channel information

SCH provides to MAC information for DCI scheduling on PDCCH

SCH to MAC

Downlink Broadcast Allocation

Scheduling information for broadcasting SIB1 and other system information

SCH to MAC

Downlink Paging Allocation

Scheduling information for paging message on a paging channel

Common Information Elements in MAC-Scheduler APIs

Air Interface Time

This is the timing information over the air interface in terms of system frame number and slot.

Table 98 Air interface time

Element

Presence

Description

SFN

M

System Frame number {0…1023}

Slot

M

Slot number {0…319} per 38.211 and FAPI specification

This value wraps around in accordance with the configured numerology in use

e.g.

for m = 3 the wrap around would be mod 80

** 80 is the number of slots per system frame for 120 kHz SCS

(Debug) Timing Information

Additional timing information might be present in the APIs between MAC and scheduler to help troubleshoot issues. This is an optional information element in the APIs below. This timing information is defined below.

Table 99 Debug timing information

Element

Presence

Description

SFN

M

System Frame number {0…1023}

Slot

M

Slot number {0…319} per 38.211 and FAPI specification

This value wraps around in accordance with the configured numerology in use

e.g.

for m = 3 the wrap around would be mod 80

** 80 is the number of slots per system frame for 120 kHz SCS

System Time Stamp

M

Time Stamp of the system; equivalent to Linux timeval structure (tv_sec, tv_usec)

MAC to Scheduler APIs

Cell Configuration Request

When MAC layer receives configuration to create a new cell, this API is invoked.

Table 910 Cell Configuration Request

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Physical Cell Identity

M

PCI per TS 38.331

Duplex Mode

M

FDD or TDD mode of operation for the cell

DL Cell Bandwidth

M

Total DL Cell Bandwidth

UL Cell Bandwidth

M

Total UL Cell Bandwidth

downlinkConfigCommon

M

See TS 38.331 ServingCellConfigCommonSIB

>frequencyInfoDL

M

See TS 38.331 FrequencyInfoDL-SIB

>initialDownlinkBWP

M

See TS 38.331 DownlinkConfigCommonSIB

>BCCH-Config

M

See TS 38.331 DownlinkConfigCommonSIB

>PCCH-Config

M

See TS 38.331 DownlinkConfigCommonSIB

uplinkConfigCommon

M

See TS 38.331 ServingCellConfigCommonSIB

tdd-UL-DL-ConfigurationCommon

M

See TS 38.331 ServingCellConfigCommonSIB

>initialUplinkBWP

M

See TS 38.331 UplinkConfigCommonSIB

SSB PositionsInBurst

M

See TS 38.331  ssb-PositionsInBurst

SSB periodicityServingCell

M

See TS 38.331 ssb-periodicityServingCell

DMRS TypeA Position

M

See TS 38.331 dmrs-TypeA-Position

SSB Subcarrier Spacing

M

See TS 38.331 ssbSubcarrierSpacing

PDCCH Config SIB1

M

See TS 38.331 pdcch-ConfigSIB1

SS PBCH BlockPower

M

See TS 38.331 ss-PBCH-BlockPower

Cell Delete Request

When MAC layer receives configuration to create a new cell, this API is invoked.

Table 911 Cell Delete Request

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Add UE Configuration Request

This API is invoked by MAC layer to create a new UE in the scheduler, including the details of logical channels associated with the UE.

Table 912 Add UE Configuration Request

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value. Allocated by MAC.

CRNTI shall be included only in case of SA

mac-CellGroupConfig (schedulingRequestConfig, tag-Config, phr-Config)

M

See TS 38.331 MAC-CellGroupConfig

physicalCellGroupConfig (pdsch-HARQ-ACK-Codebook, p-NR-FR1)

M

See TS 38.331 PhysicalCellGroupConfig

spCellConfig

M

See TS 38.331 SpCellConfig

>servCellIndex

M

See TS 38.331 ServCellIndex

>ServingCellConfigInfo

M

See TS 38.331 ServingCellConfig

>>initialDownlinkBWP (pdcch-Config, pdsch-Config)

M

See TS 38.331 BWP-DownlinkDedicated in ServingCellConfig.

>>Number of DL BWP To Add

M

The number of dedicated DL BWP To Add

>>downlinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Downlink in ServingCellConfig

>>firstActiveDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>defaultDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>bwp-InactivityTimer

M

See TS 38.331 ServingCellConfig

>>pdcch-ServingCellConfig (maxMIMO-Layers, nrofHARQ-ProcessesForPDSCH, codeBlockGroupTransmission, xOverhead)

M

See TS 38.331 PDCCH-ServingCellConfig in ServingCellConfig

>>initialUplinkBWP (pucch-Config, pusch-Config)

M

See TS 38.331 BWP-UplinkDedicated in ServingCellConfig

>>Number of UL BWP To Add

M

The number of UL BWP To Add

>>uplinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Uplink in ServingCellConfig

>>firstActiveUplinkBWP-Id

M

See TS 38.331 ServingCellConfig

UE Aggregate Maximum Bit Rate Downlink

M

See TS 38.413 UE Aggregate Maximum Bit Rate Downlink

UE Aggregate Maximum Bit Rate Uplink

M

See TS 38.473 gNB-DU UE Aggregate Maximum Bit Rate Uplink

Number of LC To Add

M

The number of Logical Channel To Add

>logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

>Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT SETUP REQUEST

>S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT SETUP REQUEST

>DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

>UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

Modify UE Reconfiguration Request

MAC layer invokes this API to modify an existing UE context also to add/release/modify existing logical channels.

Table 913 Modify UE Reconfiguration Request

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

CRNTI

M

See TS 38.331 RNTI-Value

mac-CellGroup-Reconfig (schedulingRequest-Reconfig, tag-Reconfig)

M

See TS 38.331 MAC-CellGroupConfig

physicalCellGroup-Reconfig (pdsch-HARQ-ACK-Codebook, p-NR-FR1)

M

See TS 38.331 PhysicalCellGroupConfig

spCell-Reconfig

M

See TS 38.331 SpCellConfig

>servCellIndex

M

See TS 38.331 ServCellIndex

>ServingCell-ReconfigInfo

M

See TS 38.331 ServingCellConfig

>>initialDownlinkBWP-Reconfig (pdcch-Config, pdsch-Config)

M

See TS 38.331 BWP-DownlinkDedicated in ServingCellConfig

>>Number of DL BWP To Add or Modify

M

The number of dedicated DL BWP To Add or Modify

>>downlinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Downlink in ServingCellConfig

>>Number of DL BWP To Release

M

The number of dedicated DL BWP to remove

>>downlinkBWP-ToReleaseList (bwp-Id)

M

See TS 38.331 downlinkBWP-ToReleaseList in ServingCellConfig

>>firstActiveDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>defaultDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>bwp-InactivityTimer

M

See TS 38.331 ServingCellConfig

>>pdcch-ServingCell-Reconfig (maxMIMO-Layers, nrofHARQ-ProcessesForPDSCH, codeBlockGroupTransmission, xOverhead)

M

See TS 38.331 PDCCH-ServingCellConfig

>>initialUplinkBWP-Reconfig (pucch-Config, pusch-Config)

M

See TS 38.331 BWP-UplinkDedicated in ServingCellConfig

>>Number of UL BWP To Add or Modify

M

The number of dedicated UL BWP To Add or Modify

>>uplinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Uplink in ServingCellConfig

>>Number of UL BWP To Release

M

The number of dedicated UL BWP To remove

>>uplinkBWP-ToReleaseList (bwp-Id)

M

See TS 38.331 uplinkBWP-ToReleaseList in ServingCellConfig

>>firstActiveUplinkBWP-Id

M

See TS 38.331 ServingCellConfig

Number of LC To Add

M

The number of Logical Channel to Add

logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT MODIFICATION REQUEST

S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT MODIFICATION REQUEST

DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

Number of LC To Delete

M

The number of Logical Channel to Delete

>logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

>Number of LC To Modified

M

The number of Logical Channel To Modified

>Logical Channel Identity

M

See TS 38.331 logicalChannelIdentity

>Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT MODIFICATION REQUEST

>S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT MODIFICATION REQUEST

>DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

>UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

Delete UE Request

MAC indicates to Scheduler to Delete an existing UE using this API.

Table 914 Delete UE Request

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

DL HARQ Indication

MAC informs Scheduler on reception and Decoding of received DL HARQ feedback from the UE. Feedback itself might have been received either on PUSCH or PUCCH, decoding of feedback is done at MAC/L1.

Table 915 DL HARQ Indication

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

Number of HARQ feedback Reported

M

Number of HARQ feedback bits reported

>harq payload bits

M

Bitmap of length = MAX_HARQ_BITS per 38.213

UL HARQ (CRC) Indication

This API is invoked by MAC to inform Scheduler the CRC decode results of PUSCH.

Table 916 UL HARQ (CRC) Indication

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

Number of CRC Indication Reported

M

Number of CRC Indication reported

>CRC Indication

M

{0...MAX_NUMBER_OF_CRC_IND_BITS} for UL SISO there would be just 1 bit

0 : PASS

1 : FAILURE

For the case of UL MIMO 1 bit per TB would convey the feedback

UL Channel Quality Information

MAC informs Scheduler using this API the UL Channel Quality Indication of PUSCH/PUCCH

Table 917 UL Channel Quality Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

Number of UL CQI Indication Reported

M

Number of UL CQI Indication reported

>Type of Report

M

{PUCCH, PUSCH}

>UL_CQI

M

0-255 in steps of 0.5 dB {-64 dB, … 63 dB}

>Timing Advance

M

TA measured for 38.213 section 4.2

DL Channel Quality Information

This API is invoked by MAC to report to Scheduler the DL Channel Quality delivered on PUSCH/PUCCH

Table 918 DL Channel Quality Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

Number of DL CQI Indication Reported

M

Number of UL CQI Indication reported

>Type of Report

M

Bitmap for CQI, PMI, RI, CRI report

> CQI

O

CQI report on PUCCH/PUSCH

>PMI

O

PMI report on PUCCH/PUSCH

>CRI

O

CQI report on PUCCH/PUSCH

>RI

O

RI report on PUCCH/PUSCH

RACH Indication Contents

MAC receives the RACH Indication and shares the contents with the scheduler.

Table 919 RACH Indication Contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

Slot Index

M

Index of the First Slot where RACH was detected

Symbol Index

M

Index of the first OFDM Symbol where RACH was detected

Frequency Index

M

Index of the Frequency where RACH was detected. 38.211

Preamble ID

M

Preamble ID that was detected

Timing Advance

M

Timing Advance that was detected and reported to MAC

Paging Indication Contents

MAC indicates Paging message (F1AP Paging) contents to scheduler.

Table 920 Paging Indication Contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this particular message.

UE Paging ID

M

Paging ID sent from AMF, used to calculate the paging occasions per 38.304

Paging DRX

M

Defined per 38.413 and 38.304

Number of Paging Retries

O

Number of times the paging message is to be transmitted. This decision shall be a higher/RRM decision hence relayed to Scheduler.

Paging message

M

Bit string. Paging message need to transfer

RACH Resource Request

When contention free random access is initiated by a UE, MAC shares the CRNTI and SSB resource allocation information with the scheduler through this API.

Table 921 RACH Resource Request

Element

Presence

Description

Frame Number

M

Time indication

Slot Number

M

Time indication

Cell Index

M

Identification of the Cell

CRNTI

M

The CRNTI allocated by MAC for the UE

Number of SSB

M

The number of ssb for which CFRA resource allocation is requested.

>ssb

M

See TS 38.331 SSB-Index

RACH Resource Release

MAC indicates to scheduler through this API when RACH resources associated with a UE have to be released.

Table 922 RACH Resource Release

Element

Presence

Description

Frame Number

M

Time indication

Slot Number

M

Time indication

Cell Index

M

Identification of the Cell

CRNTI

M

The CRNTI allocated by MAC for the UE

CFRA-SSB-Resource

M

See TS 38.331 CFRA-SSB-Resource

>Ssb index

M

See TS 38.331 SSB-Index

>ra preamble index

M

The RA preamble index to be used in the RA occasions associated with this SSB.

DL RLC Buffer Status Information

This API is used by RLC for reporting data volume per UE for multiple LCs. This can be used in two different ways depending on the QoS/latency requirements.

Data Volume reports are aggregated per UE (at an aggregation point such as slot indication)

This adds latency however it reduces message exchange traffic between SCHED and MAC

Data Volume is reported per LC as soon as it is received at MAC

This adds to the message exchange traffic however it would be perfect for Low Latency Usecases

Implementor of this API can choose either one of the above approaches.

Table 923 DL RLC Buffer Status Information

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Number of DL LCs to be Reported

M

Number of LC for which DL Buffer Occupancy/Data Volume is being reported

>logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity

>> dataVolume

M

Integer representing number of Cumulative Bytes for the logical channel

Scheduling Request Indication

MAC indicates to scheduler through this API when UE  has to be scheduled for uplink grant.

Table 924 Scheduling Request Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this particular message.

Number of SR Bits

M

{0..7} number of SR bits reported

SR Payload

M

Bitmap equal to the MAX_SR_BIT

UL Buffer Status Report Indication

This API is invoked by MAC on reception and Decoding of received BSR from the UE.

Table 925 Buffer Status Report Indication

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

BSR Type

M

Enumeration of {SHORT_BSR, LONG_BSR, SHORT_TRUNCATED_BSR, LONG_TRUNCATED_BSR}

Number of UL LCGs Reported

M

Number of UL LCGs carried in the BSR

>logicalChannelGroupId

M

{0...7} logical channel Group identity

>> dataVolume

M

Integer representing number of reported Bytes

Power Headroom Indication

MAC invokes this API to inform Scheduler on reception and decoding of received PHR from the UE.

Table 926 Power Headroom Indication

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

PHR Type

M

Enumeration of {SINGLE_ENTRY_PHR, MULTIPLE_ENTRY_PHR}

>Single Entry PHR

O

Present if the PHR Type == SINGLE_ENTRY_PHR

>>Power Head Room

M

1 Byte – Reported Power Head Room as per 38.321 Section 6.1.3.8

>> PCMAX,f,c

M

This field indicates the PCMAX,f,c (as specified in TS 38.213) used for calculation of the preceding PH field.

>Multiple Entry PHR

O

Present if PHR Type == MULTIPLE_ENTRY_PHR

>>Number of Reports

M

Number of PHRs reported in this instance. Range as specified in TS 38.321

>>PH Type

M

Enumeration {PH_TYPE_1, PH_TYPE_2}

>>>Power Head Room

M

1 Byte – Reported Power Head Room as per 38.321 Section 6.1.3.8

>>> PCMAX,f,c

M

This field indicates the PCMAX,f,c (as specified in TS 38.213) used for calculation of the preceding PH field.

Scheduler to MAC APIs

Cell Configuration Response

This API is invoked by scheduler to respond to a Cell configuration request.

Table 927 Cell Deletion Response

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Response

M

Response that maybe used to identify failure/success

OK – Success

NOK – Failure

Error Cause

O

If Response == NOK

This field describes the cause of the failure.

Cell Deletion Response

This API is invoked by scheduler to respond to a Cell Deletion request.

Table 928 Cell Deletion Response

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Response

M

Response that maybe used to identify failure/success

OK – Success

NOK – Failure

Error Cause

O

If Response == NOK

This field describes the cause of the failure.

UE Reconfiguration Response

This response API is used by scheduler to respond to a UE reconfiguration request from MAC.

Table 929 UE Configuration Response

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Response

M

Response that maybe used to identify failure/success

OK – Success

NOK – Failure

Error Cause

O

If Response == NOK

This field describes the cause of the failure.

UE Deletion Response

Scheduler responds with this API to a UE deletion request from MAC.

Table 930 UE Deletion Response

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Response

M

Response that maybe used to identify failure/success

OK – Success

NOK – Failure

Error Cause

O

If Response == NOK

This field describes the cause of the failure.

DL Scheduling Information

Scheduler provides scheduling information for a given TTI for downlink data. Scheduling information contains time and frequency domain resources to be scheduled with a list of logical channels and TBS opportunity per LC. Additionally, SCH also provides a list of MAC CEs that are scheduled for a specific transmission opportunity. MAC is supposed to encode these CEs into the MAC PDU.

Table 931 DL Scheduling Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this message.

HARQ Process ID

M

4 bits; identifies the HARQ Process being used for this transmission

Frequency Domain Allocation

M

Frequency Domain resource assignment; as defined in 38.214

>resource allocation type

M

{Type-0, Type-1} from 38.214

>resourceAllocationType-0

O

Conditional presence on the resource allocation type value

>>rbBitMap

M

Resource allocation Type-0 bit map

>resourceAllocationType-1

O

Conditional presence on the resource allocation type value

>>Start RB

M

Starting Resource Block for the allocation

>>Number of RBs

M

Number of allocated Resource Blocks

Time Domain Allocation

M

Specifies the time domain allocation for this transmission

>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…14}

Number of TBs

M

Number of scheduled Transport Blocks {1…2}

TB1

M

Transport Block # 1

>MCS

M

{0…31} per 38.214

>NDI

M

New Data Indicator (toggled if a new transmission)

>RV

M

Redundancy Version {0, 2, 3, 1} per 38.212

>TB Size

M

Transport Block Size in Bytes {0…65535}

>Number of DL CEs Scheduled

M

Number of DL CEs Scheduled {0…32}

>>CE Content

M

Information for the CE, carried in non-encoded format.

Refer the table below for details

>Number of DL LCs Scheduled

M

Number of DL LCs Scheduled {0…32}; includes both SRBs and DRBs

>>DL LCID

M

DL LCs ID {0…32}

>>Number of Scheduled Bytes

M

Number of Scheduled Bytes for this specific Logical Channel

{0…65535}

TB2

O

Transport Block # 2

>MCS

M

{0…31} per 38.214

>NDI

M

New Data Indicator (toggled if a new transmission)

>RV

M

Redundancy Version {0, 2, 3, 1} per 38.212

>TB Size

M

Transport Block Size in Bytes {0…65535}

>Number of DL CEs Scheduled

M

Number of DL CEs Scheduled {0…32}

>>CE LCID

M

Corresponds to CEs LCID as per 38.321

>>CE Content

M

Byte Array [MAX_BYTES_PER_CE]; this carries the CE content (not encoded) that Scheduler wants to transmit to the UE. MAC shall take this content and encode per the formats defined in 38.321

>Number of DL LCs Scheduled

M

Number of DL LCs Scheduled {0…32}; includes both SRBs and DRBs

>>DL LCID

M

DL LCs ID {0…32}

>>Number of Scheduled Bytes

M

Number of Scheduled Bytes for this specific Logical Channel

{0…65535}

Table 932 MAC CE information

Element

Presence

Description

CE LC_ID

M

Corresponds to CEs LCID as per 38.321

Contention Resolution Identity CE

O

If LC_ID corresponds to UE Contention Resolution Identity CE. No content is sent from Scheduler to MAC as the contents of Msg3 are to be buffered at MAC

Timing Advance Command CE

O

If LC_ID corresponds to Timing Advance Command CE

>TAG ID

M

Timing Advance Group ID as per 38.321

>Timing Advance

M

Index value of TA per 38.321 and 38.213

SCell Activation/Deactivation CE

O

If LC_ID Corresponds to SCell Activation/Deactivation CE

>Number of SCells

M

Number of SCells being addressed in this IE

>act_deact_val[MAX_NUMBER OF_SCELLS]

M

An Array of values corresponding to the index of the SCell as configured per 38.331.

Value at each index i corresponds to

0 – Deactivation

1 – Activation

MAX_NUMBER_OF_SCELL = 31 per 38.321 current specification, subject to change with newer specification versions.

UL Scheduling Information

Scheduler provides Scheduled information to MAC to enable MAC to form the UL_TTI.request towards L1. This is akin to a reception request towards L1 to allow L1 to receive scheduled PUSCH, PUCCH, and SRS data for a specific UE.

Table 933 UL Scheduling Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Timing Information

M

Timing information for this particular message.

Data Type

M

{PUSCH, PUSCH_UCI, UCI, SRS}

PUSCH Information

O

Present if Data Type == PUSCH

>HARQ Process ID

M

4 bits; identifies the HARQ Process being used for this transmission

>Frequency Domain Allocation

M

Frequency Domain resource assignment; as defined in 38.214

>>resource allocation type

M

{Type-0, Type-1} from 38.214

>>resourceAllocationType-0

O

Conditional presence on the resource allocation type value

>>>rbBitMap

M

Resource allocation Type-0-bit map

>>resourceAllocationType-1

O

Conditional presence on the resource allocation type value

>>>Start RB

M

Starting Resource Block for the allocation

>>>Number of RBs

M

Number of allocated Resource Blocks

>Time Domain Allocation

M

Specifies the time domain allocation for this transmission

>>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…14}

>TB

M

Transport Block # 1

>>MCS

M

{0…31} per 38.214

>>NDI

M

Set if New Transmission

>>RV

M

Redundancy Version {0, 2, 3, 1} per 38.212

>>TB Size

M

Transport Block Size in Bytes {0…65535}

PUSCH_UCI

O

Present if Data Type == PUSCH_UCI

>HARQ Process ID

M

4 bits; identifies the HARQ Process being used for this transmission

>Frequency Domain Allocation

M

Frequency Domain resource assignment; as defined in 38.214

>>resource allocation type

M

{Type-0, Type-1} 38.214

>>resourceAllocationType-0

O

Conditional presence on the resource allocation type value

>>>rbBitMap

M

Resource allocation Type-0-bit map

>>resourceAllocationType-1

O

Conditional presence on the resource allocation type value

>>>Start RB

M

Starting Resource Block for the allocation

>>>Number of RBs

M

Number of allocated Resource Blocks

>Time Domain Allocation

M

Specifies the time domain allocation for this transmission

>>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…14}

>TB

M

Transport Block # 1

>>MCS

M

{0…31} per 38.214

>>NDI

M

Set if New Transmission

>>RV

M

Redundancy Version {0, 2, 3, 1} per 38.212

>>TB Size

M

Transport Block Size in Bytes {0…65535}

>HARQ_INFO

O

Present if HARQ feedback is expected and is multiplexed along with PUSCH

>>HARQ_Bits

M

Number of HARQ ACK Bits expected

>>betaOffsetHarqACK

M

Beta Offset for HARQ-ACK per 38.212

>CSI_INFO

O

Present if CSI feedback is expected and is multiplexed along with PUSCH

>>csiBits

M

Number of CSI bits

>>betaOffsetCSI

M

Beta Offset for CSI per 38.212

UCI

O

Present if Data Type == UCI

>Frequency Domain allocation

M

Frequency domain location of PUCCH

>>Start RB

M

Starting Resource Block for the allocation

>>Number of RBs

M

Number of allocated Resource Blocks

>Time Domain Allocation

M

Specifies the time domain allocation for this transmission

>>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…2} for format 0, 2

{4…14} for format 1, 3, 4

>SR Flag

O

Set if SR is expected in the scheduled slot

>HARQ_INFO

O

Present if HARQ feedback is expected and is multiplexed along with PUSCH

>>HARQ_Bits

M

Number of HARQ ACK Bits expected

>CSI_INFO

O

Present if CSI feedback is expected and is multiplexed along with PUSCH

>>csiBits

M

Number of CSI bits

RAR Information

This API is invoked by scheduler to inform MAC of uplink scheduling and Msg3 scheduling information.

Table 934 RAR Information

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Timing Information

M

Timing information for this message.

RA_RNTI

M

RA_RNTI corresponding to the received RACH

Number of Preambles

M

Number of Preambles that were received for the RA_RNTI

>RAPID

M

Preamble ID

>Timing Advance Value

M

Initial Timing Advance

>Start RB

M

Starting Resource Block for the PUSCH Allocation

>Number of RBs

M

Number of allocated Resource Blocks for the PUSCH Allocation

>Temporary CRNTI

M

Temporary CRNTI allocated by Scheduler

Downlink Control Channel Information

Scheduler provides DCI scheduling information for a given TTI on PDCCH. Scheduling information contains Coreset and Search Space resource allocation. MAC is supposed to prepare the DCI payload with the Downlink control channel information and DL/UL Scheduling Information Frequency and Time Domain allocation for the UE.

Table 935 Downlink Control Channel Information

Element

Presence

Description

Frame Number

M

Time indication. Frame Number where DCI is scheduled

Slot Number

M

Time indication. Slot Number where DCI is scheduled

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

CRNTI

M

See TS 38.331 RNTI-Value

Frequency Domain Resources

M

Frequency domain resources for the CORESET as defined in 38.211 section 7.3.2.2

Duration

M

time duration of the CORESET in number of symbols as defined in 38.211 section 7.3.2.2

CCE REG Mapping type

M

{interleaved, nonInterleaved}. as defined in 38.211 section 7.3.2.2

>interleaved

O

Conditional presence on the CCE REG Mapping type value

>> reg Bundle Size

M

{2, 3, 6}.  Size of REG Bundles as defined in 38.211 section 7.3.2.2

>>interleaver Size

M

{2, 3, 6}.  Interleaver Size as defined in 38.211 section 7.3.2.2

>>shift Index

M

shiftIndex or Physical Cell Id as defined in 38.211 section 7.3.2.2

Search Space Start Symbol

M

first symbol for PDCCH monitoring in the slot; as defined in 38.213 section 10.1.

CCE Index

M

First CCE index in the aggregation level as defined in 38.211 section 7.3.2.2

Aggregation Level

M

{1,2,4,8,16}. as defined in 38.213 Table 10.1-1

Precoder Granularity

M

{sameAsRegBundle, allContigousRBs}; as defined in 38.211 section 7.3.2.2

PDCCH Power Offset

M

-8 to 8 dB in 1dB steps. SSB/PBCH EPRE to PDCCH and PDCCH DMRS EPRE; as defined in 38.213 section 4.1

DCI Format type

M

{format_0_0, format_0_1, format_1_0, format_1_1}; as defined in 38.212 section 7.3.1

> Format_1_0

O

Conditional presence on the DCI Format type value

>>VRB to PRB Mapping

M

Physical resource block Bundling as defined in 38.214 section 5.1.2.3

>>DAI

M

Downlink Assignment Index as defined in as defined in 38.213 section 9.1.2

>> TPC Command

M

PUCCH TPC as defined in 38.213 section 7.2.1

>>PUCCH Resource Indicator

M

Resource for reporting HARQ-ACK as defined in 38.213 section 9.2.3

>> PDSCH to Harq Feedback Timing Indicaor

M

Timing for reporting HARQ-ACK as defined in 38.213 section 9.2.3

> Format_1_1

O

Conditional presence on the DCI Format type value

>>Carrier Indicator

O

Conditional presence on CrossCarrierSchedulingConfig support; as defined in 38.213 section 10.1

>>BWP Indicator

O

Conditional presence on dedicated DL BWP Config; as defined in 38.213 section 12

>>VRB to PRB Mapping

O

Conditional presence on RAT type and interleaved VRB-to-PRB mapping configuration.Physical resource block Bundling as defined in 38.214 section 5.1.2.3

>>PRB bundling size indicator

O

Conditional presence on prb-BundlingType; as defined in 38.214 section 5.1.2.3

>> Rate Matching Indicator

O

Conditional presence on rateMatchPatternGroup Config; as defined in 38.214 section 5.1.4.1

>>ZP CSI-RS trigger

O

Conditional presence on zp-CSI-RS-Resource Config; as defined in 38.214 section 5.1.4.2

>>DAI

O

Downlink Assignment Index as defined in as defined in 38.213 section 9.1.2

>> TPC Command

M

PUCCH TPC as defined in 38.213 section 7.2.1

>>PUCCH Resource Indicator

M

Resource for reporting HARQ-ACK as defined in 38.213 section 9.2.3

>> PDSCH to HARQ Feedback Timing Indicaor

O

Timing for reporting HARQ-ACK as defined in 38.213 section 9.2.3

>> Transmission configuration indication

O

Conditional presence on tci-PresentInDCI Config as defined in 38.214 section 5.1.5

>> SRS Request

M

Request for SRS Reporting as defined in 38.212 Table 7.3.1.1.2-24

>>CBG transmission information

O

Conditional presence on Max CBG per TB config as defined in 38.214 section 5.1.7

>>CBG flushing out information

O

Conditional presence on CBG Flush Indicator config as defined in 38.214 section 5.1.7

>>DMRS sequence initialization

M

DM-RS sequence initialization field as defined in 38.211 section 7.4.1.1.1

> Format_0_0

O

Conditional presence on the DCI Format type value

>>PUSCH Hopping

O

Conditional presence on Frequency Hopping offset Config; as defined in 38.214 section 6.3

>>Frequency Hopping Flag

M

PUSCH Frequency Hopping as defined in 38.214 section 6.3

>>TPC Command

M

PUSCH TPC value as defined in 38.213 section 7.1

>>UL/SUL Indicator

O

Conditional Presence based on supplementaryUplink; as defined in 38.331 ServingCellConfig

> Format_0_1

O

Conditional presence on the DCI Format type value

>>Carrier Indicator

O

Conditional presence on Cross Carrier Scheduling Config support; as defined in 38.213 section 10.1

>>UL/SUL Indicator

O

Conditional Presence based on supplementaryUplink; as defined in 38.331 ServingCellConfig

>>BWP Indicator

O

Conditional presence on dedicated UL BWP Config; as defined in 38.213 section 12

>>PUSCH Hopping

O

Conditional presence for RAT1 on Frequency Hopping offset Config; as defined in 38.214 section 6.3

>>Frequency Hopping Flag

O

Conditional presence for RAT1 as defined in 38.214 section 6.3

>>TPC Command

M

PUSCH TPC value as defined in 38.213 section 7.1

>>SRS Resource Indicator

O

Conditional presence on SRS Resource Config; as defined in 38.331 PUSCH-Config and 38.212 Table 7.3.1.1.2- 28 to 7.3.1.1.2-32

>>Precoding Information and Number of Layers

O

Conditional presence on txConfig and antenna ports configuration; as defined in 38.331 PUSCH-Config and 38.212 Table 7.3.1.1.2- 2 to 7.3.1.1.2-5

>> SRS Request

M

Request for SRS Reporting as defined in 38.212 Table 7.3.1.1.2-24

>>CSI request

O

Conditional presence on report Trigger Size configuration; as defined in 38.331 CSI-MeasConfig

>>CBG transmission information

O

Conditional presence on Max CBG per TB config as defined in 38.214 section 5.1.7

>>Beta Offset Indicator

O

Conditional presence on betaOffsets configuration as defined in 38.213

>>DMRS Sequence Initialization

O

Conditional presence on transform Precoding; as defined in 38.211 section 6.4.1.1.1

>>UL SCH Indicator

M

UL SCH transmitted on PUSCH or not.

Downlink Broadcast Allocation

Scheduler provides DCI and DL data scheduling information for SSB and System Information Block1 and Other System Information for a given TTI for Broadcast Channel. MAC shall form the SSB and SI payload.

Table 936 Downlink Broadcast Allocation

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Frame Number

M

Time indication. Frame Number where Broadcast data is scheduled

Slot Number

M

Time indication. Slot Number where Broadcast data is scheduled

SSB Index

M

Index of SSB corresponding to the Broadcast data; For SIB1 as defined in 38.213 section 13. For other SI as defined in 38.331 section 5.2.2.3.2

DL DCI

O

Specifies the DL DCI Coreset and Search Space for Scheduling DCI for Broadcast data.

DL SCH

O

Specifies the DL PDSCH for Broadcast data.

>System information indicator

M

{0 – 1}. Specifies SIB1 or SI message; as defined in 38.212 Table 7.3.1.2.1-2

>SI Content

M

Byte Array [MAX_BYTES_FOR_SI]; this carries the ASN.1  encoded System Information Messages that Scheduler wants to transmit to the UE;  as defined in 38.331 SIB1 or SystemInformation. Maximum TB size is 2976 bytes as per 38.214 section 5.1.3.2

SSB Information

O

Carries the SSB Information

>ssbSubcarrierOffset

M

kssb as per 38.211

>ssbOffsetPointA

M

Offset of the lowest RB per 38.211

DL DCI Information:

Element

Presence

Description

DL DCI

M

Specifies the DL DCI Coreset and Search Space for Scheduling DCI for Broadcast data.

>Frequency Domain Resources

M

Frequency domain resources for the CORESET as defined in 38.211 section 7.3.2.2

>duration

M

time duration of the CORESET in number of symbols as defined in 38.211 section 7.3.2.2

>CCE REG Mapping type

M

{interleaved, nonInterleaved}. For SIB1 only interleaved mapping type is applicable as defined in 38.211 section 7.3.2.2

>>interleaved

O

Conditional presence on the CCE REG Mapping type value

>>> reg Bundle Size

M

{2, 3, 6}.  Size of REG Bundles as defined in 38.211 section 7.3.2.2

>>>interleaver Size

M

{2, 3, 6}.  Interleaver Size as defined in 38.211 section 7.3.2.2

>>>shift Index

M

shiftIndex or Physical Cell Id as defined in 38.211 section 7.3.2.2

>Search Space Start Symbol

M

monitoringSymbolsWithinSlot. For SIB1 as defined in 38.213 section 13. For other SI as defined in 38.213 section 10.1.

> CCE Index

M

First CCE index in the aggregation level as defined in 38.211 section 7.3.2.2

>Aggregation Level

M

{4,8,16}. as defined in 38.213 Table 10.1-1

> Precoder Granularity

M

{sameAsRegBundle, allContigousRBs} as defined in 38.211 section 7.3.2.2

>pdcch Power Offset

M

-8 to 8 dB in 1dB steps. SSB/PBCH EPRE to PDCCH and PDCCH DMRS EPRE; as defined in 38.213 section 4.1

DL DSCH Information

Element

Presence

Description

DL SCH

O

Conditional presence on Short Message Indicator value. Present in case Short Message Indicator is 1 or 3; as defined in 38.212 Table 7.3.1.2.1-1

>Frequency Domain Allocation

M

RAT1 Frequency Domain resource assignment; as defined in 38.214 section 5.1.2.2.2

>>Start RB

M

Starting Resource Block for the allocation

>>Number of RBs

M

Number of allocated Resource Blocks

>Time Domain Allocation

M

Specifies the time domain allocation for this transmission; as defined in 38.214 section 5.1.2.1

>>Mapping Type

M

{typeA, typeB}

>>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…14}

>DMRS Config

M

Specifies downlink demodulation reference signals for PDSCH; as defined in 38.214 section 5.1.6.2

>>DMRS Type

M

DMRS type to be used for DL

>>DMRS Additional Pos

M

Position for additional DM-RS in DL

>>Max Length

M

The maximum number of OFDM symbols for DL front loaded DMRS

>VRB-to-PRB mapping

M

Specifies Non-Interleaved or Interleaved VRB-to-PRB mapping; as defined in 38.214 section 5.1.2.3.

>TB

M

Transport Block as defined in 38.214 section 5.1.3.

>>MCS

M

{0…9}

>>TB Size

M

Transport Block Size in Bytes

>TB Scaling

M

Scaling factor {0 – 2} as defined in 38.214 section 5.1.3.2.

Downlink Paging Allocation

Scheduler provides DCI and optionally DL data scheduling information for Paging Message for given TTI for Paging Channel.

Table 937 Downlink Paging Allocation

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by DU

Frame Number

M

Time indication. Frame Number where Paging data is scheduled

Slot Number

M

Time indication. Slot Number where Paging data is scheduled

SSB Index

M

Index of SSB corresponding to the Paging data; as defined in 38.304 section 7.1

Short Message Indicator

M

{0-3}; as defined in 38.212 Table 7.3.1.2.1-1: Short Message indicator

Short Message

O

8 bits; as defined in 38.331 section 6.5. Conditional presence on Short Message Indicator value

DL DCI

M

Specifies the DL DCI Coreset and Search Space for Scheduling DCI for Paging data.

>Frequency Domain Resources

M

Frequency domain resources for the CORESET as defined in 38.211 section 7.3.2.2

>Duration

M

time duration of the CORESET in number of symbols as defined in 38.211 section 7.3.2.2

>CCE REG Mapping type

M

{interleaved, nonInterleaved}; as defined in 38.211 section 7.3.2.2

>>interleaved

O

Conditional presence on the CCE REG Mapping type value

>>> reg Bundle Size

M

{2, 3, 6}.  Size of REG Bundles as defined in 38.211 section 7.3.2.2

>>>interleaver Size

M

{2, 3, 6}.  Interleaver Size as defined in 38.211 section 7.3.2.2

>>>shift Index

M

shiftIndex or Physical Cell Id as defined in 38.211 section 7.3.2.2

>Search Space Start Symbol

M

monitoringSymbolsWithinSlot as defined in 38.213 section 10.1.

> CCE Index

M

First CCE index in the aggregation level as defined in 38.211 section 7.3.2.2

>Aggregation Level

M

{4,8,16}. as defined in 38.213 Table 10.1-1

> Precoder Granularity

M

{sameAsRegBundle, allContigousRBs} as defined in 38.211 section 7.3.2.2

>PDCCH Power Offset

M

-8 to 8 dB in 1dB steps. SSB/PBCH EPRE to PDCCH and PDCCH DMRS EPRE; as defined in 38.213 section 4.1

DL SCH

O

Conditional presence on Short Message Indicator value. Present in case Short Message Indicator is 1 or 3; as defined in 38.212 Table 7.3.1.2.1-1

>Frequency Domain Allocation

M

RAT1 Frequency Domain resource assignment; as defined in 38.214 section 5.1.2.2.2

>>Start RB

M

Starting Resource Block for the allocation

>>Number of RBs

M

Number of allocated Resource Blocks

>Time Domain Allocation

M

Specifies the time domain allocation for this transmission; as defined in 38.214 section 5.1.2.1

>>Mapping Type

M

{typeA, typeB}

>>Start Symbol Index

M

Specifies the index of the starting symbol of the allocation

{0…13}

>>Number of Symbols

M

Specifies the number of contiguous symbols allocated for this transmission

{1…14}

>DMRS Config

M

Specifies downlink demodulation reference signals for PDSCH; as defined in 38.214 section 5.1.6.2

>>DMRS Type

M

DMRS type to be used for DL

>>DMRS Additional Pos

M

Position for additional DM-RS in DL

>>Max Length

M

The maximum number of OFDM symbols for DL front loaded DMRS

>VRB-to-PRB mapping

M

Specifies Non-Interleaved or Interleaved VRB-to-PRB mapping; as defined in 38.214 section 5.1.2.3.

>TB

M

Transport Block as defined in 38.214 section 5.1.3.

>>MCS

M

{0…9}

>>TB Size

M

Transport Block Size in Bytes

>TB Scaling

M

Scaling factor {0 – 2} as defined in 38.214 section 5.1.3.2.

>Paging Content

M

Byte Array [MAX_BYTES_FOR_PAGING]; this carries the ASN.1 encoded Paging Messages that Scheduler wants to transmit to the UE’s; as defined in 38.331 Paging

F1AP handler – MAC Interface

The following section captures the interface APIs between F1AP handler and MAC:

Table 938 F1AP handler –MAC Cell Specific API

Note: Cell State Manager in the F1AP module interfacing with MAC

Direction

Message/API

Description

F1AP handler to MAC

Cell Start

This API is used to start the Cell at MAC, i.e., to start broadcasting the system information. MAC starts the cell at L1 before sending the confirmation to the F1AP handler.

F1AP handler to MAC

Cell Stop

This API is used to stop the broadcast at MAC, i.e., to stop broadcasting the system information. MAC stops the cell at L1 before sending the confirmation to the F1AP handler. MAC may also delete the cell configuration at SCH in which case it needs to configure the SCH with stored cell configuration before the start of the cell.

Table 939 F1AP handler - MAC UE Specific APIs

Note: UE State Manager in the F1AP module interfacing with MAC will be the module interacting with MAC for the following APIs.

Direction

Message/API

Description

F1AP handler to MAC

UE Create Request

This API adds the UE information, such as, BWP, channel information, etc, at MAC.

MAC to F1AP handler

UE Create Response

This API is used to acknowledge the status of the UE Create Request.

F1AP handler to MAC

UE Reconfiguration Request

This API is used to reconfigure the UE information, such as, BWP, channel information, etc, at MAC. MAC returns an error if the UE has not been already added at MAC.

MAC to F1AP handler

UE Reconfiguration Response

This API is used to acknowledge the status of the UE Reconfiguration Response.

F1AP handler to MAC

UE Delete Request

This API is used to delete the dedicated UE information at MAC

MAC to F1AP handler

UE Delete Response

This API is used to acknowledge the status of the UE Delete Request.

F1AP handler to MAC

RACH Resource Request

This API is used to get the CRNTI, preamble information from MAC for Contention Free Random Access

F1AP handler to MAC

RACH Resource Release

This API is used to release the Contention Free RACH Resources at MAC

F1AP handler to MAC

UE Reset

This API is used to reset the UE associated dynamic information (eg: HARQ processes) and release the UL Control channels (PUCCH, SRS) at MAC. MAC may use invoke the API at SCH to release the UE associated resources, as above, at the SCH.

MAC to F1AP handler

UE Sync Status Indication

This API is sent from MAC to F1AP to inform the sync status of UE at MAC.

Table 940 F1AP handler - MAC Channels Specific APIs

Note: UE State Manager in the F1AP module interfacing with MAC

Direction

Message/API

Description

MAC to F1AP handler

UL CCCH Indication

This API is sent from MAC to F1AP to pass the UL CCCH message received from UE. Cell id where CCCH message is received is sent to F1AP. This API is required for SA mode only

F1AP handler to MAC

DL CCCH Request

This API is sent from F1AP to MAC to send the DL CCCH message to UE with Cell id on which the message is to be transmitted. This API is required for SA mode only.

F1AP handler to MAC

DL PCCH Request

This API is sent from F1AP to MAC to broadcast the DL PCCH message in the cell. This API is required for SA mode only.

F1AP handler to MAC

DL Broadcast Request

This API is sent from F1AP to MAC the SIB messages in the cell.

The detailed description of the APIs is below:

Cell Start

Table 941 F1AP handler - MAC Cell Start message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell

Frame Number

O

Start time

Slot Number

O

Start time

Cell Stop

Table 942 F1AP handler - MAC Cell Stop message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell

Frame Number

O

Stop time

Slot Number

O

Stop time

UE Create Request

Table 943 F1AP handler - MAC UE Create Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

CRNTI

M

See TS 38.331 RNTI-Value. Allocated by MAC.

CRNTI shall be included only in case of SA

mac-CellGroupConfig (schedulingRequestConfig, tag-Config, phr-Config)

M

See TS 38.331 MAC-CellGroupConfig

physicalCellGroupConfig (pdsch-HARQ-ACK-Codebook, p-NR-FR1)

M

See TS 38.331 PhysicalCellGroupConfig

spCellConfig

M

See TS 38.331 SpCellConfig

>servCellIndex

M

See TS 38.331 ServCellIndex

>ServingCellConfigInfo

M

See TS 38.331 ServingCellConfig

>>initialDownlinkBWP (pdcch-Config, pdsch-Config)

M

See TS 38.331 BWP-DownlinkDedicated in ServingCellConfig.

>>Number of DL BWP To Add

M

The number of dedicated DL BWP To Add

>>DownlinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Downlink in ServingCellConfig

>>firstActiveDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>defaultDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>>bwp-InactivityTimer

M

See TS 38.331 ServingCellConfig

>>PDDCH-ServingCellConfig (maxMIMO-Layers, nrofHARQ-ProcessesForPDSCH, codeBlockGroupTransmission, xOverhead)

M

See TS 38.331 PDCCH-ServingCellConfig in ServingCellConfig

>>initialUplinkBWP (pucch-Config, pusch-Config)

M

See TS 38.331 BWP-UplinkDedicated in ServingCellConfig

>>Number of UL BWP To Add

M

The number of UL BWP To Add

>>uplinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Uplink in ServingCellConfig

>>firstActiveUplinkBWP-Id

M

See TS 38.331 ServingCellConfig

UE Aggregate Maximum Bit Rate Downlink

M

See TS 38.413 UE Aggregate Maximum Bit Rate Downlink

UE Aggregate Maximum Bit Rate Uplink

M

See TS 38.473 gNB-DU UE Aggregate Maximum Bit Rate Uplink

Number of LC To Add

M

The number of Logical Channel To Add

>logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

>Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT SETUP REQUEST

>S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT SETUP REQUEST

>DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

>UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

UE Create Response

Table 944 F1AP handler - MAC UE Create Response message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Result

M

Failure – if API parsing error or semantic error (e.g. incorrect state or invalid CRNTI, Cell Index) or even a single Radio Bearer (SRB/DRB) fails to be established

Success – in all the other cases

SRB failed to setup list

M

See TS 38.473 SRB Failed to Setup List in UE CONTEXT SETUP RESPONSE

DRB failed to setup list

M

See TS 38.473 DRB Failed to Setup List in UE CONTEXT SETUP RESPONSE

Scell failed to setup list

M

See TS 38.473 SCell Failed To Setup List in UE CONTEXT SETUP RESPONSE

UE Reconfiguration Request

Table 945 F1AP handler - MAC UE Reconfiguration Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

CRNTI

M

See TS 38.331 RNTI-Value

CRNTI shall be included only in case of reestablishment procedure in SA

mac-CellGroup-Reconfig (schedulingRequest-Reconfig, tag-Reconfig)

M

See TS 38.331 MAC-CellGroupConfig

physicalCellGroup-Reconfig (pdsch-HARQ-ACK-Codebook, p-NR-FR1)

M

See TS 38.331 PhysicalCellGroupConfig

spCell-Reconfig

M

See TS 38.331 SpCellConfig

>servCellIndex

M

See TS 38.331 ServCellIndex

>ServingCell-ReconfigInfo

M

See TS 38.331 ServingCellConfig

>initialDownlinkBWP-Reconfig (pdcch-Config, pdsch-Config)

M

See TS 38.331 BWP-DownlinkDedicated in ServingCellConfig

>Number of DL BWP To Add or Modify

M

The number of dedicated DL BWP To Add or Modify

>DownlinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Downlink in ServingCellConfig

>Number of DL BWP To Release

M

The number of dedicated DL BWP To remove

>DownlinkBWP-ToReleaseList (bwp-Id)

M

See TS 38.331 downlinkBWP-ToReleaseList in ServingCellConfig

>firstActiveDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>DefaultDownlinkBWP-Id

M

See TS 38.331 ServingCellConfig

>bwp-InactivityTimer

M

See TS 38.331 ServingCellConfig

>PDCCH-ServingCell-Reconfig (maxMIMO-Layers, nrofHARQ-ProcessesForPDSCH, codeBlockGroupTransmission, xOverhead)

M

See TS 38.331 PDCCH-ServingCellConfig

>InitialUplinkBWP-Reconfig (pucch-Config, pusch-Config)

M

See TS 38.331 BWP-UplinkDedicated in ServingCellConfig

>Number of UL BWP To Add or Modify

M

The number of dedicated UL BWP To Add or Modify

>UplinkBWP-ToAddModList (bwp-Id, bwp-Common, bwp-Dedicated)

M

See TS 38.331 BWP-Uplink in ServingCellConfig

>Number of UL BWP To Release

M

The number of dedicated UL BWP To remove

>uplinkBWP-ToReleaseList (bwp-Id)

M

See TS 38.331 uplinkBWP-ToReleaseList in ServingCellConfig

>firstActiveUplinkBWP-Id

M

See TS 38.331 ServingCellConfig

Number of LC To Add

M

The number of Logical Channel to Add

>logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

>Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT MODIFICATION REQUEST

>S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT MODIFICATION REQUEST

>DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

>UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

Number of LC To Delete

M

The number of Logical Channel to Delete

>logicalChannelIdentity

M

See TS 38.331 logicalChannelIdentity

Number of LC To Modified

M

The number of Logical Channel To Modified

>Logical Channel Identity

M

See TS 38.331 logicalChannelIdentity

>Qos(5Qi , GBR Qos Info, NG-RAN Allocation and Retention Priority, GBR QoS Flow Information, PDU Session ID, UL PDU Session Aggregate Maximum Bit Rate)

M

See TS 38.473 DRB QoS in UE CONTEXT MODIFICATION REQUEST

>S-NSSAI

M

See TS 38.473 S-NSSAI in UE CONTEXT MODIFICATION REQUEST

>DL LogicalChannelConfig (Lc priority)

M

See TS 38.321 Logical channel priority

>UL LogicalChannelConfig (priority, logicalChannelGroup, schedulingRequestID, prioritisedBitRate, bucketSizeDuration)

M

See 38.331 LogicalChannelConfig

UE Reconfiguration Response

Table 946 F1AP handler - MAC UE Reconfiguration Response message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Result

M

Failure – if API parsing error or semantic error (e.g. invalid UE Index, Cell Index) or none of the requested reconfigurations / modifications could be applied

Success – in all the other cases

SRB failed to setup list

M

See TS 38.473 SRB Failed to Setup List in UE CONTEXT MODIFICATION RESPONSE

DRB failed to setup list

M

See TS 38.473 DRB Failed to Setup List in UE CONTEXT MODIFICATION RESPONSE

Scell failed to setup list

M

See TS 38.473 SCell Failed To Setup List in  UE CONTEXT MODIFICATION RESPONSE

DRB Failed to Modify List

M

See TS 38.473 DRB Failed to be Modified List in UE CONTEXT MODIFICATION RESPONSE

UE Delete Request

Table 947 F1AP handler - MAC UE Delete Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Shall be present if UE has been previously successfully created at MAC.

CRNTI

M

Identification of the UE.

CRNTI presence is optional.

CRNTI shall be present if UE is being deleted without UE have been created previously at MAC.

UE Delete Response

Table 948 F1AP handler - MAC UE Delete Response message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Status

M

Failure – Invalid Cell Index or UE Index

Success – in all the other cases

RACH Resource Request

Table 949 F1AP handler - MAC RACH Resource Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Number of SSB

M

The number of ssb for which CFRA resource allocation is requested.

ssb

M

See TS 38.331 SSB-Index

RACH Resource Response

Table 950 F1AP handler - MAC RACH Resource Response message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Result

M

Failure – if API parsing error or semantic error (e.g. invalid Cell Index) or unable to allocate any CFRA Resource on any of the SSB

Success – in all the other cases

newUE-Identity

M

See TS 38.331 newUE-Identity

CFRA-SSB-Resource

M

See TS 38.331 CFRA-SSB-Resource

RACH Resource Release

Table 951 F1AP handler - MAC RACH Resource Release message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Shall be present if UE has been previously successfully created at MAC.

CRNTI

M

Identification of the UE.

CRNTI presence is optional.

CRNTI shall be present if UE is being deleted without UE have been created previously at MAC.

UE Reset Request

Table 952 F1AP handler - MAC UE Reset Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

UE Reset Response

Table 953 F1AP handler - MAC UE Reset Response message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Status

M

Failure – if API parsing error or semantic error (e.g. invalid UE Index, Cell Index)

Success – in all the other cases

UE Sync Status Indication

Table 954 F1AP handler - MAC UE Sync Status message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

UE Index

M

Identification of the UE

Sync Status

M

The sync status shall be ‘inSync’, ‘OutOfSync’ and OutOfSyncMaxRetriess

UL CCCH Indication

Table 955 F1AP handler - MAC UL CCCH Indication message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

CRNTI

M

See TS 38.331 RNTI-Value

UL-CCCH-Message

M

See TS 38.331 UL-CCCH-Message

DL CCCH Indication

Table 956 F1AP handler - MAC DL CCCH Indication message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

CRNTI

M

See TS 38.331 RNTI-Value

Message Type

M

See TS 38.331 DL-CCCH-Message Type

DL-CCCH-Message

M

See TS 38.331 DL-CCCH-Message

DL PCCH Indication

Table 957 F1AP handler - MAC DL PCCH Indication message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

Paging Frame

M

See TS 38.304 PF

Paging Occasion

M

See TS 38.304 PO

Short-Message

M

See TS 38.331 Short Message

PCCH-Message

M

See TS 38.331 PCCH-Message

DL Broadcast Request

Table 958 F1AP handler - MAC DL Broadcast Request message contents

Element

Presence

Description

Debug Time Info

O

This is an optional IE and may be provided on availability

Cell Index

M

Identification of the Cell

Number of SI blocks

M

The number of SI

SI Message (SI type, scheduling Info and Data)

M

See TS 38.331 SI-SchedulingInfo

F1AP Handler – RLC Interface

The following section captures the interface APIs between F1AP and RLC:

Table 959 F1AP handler - RLC Specific APIs

Direction

Message/API

Description

F1AP handler to RLC

UE Create

This API is used to add the UE associated RLC entity and related information (e.g.: sn field length, t reassembly timer etc.). Refer to subclause 8.3 in 3GPP TS 38.473 for details of related F1 procedure [18].

Note: One or more RLC entities of the UE may be created in the same API.

F1AP handler to RLC

UE Reconfiguration

This API is used to reconfigure the UE associated RLC entity previously added at RLC. Refer to subclause 8.3 in 3GPP TS 38.473 for details of related F1 procedure [18].

Note: One or more RLC entities of the UE may be re-configured in the same API.

F1AP handler to RLC

UE Delete Request

This API is used to delete the UE and associated RLC entities at RLC. Refer to subclause 8.3 in 3GPP TS 38.473 for details of related F1 procedure [18].

Note: One or more RLC entities of the UE may be deleted in the same API.

F1AP handler to RLC

RLC Re-establish UE Request

This API is used to re-establish all the RLC entities associated with the UE. Refer to subclause 8.3 in 3GPP TS 38.473 for details of related F1 procedure [18].

F1AP handler (UE State Manager)

DL RRC Message Transfer

This API is used to request RLC to deliver RRC message from CU (RRC) to the UE.

F1AP handler (UE State Manager)

UL RRC Message Transfer

This API is used to deliver RRC message from UE to the CU (RRC)

RLC to F1AP Handler (UE State Manager)

RLC Max Retransmission Reached

This API is used to inform the higher layers once maximum number of Retransmissions are hit.

RLC to F1AP Handler (UE State Manager)

RRC Message Delivery Report

This API is used by RLC to inform higher layers on successful/failed delivery of a DL RRC Message

The detailed description of APIs is below.

UE Create

Please note that UL configuration below applies to the DL AM/UM entity locally on the O-DU. Correspondingly DL Configuration below applies to UL AM/UM entity locally on the O-DU.

Table 960 F1AP handler - RLC UE Create message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

Number of LCs to be Setup

M

Number of LC to be added as part of UE Creation

>logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity

>RlcMode

M

Mode of operation of this logical channel

{RLC-AM, RLC-UM-Bidirectional, RLC-UM-Unidirectional-UL, RLC-UM-Unidirectional-DL, ...)

Range is same as defined in 38.331

> AM Bearer Config

O (if AM)

Present if the RLC Mode is AM

>> UL AM Config

M

>>> snFieldLength

M

{size12, size18}

Range is same as defined in 38.331

>>> t-PollRetransmit

M

Range same as 38.331 defined range for T-PollRetransmit

>>> pollPDU

M

Range same as defined in 38.331 range for PollPDU

>>> pollByte

M

Range same as defined in 38.331 range for PollByte

>>> maxRetxThreshold

M

Range same as defined in 38.331 range for maxRetxThreshold

{ t1, t2, t3, t4, t6, t8, t16, t32 }

>> DL AM Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthAM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

>>> t-statusProhibit

M

Range same as defined in 38.331 range for T-StatusProhibit

>UM-Bi-DirectionalConfig

O

Present if RLC Mode = RLC-UM-Bidirectional

>> UL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>> DL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

>UM-Uni-DirectionalConfig-UL

O

Present if RLC-Mode = RLC-UM-Unidirectional-UL

>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>UM-Uni-DirectionalConfig-DL

O

Present if RLC-Mode = RLC-UM-Unidirectional-DL

>> DL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

UE Create Response

Table 961 F1AP handler - RLC UE Create Response message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

Result

M

Failure – if API parsing error or semantic error (e.g. incorrect state or invalid UE Index, Cell Index). Refer TS 38.473 section 9.3.1.2 Cause

Success – in all the other cases

UE Reconfiguration

Please note that UL configuration below applies to the DL AM/UM entity locally on the gNB. Correspondingly DL Configuration below applies to UL AM/UM entity locally on the gNB.

Table 962 F1AP handler - RLC UE Reconfiguration message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

Number of LCs to Add/Mod

M

Number of LC to be added

>logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity

>RlcMode

M

Mode of operation of this logical channel

{RLC-AM, RLC-UM-Bidirectional, RLC-UM-Unidirectional-UL, RLC-UM-Unidirectionall-DL, ...)

Range is same as defined in 38.331

> AM Bearer Config

O (if AM)

Present if the RLC Mode is AM

>> UL AM Config

M

>>> snFieldLength

M

{size12, size18}

Range is same as defined in 38.331

>>> t-PollRetransmit

M

Range same as 38.331 defined range for T-PollRetransmit

>>> pollPDU

M

Range same as defined in 38.331 range for PollPDU

>>> pollByte

M

Range same as defined in 38.331 range for PollByte

>>> maxRetxThreshold

M

Range same as defined in 38.331 range for maxRetxThreshold

{ t1, t2, t3, t4, t6, t8, t16, t32 }

>> DL AM Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthAM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

>>> t-statusProhibit

M

Range same as defined in 38.331 range for T-StatusProhibit

>UM-Bi-DirectionalConfig

O

Present if RLC Mode = RLC-UM-Bidirectional

>> UL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>> DL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

>UM-Uni-DirectionalConfig-UL

O

Present if RLC-Mode = RLC-UM-Unidirectional-UL

>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>UM-Uni-DirectionalConfig-DL

O

Present if RLC-Mode = RLC-UM-Unidirectional-DL

>> DL-UM-Config

M

>>> snFieldLength

M

Range same as defined in 38.331 range for SN-FieldLengthUM

>>> t-Reassembly

M

Range same as defined in 38.331 range for T-Reassembly

Number of LCs to be Released

M

Number of LC to be released

>logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity

UE Reconfiguration Response

Table 963 F1AP handler - RLC UE Reconfiguration Responses message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

Result

M

Failure – if API parsing error or semantic error (e.g. incorrect state or invalid UE Index, Cell Index). Refer TS 38.473 section 9.3.1.2.

Success – in all the other cases

UE Delete

Table 964 F1AP handler - RLC UE Delete message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

UE Delete Response

Table 965 F1AP handler - RLC UE Delete Response message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

Result

M

Failure – if API parsing error or semantic error (e.g. incorrect state or invalid UE Index, Cell Index). Refer TS 38.473 section 9.3.1.2.

Success – in all the other cases

DL RRC Message Transfer

Table 966 F1AP handler – RLC DL RRC Message Transfer message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

logicalChannelIdentity

M

{1..3} SRB logical channel identity

ExecuteDuplication

O

{true, false} if present it implies RLC needs to duplicate via CA

RRCDeliveryStatusRequired

O

{true, false} if present it implies that RLC must report delivery to F1AP (UE State Manager) on successful/failed delivery

RRC-Message

M

DL-DCCH-Message as specified in 38.331

UL RRC Message Transfer

Table 967 F1AP handler – RLC UL RRC Message Transfer message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

logicalChannelIdentity

M

{1..3} SRB logical channel identity

RRC-Message

M

UL-DCCH-Message as specified in 38.331

UL RRC Message Delivery Report

Table 968 F1AP handler – RLC UL RRC Message Delivery Report message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

logicalChannelIdentity

M

{1..3} SRB logical channel identity

RRC Delivery Status

M

RRC Delivery Status as defined in 38.473

RLC Max Retransmission Reached

Table 969 F1AP handler – RLC RLC Max Retransmission Reached message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

SRB/DRB

M

Identification of SRB (0) or DRB (1)

logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity that experienced MAX RETRANSMISSION EVENT

UL RLC Re-establishment Request

Table 970sss F1AP handler – RLC RLC Reestablishment Request message contents

Element

Presence

Description

Cell Index

M

Identification of the Cell. 2-byte integer allocated by F1AP

UE Index

M

Identification of the UE. 2-byte integer allocated by F1AP

numberOfLc

M

Number of Logical Channels that have to be re-established

>logicalChannelIdentity

M

{1..32} SRB/DRB logical channel identity

O1 Interface

The O1 interface is terminated by the O-DU-OAM-Agent at O-DU to handle all configurations of L1 and L2 layers.

Support for Hierarchical DU-RU mode

To be addressed in a later release of this specification.

O-CU Interface

APIs between the following layers of O-CU are described in this section.

RRC-SDAP

RRC-PDCP

SDAP- PDCP

It is expected that the software implementation of the APIs defined in this section will be in conformance with the API message definition and the fields or message elements. Data types and encoding/decoding of the message contents will be implementation dependent. Message elements (IEs) referring to definitions in 3GPP specifications are italicized for ease of reference.

RRC-SDAP Interface

Table 101 RRC-SDAP APIs

Direction

Message/API

Description

RRC to SDAP

QoS flow to DRB mapping

QoS mapping when a DRB is added/modified. RRC indicates  in this API if reflective QoS is used.

RRC to SDAP

DRB release

To remove all QoS flow to DRB mappings

The detailed description of RRC-SDAP APIs is below.

QoS Flow to DRB Mapping

Table 102 RRC-SDAP QoS flow to DRB mapping message contents

Element

Presence

Description

Frame Number

M

Start time

Slot Number

M

Start time

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Mapping list number

M

The number of mapping list

Mapping list(QFI, RB id)

M

Identification of the mapping between QFI and RB id

DRB Release

Table 103 RRC-SDAP DRB release message contents

Element

Presence

Description

Frame Number

M

Start time

Slot Number

M

Start time

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

DRB id

M

Identification of the Released DRB

SDAP-PDCP Interface

Table 104 SDAP-PDCP Interface

Direction

Message/API

Description

SDAP to PDCP

Transfer data PDU (DL)

Transfer of SDAP PDU (with or without SDAP header) in downlink direction

PDCP to SDAP

Transfer data PDU (UL)

Transfer of SDAP PDU (with or without SDAP header) in uplink direction

SDAP to PDCP

End-marker control PDU (DL)

Control PDU (only SDAP header) to indicate end of mapping of QoS flow

The detailed description of SDAP-PDCP APIs is below:

Transfer Data PDU (DL)

Table 105 SDAP-PDCP Transfer Data PDU (DL) message contents

Element

Presence

Description

Frame Number

M

Start time

Slot Number

M

Start time

Cell Index

M

Identification of the Cell

SDAP PDU number

M

PDU number

SDAP PDU info (UE index, DRB id, PDU length, PDU data)

M

Identification of the UE, PDU length and SDAP PDU data

Transfer Data PDU (UL)

Table 106 SDAP-PDCP Transfer Data PDU (UL) message contents

Element

Presence

Description

Frame Number

M

Start time

Slot Number

M

Start time

Cell Index

M

Identification of the Cell

SDAP PDU number

M

PDU number

SDAP PDU info (UE index, DRB id, PDU length, PDU data)

M

Identification of the UE, PDU length and SDAP PDU data

End-marker Control PDU (DL)

Table 107 SDAP-PDCP End-marker control PDU (UL) message contents

Element

Presence

Description

Frame Number

M

Start time

Slot Number

M

Start time

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

DRB id

M

Identification of the DRB

EndMarker

M

End of the QoS flow-DRB mapping

RRC-PDCP Interface

Table 108 RRC-PDCP Interface

Direction

Message/API

Description

RRC to PDCP

PDCP entity establishment

To establish a PDCP entity for radio bearers

RRC to PDCP

PDCP entity re-establishment

To re-establish PDCP entity

RRC to PDCP

PDCP entity release

To release PDCP entity

RRC to PDCP

SRB Data Request

To Deliver SRB(s) Data from RRC to PDCP (DL)

PDCP to RRC

SRB Data Indication

To Deliver SRB(s) Data from PDCH to RRC (UL)

The detailed description of RRC-PDCP APIs is below:

PDCP Entity Establishment

Table 109 RRC-PDCP PDCP entity establishment

Element

Presence

Description

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Frame Number

M

Start time

Slot Number

M

Start time

RB number

M

The number of RB

RB information list (Rb Id, logicalChannelIdentity, RB type, discardTimer, t-Reordering, SN Bit, headerCompression, securityConfig)

M

See RadioBearerConfig, PDCP-Config in 38.331

PDCP Entity Re-establishment

Table 1010 RRC-PDCP PDCP entity release

Element

Presence

Description

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Frame Number

M

Start time

Slot Number

M

Start time

SRB Data Request

Table 1011 RRC-PDCP SRB Data Request

Element

Presence

Description

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Frame Number

M

Start time

Slot Number

M

Start time

SRB PDU Number

M

The number of RB

SRB PDU info(SRB id, data length, SRB PDU data)

M

SRB Data Indication

Table 1012 RRC-PDCP SRB Data Indication

Element

Presence

Description

Cell Index

M

Identification of the Cell

UE index

M

Identification of the UE

Frame Number

M

Start time

Slot Number

M

Start time

SRB PDU Number

M

The number of RB

SRB PDU info(SRB id, data length, SRB PDU data)

M

SDAP-eGTPU Interface

Table 1013 SDAP-eGTPU APIs

Direction

Message/API

Description

SDAP to eGTPU

Transfer Data SDAP SDU(UL)

Transfer of SDAP SDU in uplink direction

eGTPU to SDAP

Transfer Data SDAP SDU(DL)

Transfer of SDAP SDU in downlink direction

Transfer Data SDAP SDU (UL)

This message is sent by SDAP to transfer uplink data to eGTPU.

Table 1014 SDAP-eGTPU Transfer Data SDAP SDU (UL) message contents

Element

Presence

Description

Cell index

M

Identification of the Cell

UE index

M

Identification of the UE

PDU Session id

M

Identification of the PDU Session

QFI

M

QoS Flow Identifier

SDAP SDU data

M

SDAP SDU data

SDAP SDU length

M

SDAP SDU length

Transfer Data SDAP SDU (DL)

This message is sent by eGTPU to transfer downlink data to SDAP.

Table 1015 -eGTPU-SDAP Transfer Data SDAP SDU (DL) message contents

Element

Presence

Description

Cell index

M

Identification of the Cell

UE index

M

Identification of the UE

PDU Session id

M

Identification of the PDU Session

QFI

M

QoS Flow Identifier

SDAP SDU data

M

SDAP SDU data

SDAP SDU length

M

SDAP SDU length

PDCP-eGTPU Interface

Table 1016 PDCP-eGTPU APIs

Direction

Message/API

Description

PDCP to eGTPU

Transfer Data PDCP PDU(DL)

Transfer of PDCP PDU in downlink direction.

eGTPU to PDCP

Transfer Data PDCP PDU(UL)

Transfer of PDCP PDU in uplink direction

Transfer Data PDCP PDU (DL)

This message is sent by PDCP to eGTPU to transfer packets in downlink direction.

Table 1017 PDCP-eGTPU Transfer Data PDCP PDU (DL) message contents

Element

Presence

Description

Cell index

M

Identification of the Cell

UE index

M

Identification of the UE

DRB id

M

Identification of the DRB

PDCP PDU data

M

PDCP PDU data

PDCP PDU length

M

PDCP PDU length

Transfer Data PDCP PDU (UL)

This message is sent by eGTPU to PDPCP to transfer packets in uplink direction.

Table 1018 -eGTPU to PDCP Transfer Data PDCP PDU (UL) message contents

Element

Presence

Description

Cell index

M

Identification of the Cell

UE index

M

Identification of the UE

DRB id

M

Identification of the DRB

PDCP PDU data

M

PDCP PDU data

PDCP PDU length

M

PDCP PDU length

Ciphering and Integrity Protection

Support for software implementation and hardware acceleration. This will be addressed in a later release of this specification.

Header Compression

Support for software implementation and hardware acceleration. This This will be addressed in a later release of this specification.

Annex A	(Informative)

L1 APIs

Table A-1 Uplink Module APIs

API

Description

FFT

Perform the FFT operation

Layer demapping

Layer De-mapping for 5GNR providing support for a single code word. The algorithm is defined in section 7.3.1.3 in TS38.211 [4]

Channel estimation

Performance channel estimation based on the DMRS symbols

MIMO equalizer

5G NR MIMO equalization algorithm

Demodulation

Modulation demapper for 5GNR that conforms to section 5.1 in 3GPP TS38.211 [4]

Descrambler

Descrambling procedure as defined in TS38.211 [4], which takes a sequence of LLRs and descrambles them based on a scramble code sequence

Rate Dematching

LDPC rate dematching operation

Polar Decoder

Polar Decoder 5G NR function

LDPC Decoder

LDPC Decoder 5G NR function

CRC Check

The CRC validate function. It calculates a CRC value and then compares that value to the one at the end of the data

Beamforming

Perform the spatial combining of the data from antennas to reduce the number of radio data streams

Table A-2 Layer Demapping Parameters

Parameter Fields

Description

Layer data size

The layer data length

Number of layers

Layer count

Input Data

Layer demapping input data

Table A-3 Channel Estimation API Parameters

Parameter Fields

Description

Start PRB

PRB start position

Number of PRB

PRB counts

Start Rx Antenna

Start antenna number of contiguous antenna numbers

Number of Rx Antenna

Rx antenna count

Number of Layers

Layer count

Number of DMRS

Number of DMRS symbols per TTI

DMRS configuration type

DMRS configuration type

DMRS in slot

Slot contains the DMRS

First DMRS in Slot Position

Position in the slot of the first DMRS symbol

PUSCH symbols in TTI

Number of PUSCH symbols in the TTI

Received Data

Received DMRS Data from antennas

Reference DMRS

Reference DMRS used

Table A-4 Downlink Module APIs

API

Description

Layer mapping

Layer mapping for 5GNR providing support for a single code word. The algorithm is defined in section 7.3.1.3 in TS38.211 [4]

Demodulation

Modulation mapper for 5GNR that conforms to section 5.1 in 3GPP TS38.211 [4]

Scrambler

Scrambling procedure as defined in TS38.211 [4]

Rate matching

LDPC rate dematching operation

Polar Encoder

Polar Encoder 5G NR function

LDPC Encoder

LDPC Encoder 5G NR function

CRC Generation

The CRC generation function. It calculates a CRC value

Beam Forming

Performs Beamforming function based on the selected algorithm.

Precoder

Precoder combines the information from beamforming with several layers of subcarriers to create a set of antenna outputs.

Table A-5 PRACH Module APIs

API

Description

PRACH ZC Gen

Generate root ZC sequence used in PRACH. The algorithm is defined in section 7.3.1.3 in TS38.211 [4]

PRACH Detection

PRACH preamble detection and power spectrum

Table A-6 PBCH Module APIs

API

Description

PBCH DMRS Gen

Generate the DMRS For PBCH message

PBCH Gen

Create Complete PBCH message

Call Flows

F1 Startup and Cells Activation

Figure below describes F1 interface setup and cell enabling across O-CU and O-DU as specified in subclause 8.5 of 3GPP TS 38.401 [12] when O-CU and O-DU nodes are brought up. The O-DU and its cells are configured by OAM in the pre-operational state.

Figure A-1  F1 interface setup and cell enabling across O-CU and O-DU

UE registration

The following call flow depicts all the messages across interfaces and internal APIs for UE registration in 5G SA.

Figure A-2  UE registration

RACH procedure

Figure A.2.3 shows the RACH procedure in UE registration call flow described in the previous section.

Figure A-3  RACH procedure

SR procedure

The SR procedure call flow is depicted in Figure A.2.4

Figure A-4  SR procedure

UL Grant procedure

The UL Grant procedure call flow is depicted in Figure A.2.5

Figure A-5  UL Grant Procedure

PDU Session Establishment

PDU session establishment call flows are as shown in Figure A.2.6

Figure A-6  PDU Session Establishment

Annex ZZZ : O-RAN Adopter License Agreement

BY DOWNLOADING, USING OR OTHERWISE ACCESSING ANY O-RAN SPECIFICATION, ADOPTER AGREES TO THE TERMS OF THIS AGREEMENT.

This O-RAN Adopter License Agreement (the “Agreement”) is made by and between the O-RAN Alliance and the entity that downloads, uses or otherwise accesses any O-RAN Specification, including its Affiliates (the “Adopter”).

This is a license agreement for entities who wish to adopt any O-RAN Specification.

Section 1: DEFINITIONS

1.1 “Affiliate” means an entity that directly or indirectly controls, is controlled by, or is under common control with another entity, so long as such control exists. For the purpose of this Section, “Control” means beneficial ownership of fifty (50%) percent or more of the voting stock or equity in an entity.

1.2 “Compliant Implementation” means any system, device, method or operation (whether implemented in hardware, software or combinations thereof) that fully conforms to a Final Specification.

1.3 “Adopter(s)” means all entities, who are not Members, Contributors or Academic Contributors, including their Affiliates, who wish to download, use or otherwise access O-RAN Specifications.

1.4 “Minor Update” means an update or revision to an O-RAN Specification published by O-RAN Alliance that does not add any significant new features or functionality and remains interoperable with the prior version of an O-RAN Specification. The term “O-RAN Specifications” includes Minor Updates.

1.5 “Necessary Claims” means those claims of all present and future patents and patent applications, other than design patents and design registrations, throughout the world, which (i) are owned or otherwise licensable by a Member, Contributor or Academic Contributor during the term of its Member, Contributor or Academic Contributorship; (ii) such Member, Contributor or Academic Contributor has the right to grant a license without the payment of consideration to a third party; and (iii) are necessarily infringed by a Compliant Implementation (without considering any Contributions not included in the Final Specification). A claim is necessarily infringed only when it is not possible on technical (but not commercial) grounds, taking into account normal technical practice and the state of the art generally available at the date any Final Specification was published by the O-RAN Alliance or the date the patent claim first came into existence, whichever last occurred, to make, sell, lease, otherwise dispose of, repair, use or operate a Compliant Implementation without infringing that claim. For the avoidance of doubt in exceptional cases where a Final Specification can only be implemented by technical solutions, all of which infringe patent claims, all such patent claims shall be considered Necessary Claims.

1.6 “Defensive Suspension” means for the purposes of any license grant pursuant to Section 3, Member, Contributor, Academic Contributor, Adopter, or any of their Affiliates, may have the discretion to include in their license a term allowing the licensor to suspend the license against a licensee who brings a patent infringement suit against the licensing Member, Contributor, Academic Contributor, Adopter, or any of their Affiliates.

Section 2: COPYRIGHT LICENSE

2.1 Subject to the terms and conditions of this Agreement, O-RAN Alliance hereby grants to Adopter a nonexclusive, nontransferable, irrevocable, non-sublicensable, worldwide copyright license to obtain, use and modify O-RAN Specifications, but not to further distribute such O-RAN Specification in any modified or unmodified way, solely in furtherance of implementations of an ORAN Specification.

2.2 Adopter shall not use O-RAN Specifications except as expressly set forth in this Agreement or in a separate written agreement with O-RAN Alliance.

Section 3: FRAND LICENSE

3.1 Members, Contributors and Academic Contributors and their Affiliates are prepared to grant based on a separate Patent License Agreement to each Adopter under Fair Reasonable And Non- Discriminatory (FRAND) terms and conditions with or without compensation (royalties) a nonexclusive, non-transferable, irrevocable (but subject to Defensive Suspension), non-sublicensable, worldwide patent license under their Necessary Claims to make, have made, use, import, offer to sell, lease, sell and otherwise distribute Compliant Implementations; provided, however, that such license shall not extend: (a) to any part or function of a product in which a Compliant Implementation is incorporated that is not itself part of the Compliant Implementation; or (b) to any Adopter if that Adopter is not making a reciprocal grant to Members, Contributors and Academic Contributors, as set forth in Section 3.3. For the avoidance of doubt, the foregoing licensing commitment includes the distribution by the Adopter’s distributors and the use by the Adopter’s customers of such licensed Compliant Implementations.

3.2 Notwithstanding the above, if any Member, Contributor or Academic Contributor, Adopter or their Affiliates has reserved the right to charge a FRAND royalty or other fee for its license of Necessary Claims to Adopter, then Adopter is entitled to charge a FRAND royalty or other fee to such Member, Contributor or Academic Contributor, Adopter and its Affiliates for its license of Necessary Claims to its licensees.

3.3 Adopter, on behalf of itself and its Affiliates, shall be prepared to grant based on a separate Patent License Agreement to each Members, Contributors, Academic Contributors, Adopters and their Affiliates under Fair Reasonable And Non-Discriminatory (FRAND) terms and conditions with or without compensation (royalties) a nonexclusive, non-transferable, irrevocable (but subject to Defensive Suspension), non-sublicensable, worldwide patent license under their Necessary Claims to make, have made, use, import, offer to sell, lease, sell and otherwise distribute Compliant Implementations; provided, however, that such license will not extend: (a) to any part or function of a product in which a Compliant Implementation is incorporated that is not itself part of the Compliant Implementation; or (b) to any Members, Contributors, Academic Contributors, Adopters and their Affiliates that is not making a reciprocal grant to Adopter, as set forth in Section 3.1. For the avoidance of doubt, the foregoing licensing commitment includes the distribution by the Members’, Contributors’, Academic Contributors’, Adopters’ and their Affiliates’ distributors and the use by the Members’, Contributors’, Academic Contributors’, Adopters’ and their Affiliates’ customers of such licensed Compliant Implementations.

Section 4: TERM AND TERMINATION

4.1 This Agreement shall remain in force, unless early terminated according to this Section 4.

4.2 O-RAN Alliance on behalf of its Members, Contributors and Academic Contributors may terminate this Agreement if Adopter materially breaches this Agreement and does not cure or is not capable of curing such breach within thirty (30) days after being given notice specifying the breach.

4.3 Sections 1, 3, 5 - 11 of this Agreement shall survive any termination of this Agreement. Under surviving Section 3, after termination of this Agreement, Adopter will continue to grant licenses (a) to entities who become Adopters after the date of termination; and (b) for future versions of ORAN Specifications that are backwards compatible with the version that was current as of the date of termination.

Section 5: CONFIDENTIALITY

Adopter will use the same care and discretion to avoid disclosure, publication, and dissemination of O-RAN Specifications to third parties, as Adopter employs with its own confidential information, but no less than reasonable care. Any disclosure by Adopter to its Affiliates, contractors and consultants should be subject to an obligation of confidentiality at least as restrictive as those contained in this Section. The foregoing obligation shall not apply to any information which is: (1) rightfully known by Adopter without any limitation on use or disclosure prior to disclosure; (2) publicly available through no fault of Adopter; (3) rightfully received without a duty of confidentiality; (4) disclosed by O-RAN Alliance or a Member, Contributor or Academic Contributor to a third party without a duty of confidentiality on such third party; (5) independently developed by Adopter; (6) disclosed pursuant to the order of a court or other authorized governmental body, or as required by law, provided that Adopter provides reasonable prior written notice to O-RAN Alliance, and cooperates with O-RAN Alliance and/or the applicable Member, Contributor or Academic Contributor to have the opportunity to oppose any such order; or (7) disclosed by Adopter with O-RAN Alliance’s prior written approval.

Section 6: INDEMNIFICATION

Adopter shall indemnify, defend, and hold harmless the O-RAN Alliance, its Members, Contributors or Academic Contributors, and their employees, and agents and their respective successors, heirs and assigns (the “Indemnitees”), against any liability, damage, loss, or expense (including reasonable attorneys’ fees and expenses) incurred by or imposed upon any of the Indemnitees in connection with any claims, suits, investigations, actions, demands or judgments arising out of Adopter’s use of the licensed O-RAN Specifications or Adopter’s commercialization of products that comply with O-RAN Specifications.

Section 7: LIMITATIONS ON LIABILITY; NO WARRANTY

EXCEPT FOR BREACH OF CONFIDENTIALITY, ADOPTER’S BREACH OF SECTION 3, AND ADOPTER’S INDEMNIFICATION OBLIGATIONS, IN NO EVENT SHALL ANY PARTY BE LIABLE TO ANY OTHER PARTY OR THIRD PARTY FOR ANY INDIRECT, SPECIAL, INCIDENTAL, PUNITIVE OR CONSEQUENTIAL DAMAGES RESULTING FROM ITS PERFORMANCE OR NON-PERFORMANCE UNDER THIS AGREEMENT, IN EACH CASE WHETHER UNDER CONTRACT, TORT, WARRANTY, OR OTHERWISE, AND WHETHER OR NOT SUCH PARTY HAD ADVANCE NOTICE OF THE POSSIBILITY OF SUCH DAMAGES. O-RAN SPECIFICATIONS ARE PROVIDED “AS IS” WITH NO WARRANTIES OR CONDITIONS WHATSOEVER, WHETHER EXPRESS, IMPLIED, STATUTORY, OR OTHERWISE. THE O-RAN ALLIANCE AND THE MEMBERS, CONTRIBUTORS OR ACADEMIC CONTRIBUTORS EXPRESSLY DISCLAIM ANY WARRANTY OR CONDITION OF MERCHANTABILITY, SECURITY, SATISFACTORY QUALITY, NONINFRINGEMENT, FITNESS FOR ANY PARTICULAR PURPOSE, ERROR-FREE OPERATION, OR ANY WARRANTY OR CONDITION FOR O-RAN SPECIFICATIONS.

Section 8: ASSIGNMENT

Adopter may not assign the Agreement or any of its rights or obligations under this Agreement or make any grants or other sublicenses to this Agreement, except as expressly authorized hereunder, without having first received the prior, written consent of the O-RAN Alliance, which consent may be withheld in O-RAN Alliance’s sole discretion. O-RAN Alliance may freely assign this Agreement.

Section 9: THIRD-PARTY BENEFICIARY RIGHTS

Adopter acknowledges and agrees that Members, Contributors and Academic Contributors (including future Members, Contributors and Academic Contributors) are entitled to rights as a third-party beneficiary under this Agreement, including as licensees under Section 3.

Section 10: BINDING ON AFFILIATES

Execution of this Agreement by Adopter in its capacity as a legal entity or association constitutes that legal entity’s or association’s agreement that its Affiliates are likewise bound to the obligations that are applicable to Adopter hereunder and are also entitled to the benefits of the rights of Adopter hereunder.

Section 11: GENERAL

This Agreement is governed by the laws of Germany without regard to its conflict or choice of law provisions.

This Agreement constitutes the entire agreement between the parties as to its express subject matter and expressly supersedes and replaces any prior or contemporaneous agreements between the parties, whether written or oral, relating to the subject matter of this Agreement.

Adopter, on behalf of itself and its Affiliates, agrees to comply at all times with all applicable laws, rules and regulations with respect to its and its Affiliates’ performance under this Agreement, including without limitation, export control and antitrust laws. Without limiting the generality of the foregoing, Adopter acknowledges that this Agreement prohibits any communication that would violate the antitrust laws.

By execution hereof, no form of any partnership, joint venture or other special relationship is created between Adopter, or O-RAN Alliance or its Members, Contributors or Academic Contributors. Except as expressly set forth in this Agreement, no party is authorized to make any commitment on behalf of Adopter, or O-RAN Alliance or its Members, Contributors or Academic Contributors.

In the event that any provision of this Agreement conflicts with governing law or if any provision is held to be null, void or otherwise ineffective or invalid by a court of competent jurisdiction, (i) such provisions will be deemed stricken from the contract, and (ii) the remaining terms, provisions, covenants and restrictions of this Agreement will remain in full force and effect.

Any failure by a party or third party beneficiary to insist upon or enforce performance by another party of any of the provisions of this Agreement or to exercise any rights or remedies under this Agreement or otherwise by law shall not be construed as a waiver or relinquishment to any extent of the other parties’ or third party beneficiary’s right to assert or rely upon any such provision, right or remedy in that or any other instance; rather the same shall be and remain in full force and effect.

________________________________________________________________________________________________ © 2021 O-RAN Alliance e.V. Your use is subject to the terms of the O-RAN Adopter License Agreement in Annex ZZZ									  2