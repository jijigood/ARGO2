O-RAN.WG6.AAL-Common-API-R003-v03.00
Technical Specification
O-RAN Working Group 6
(Cloudification and Orchestration Workgroup)
Acceleration Abstraction Layer
Common API
Copyright © 2022 by the O-RAN ALLIANCE e.V.
The copying or incorporation into any other work of part or all of the material available in this specification in any form without the prior written permission of O-RAN ALLIANCE e.V.  is prohibited, save that you may print or download extracts of the material of this specification for your personal use, or copy the material of this specification for the purpose of sending to individual third parties for their information provided that you acknowledge O-RAN ALLIANCE as the source of the material and that you inform the third party that these conditions apply to them and that they must comply with them.
O-RAN ALLIANCE e.V., Buschkauler Weg 27, 53347 Alfter, Germany
Register of Associations, Bonn VR 11238, VAT ID DE321720189
Introductory Material
1.1 Scope
This Technical Specification has been produced by the O-RAN Alliance.
The contents of the present document are subject to continuing work within O-RAN and may change following formal O-RAN approval. Should the O-RAN Alliance modify the contents of the present document, it will be re-released by O-RAN with an identifying change of release date and an increase in version number as follows:
Release x.y.z
where:
x	the first digit is incremented for all changes of substance, i.e., technical enhancements, corrections, updates, etc. (the initial approved document will have x=01).
y	the second digit is incremented when editorial only changes have been incorporated in the document.
z	the third digit included only in working versions of the document indicating incremental changes during the editing process.
The present document focuses on the Common API related to common aspects of accelerator abstraction from an administration and application perspective.
1.2 References
3GPP TR 21.905: “Vocabulary for 3GPP Specifications”.
O-RAN Cloud Architecture and Deployment Scenarios for O-RAN Virtualized RAN.
O-RAN O-RAN.WG1.O-RAN-Architecture-Description
O-RAN O2 Interface General Aspects and Principles
O-RAN Cloudification and Orchestration Use Cases and Requirements for O-RAN Virtualized RAN
O-RAN O2ims Interface Specification
O-RAN Acceleration Abstraction Layer General Aspects and Principles
O-RAN Acceleration Abstraction Layer FEC Profiles
O-RAN Acceleration Abstraction Layer High-PHY Profiles
1.3 Definitions and Abbreviations
1.3.1 Definitions
For the purposes of the present document, the terms and definitions given in [2] apply.
1.3.2 Abbreviations
For the purposes of the present document, the terms and definitions given in [2] apply.
AALI-C	Acceleration Abstraction Layer Interface-Common
AALI-C-Mgmt	Acceleration Abstraction Layer Interface-Common-Management
AALI-C-App	Acceleration Abstraction Layer Interface-Common-Application
AALI-P	Acceleration Abstraction Layer Interface-Profile
UC					Use Case
Overview
General
The AAL General Aspects and Principles are described in [2] including a high-level architecture of the AAL and definition of the AAL profiles.
The AAL interface has two parts:
AALI-C: A profile independent set of functions between application(s) and underlying AAL implementation(s) including management and orchestration within an O-Cloud platform.
AALI-P: A set of profile specific interfaces dependent upon the profile selected e.g., FEC.
The AALI-P are addressed in FEC[8] and High-Phy specifications [9].
Within the AALI-C interface there are two parts:
AALI-C-Mgmt: Common administrative operations, actions, and events between the O-Cloud IMS and the HW Accelerator Manager. The IMS provides the O2 interface towards the SMO. The HW Accelerator Manager terminates the AALI-C-Mgmt interface.
AALI-C-App: Common operations/actions/events toward RAN Application. These operators are between the AAL-App and the RAN application.
Figure 2.1-1: Architecture
The present document details the list of AALI-C operations and events, description with input/outputs, information models, state transition diagrams and requirements to implement an AAL interface.
Note: The scope of the definition in this specification is southbound of the IMS, while reference to SMO is made to set the context, the normative definition of the exchange of information between the IMS and SMO, is part of the O2 IMS specification. [6]
2.2 Document Structure
This present document is structured as follows:
Chapter 2 presents the overview and main purpose of this specification.
Chapter 3 presents a list of requirements and object model.
Chapter 4 presents the initialization and flow, operations and events associated with AALI-C-Mgmt.
Chapter 5 presents the initialization and flow, operations and events associated with AALI-C-App.
AAL Common requirements and Object Model
3.1 AALI-C Mgmt Requirements
3.2 AALI-C App Requirements
Note: This section is to be completed in the next release
3.2.1 AALI-C-APP Transport Abstraction Requirements and Operations
The transport between an Application and an AAL implementation can be of different types (e.g., based on shared memory, PCIe interconnect, over Ethernet). AALI-C-App shall support abstraction of these various transport mechanisms between an Application and an AAL implementation through a set of common transport APIs, constituting a transport abstraction framework. The related set of requirements and operations defined in the table below is complementing Sec. 2.5.1.12 of AAL GAnP Spec. [Ref. [7]]
3.3 Object model and scenarios
The AALI-C-Mgmt interface is the management interface that is used by the IMS for administrative operations/actions/events. The HW Accelerator Manager terminates the AALI-C-Mgmt interface.
Operations and actions/events via AALI-C-Mgmt are applicable on the following entities:
HW Accelerator – Physical Managed Resource
AAL Logical Processing Unit (AAL-LPU) – Logical Managed Resource
AAL Profile – Logical Managed Resource
The AALI-C-App interface is the application facing interface that is used by the application to discover, configure, and manage the AAL-Profile-Instance(s) and AAL-Queue(s) assigned to the application.
Note: A Network Function or application may choose to use one or more AAL Profiles as part of its implementation.
Operations and actions/events via AALI-C-App are applicable on the following entities:
AAL Logical Processing Unit (AAL-LPU) – Logical Managed Resource
AAL Profile Instance - Logical Managed Resource
AAL Queue - Logical Managed Resource
HW accelerator: AAL Logical Processing Unit = 1: N2 (N2 >= 1)
AAL Logical Processing Unit: AAL Profile Instance = 1: N3 (N3 >= 1)
AAL Logical Processing Unit: AAL Queue = 1: N4 (N4 >= 1)
AAL Profile Instance: AAL Profile Queues = 1: N4 (N4 >= 1)
Note: The definition of these resources are defined in GAnP specification [7] section 1.3: The cardinality and relationship between these objects are derived from the GAnP specification [7] section 2.3. The various scenarios supported are also available in the GAnP [7] section 5.
The Information model defined in [6] will be used to define these Managed Resources.
Note 1:Usage of  'M', 'O', and 'CM' imply Mandatory, Optional and Conditional Mandatory in the spec.s
3.3.1 HW Accelerator Modelling
A HW Accelerator is a Physical Managed resource and can be modelled as below:
HW Accelerator Managed Resource
HW Accelerator Managed Resource Type
Editor’s Note: The modelling aspects needs to be aligned with the WG6 O2 modelling discussions. The alignment may result in modifications to this section.
3.3.2 AAL-LPU Modelling
An AAL-LPU is a Logical Managed resource and can be modelled as below:
AAL-LPU Managed Resource
AAL-LPU Managed Resource Type
The Hardware Accelerator Manager is the AAL endpoint for the AALI-C-MGMT interface.
3.3.3 Naming convention
For the APIs the following naming convention will be used:
For the Managed Resources:
HW Accelerator - HW-Accel
AAL LPU - AAL-LPU
AAL Profile Instance - AAL-Profile-Instance
AAL Queue - AAL-Queue
Profile Naming convention:
FEC Profile – AAL-FEC
L1 DL High Phy Profile – AAL-DOWNLINK-High-PHY
L1 UL High Phy Profile – AAL-UPLINK-High-PHY
Operations and parameters naming convention:
lowerCamelCase for operation names
lower_snake_case for parameters
Group of attributes are notified with a > sign.
Example:
A grouped list of variables a, b and c under one parameter i.e. parameter_name is shown as follows:
AALI-C-Mgmt
4.1 AALI-C-Mgmt operations and events
The below table lists the operations and events as part of the AALI-C-Mgmt interface.
4.2 AALI-C-Mgmt use case workflows
4.2.1 HW Accelerator installation/bootstrap use case workflow
This use case describes the procedure with a focus on the interaction with the Accelerator Manager for installing a HW accelerator and configuring the AAL-LPUs. This procedure would be applicable during the initial deployment of an O-Cloud and afterward to reconfigure or add new resources.
This AAL UC flow can be executed during the O-Cloud Registration and Initialization Use Case, O-Cloud Inventory Update Use Case and the Hardware Infrastructure Scaling of O-Cloud Post Deployment Use Case [ Ref[5]: 3.1.4 “O-Cloud Registration and Initialization Use Case”, Configure AAL-LPU  “3.1.4 : O-Cloud Inventory Update Use Case (DMS Example)” and “3.1.5: Hardware Infrastructure Scaling of O-Cloud Post Deployment”].
4.2.1.1	Sequence Diagram
@startuml
skinparam sequenceArrowThickness 1
skinparam ParticipantPadding 2
skinparam BoxPadding 5
Autonumber
Box "Personnel" #lightblue
Actor ProjectManager as "Cloud Installation\nProject Mgr"
Actor Installer as "Cloud Installer"
End box
Box "Service Management & Orchestration Framework" #gold
Participant "FOCOM" as FCC
End box
Box "O-Cloud      "#lightseagreen
Participant "IMS" as IMS
Participant AccelMgr as "Accelerator Manager"
End box
Note over Installer, FCC
PRECONDITIONS:
SMO/FOCOM is active and running normally
O-Cloud is available
IMS/DMS is already available
Accelerator Manager is available
SMO and IMS/DMS connectivity is established
End Note
== Use case: Install new HW Accelerator ==
Note over Installer, FCC
SMO sends request to Install Accelerator
End Note
opt Load boot image as needed
Note over IMS
If boot image is needed or new driver is needed then upload image
End note
IMS -> AccelMgr : <<AALI-C-Mgmt>> uploadBootImage
AccelMgr -> IMS : <<AALI-C-Mgmt>> uploadBootImage Success
End Opt
IMS -> AccelMgr : <<AALI-C-Mgmt>> getAalAccelInfo request
AccelMgr -> IMS : <<AALI-C-Mgmt>> getAalAccelInfo response (success)
Note over FCC
Accelerator Manager is installed and SMO has the inventory information about the Accelerator.
SMO Updates cloud inventory
End Note
== End Use Case ==
@enduml
4.2.2 e2e Life Cycle Management use case workflow (Informational)
Note: The e2e flow depicted in this section are known to be incomplete and are being provided as informational guidance to implementors on how the APIs documented in the remainder of the specification are to be used. These exchanges will be made normative in future versions of the specification”.
This use case describes the e2e procedure with a focus on the interaction with the HW Accelerator Manager via the AALI-C-Mgmt interface for discovering the capabilities of the Accelerator, configuring the AAL-LPUs, instantiating an application (xNF) and optionally updating/reconfiguring the resources based on the needs of the xNF. The flow also shows the interaction with the application via the AALI-C-App to create an AAL-Profile-Instance.
This AAL UC flow can be executed during the O-Cloud Registration and Initialization Use Case, O-Cloud Inventory Update Use Case and the Hardware Infrastructure Scaling of O-Cloud Post Deployment Use Case [ Ref[5]: 3.1.4 “O-Cloud Registration and Initialization Use Case”, Configure AAL-LPU  “3.1.4 : O-Cloud Inventory Update Use Case (DMS Example)” and “3.1.5: Hardware Infrastructure Scaling of O-Cloud Post Deployment”]. This use case is also related to the “3.2.1	Instantiate Network Function on O-Cloud”.
4.2.2.1	Sequence Diagram
@startuml
skinparam sequenceArrowThickness 1
skinparam ParticipantPadding 2
skinparam BoxPadding 5
Autonumber
Box "Service Management & Orchestration Framework" #gold
Participant "FOCOM/NFO" as FCC
End box
Box "O-Cloud      "#lightseagreen
Participant "IMS" as IMS
Participant DMS as "DMS"
Participant AccelMgr as "AAL Mgmt"
Participant "AAL App" as aal
End box
Box "Network Functions"#LightBlue
Participant "xNF App" as App
End box
Box "Network Functions"#DarkBlue
Participant "SMO" as O1
End box
Box "SW Repo" "#Blue
Participant "Repo" as Repo
End box
Note over FCC
PRECONDITIONS:
SMO/FOCOM is active and running normally
O-Cloud is available
IMS/DMS is already available
SMO and IMS/DMS connectivity is established
Accelerator Manager is available
End Note
== Use case: AAL Flow ==
Note over FCC
SMO Catalog, HW Accelerator Manifest, xNF Manifest available
FW/SW image Repo available, SMO Inventory DB available
end Note
FCC -> IMS: <<O2>> QueryOcloudInfoRequest
IMS -> AccelMgr : <<AALI-C-Mgmt>> getAalAccelInfo
AccelMgr --> IMS : getAalAccelInfo response Success( Vendor, Version, Bios etc )
IMS --> FCC : <<O2>> QueryOcloudInfoResponse
FCC -> FCC : SMO Inventory updated
Note over FCC,IMS
Single Set command to configure the device with manifest,
including AAL LPU and Profile Images.
The SMO knows the pre-defined set of configurations that support different
use cases that it wants to deploy.
The configuration can be changed dynamically in the future.
HW Accelerator Manager will be able to apply delta changes accordingly.
end Note
Note over FCC,IMS
SMO triggers setting AAL Accel Config
end Note
IMS -> AccelMgr: <<AALI-C-Mgmt>> setAalAccelConfig \n(including AAL-LPU's, Supported AAL-Profile etc..)
Note over AccelMgr, Repo
Optionally, if needed, the SW/FW image is retrieved from the Repo
End Note
group DMS inventory update
AccelMgr <--> DMS : DMS Info exchange
Note over DMS
examples of info exchanged \n AAL-LPUs, AAL-Profile info etc
End Note
End
AccelMgr --> IMS: setAalAccelConfig response success
Note over FCC,IMS
Response to SMO with success/failure of setting AAL Accel Config
end Note
FCC -> FCC : SMO Inventory update
Note over FCC,IMS
SMO Instantiate xNFs
SMO gets the deployment artifacts for
containerized workload (e.g., Manifest/ Helm Charts).
This includes resource and profiles requested
end Note
REF over FCC : Use case 3.2.1 Orchestration Use Case Spec
FCC -> DMS : <<O2>> Instantiate xNF
Note over DMS
The DMS manifest includes the LPU (Profile) required and I/O ports etc..
end NOTE
Note over DMS
Kubernetes Example for High Phy Profile:
requests:
oran.com/aal_highphy_lpu1: ‘1’ #assigns LPU 1 to the POD
Ethernet.com/ethernet_sriov_dpdk_port4: ‘1’ #mid haul
hugepages-1Gi: 2Gi
memory: 2G1
ETSI Example for High Phy Profile: (TBD)
Example for handling other profiles (TBD)
end NOTE
opt Set AAL Accel info if needed
Note over DMS
Optionally, the IMS sets the AAL Accel Config
based on the information received from SMO
to add/modify resources as defined in the xNF instantiate request.
End Note
DMS --> FCC : <<DMS-SMO interface>>Update Accel info (to be define by O2dms)
FCC -> IMS: <<O2>> Set AAL Accel Config \n(including AAL-LPU's, Supported AAL-Profile etc..)
IMS -> AccelMgr: <<AAL-C-Mgmt>> Set AAL-Accel-Config \n(including AAL-LPU's, Supported AAL-Profile etc..)
AccelMgr --> IMS: <<AAL-C-Mgmt>> Set AAL-Accel-Config response success
IMS --> FCC : <<O2>> Set AAL Accel Config response success
FCC --> DMS: Success
End opt
DMS -> App : xNF instantiated
activate App
DMS --> FCC : xNF instantiated response success
O1 -> App : <<O1>> DU Configuration \n Cells, BW, Profile Version etc..
App --> O1 : response Success
Note over aal, App
Kubernetes Example :
Environmnet Variables are populated with the appropriate resource
identifier for the application to use when initializing the AAL Implementation.
In the example below it assumes an SRIOV AAL Implementation type using PCIE
address to identify the correct HW Resource.
PCIDEVICE_ORAN_COM_AAL_HIGHPHY_LPU=0000:67:06.3
ETSI Example: TBD
End NOTE
Note over aal, App
Initilize the AAL interface betwwen AAL and App
end NOTE
App <-> aal : Init AALI-C-App
Note over aal, App
Get AAL LPU information and
create AAL Profile Instance
end NOTE
App -> aal : <<AALI-C-App>> getAalAccelInfo
aal -> App : <<AALI-C-App>> Response LPU/Profile handle
App -> aal : <<AALI-C-App>> createAalProfileInstance
aal -> App : <<AALI-C-App>> Response Success
App -> aal : <<AALI-C-App>> setAalProfileInstance/startAalProfileInstance/startAalProfileInstance
aal -> App : <<AALI-C-App>> Response Success
App -> aal : <<AALI-C-App>> setAalProfileQueueConfig
aal -> App : <<AALI-C-App>> Response Success
App -> aal : <<AALI-C-App>> startAalProfileQueue
aal -> App : <<AALI-C-App>> Response Success
Note over aal, App
Delete AAL Profile Instance
end NOTE
App -> aal : <<AALI-C-App>> stopAalProfileQueue
aal -> App : <<AALI-C-App>> Response Success
App -> aal : <<AALI-C-App>> stopAalProfileInstance
aal -> App : <<AALI-C-App>> Response Success
App -> aal : <<AALI-C-App>> deleteAalProfileInstance
aal -> App : <<AALI-C-App>> Response Success
== End Use Case ==
@enduml
4.3 AALI-C-Mgmt API details
Note: The AALI-C-Mgmt interface defines the administrative operations/actions/events between the O-Cloud IMS and the HW Accelerator Manager.
4.3.1 Capabilities discovery and configuration
4.3.1.1 getAalHwAccelStatus
Description: The HW Accelerator Manager enables querying the status of the HW accelerator and the AAL-LPUs (per AAL-LPU or all AAL-LPUs).
Pre-conditions: HW Accelerator Device is initialized, and HW Accelerator Manager is operational.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
4.3.1.2 getAalLpuStatus
Description: The HW Acclerator Manager enables querying the status the AAL-LPUs (per AAL-LPU).
Pre-conditions: HW Accelerator Device is initialized, and HW Accelerator Manager is operational.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
4.3.1.3   getAalAccelInfo
Description: This is used to query information about the HW Accelerator and capabilities of the AAL-LPU.
Pre-conditions: HW Accelerator Device is initialized, and HW Accelerator Manager is operational. IMS is operational.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
Note: While this list provides the details of parameters between IMS and HW Accelerator Manager, further analysis is needed to understand what is needed by the SMO.
4.3.1.4   setAalAccelConfig
Description: This is used to configure the HW Accelerator and AAL-LPU.
Pre-conditions: HW Accelerator Device is initialized, and HW Accelerator Manager is operational.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
Note: While this list provides the details of parameters between IMS and HW Accelerator Manager, further analysis is needed to understand what is needed by the SMO.
4.3.1.5 startAalLpu
Description: This operation will start an AAL-LPU that is in the stopped state. The AAL-LPU is instantiated using the SW/FW image(s) and configuration that were provided in the setAalAccelConfig procedure.
The AAL-LPU state machine is moved to a started / running state. When the AAL-LPU is in the started state it is ready to be used by the application.
After successfully starting AAL-LPU using this procedure, the AAL-LPU can be stopped.
Pre-conditions: HW Accelerator Device is initialized and HW Accelerator Manager is operational. The AAL-LPU has been successfully configured and is in the stopped state.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
4.3.1.6 stopAalLpu
Description: Moves AAL-LPU state machine to a stopped state.
AAL-LPU service is stopped. Configuration changes on the AAL-LPU can be performed. Re-configuration of the AAL-LPU compute / memory resource partitioning can be performed. Drivers can be updated / re-installed and configured. Maintenance / debugging operations can be performed.
After successfully stopping the AAL-LPU, the AAL-LPU can be (re-)configured, started or deleted.
Pre-conditions: HW Accelerator Device is initialized, and HW Accelerator Manager is operational. The number of AAL-LPUs has been set on the HW Accelerator. The AAL-LPU has been successfully configured and is started. Applications have previously been migrated off the AAL-LPU.
Triggers: On demand request via AALI-C-Mgmt interface
Frequency: N/A
AALI-C-APP
5.1 AALI-C-App Identification & Representation
Within a process address space each AAL-LPU can be abstracted using a generalized object handle.
Depending on the HW design and implementation choice, an AAL-LPU implementation may want to accelerate multiple AAL profiles, offer support for sharing HW Accelerator resources between multiple threads and/or partition AAL-LPU resources between multiple cells. For this reason, Logical Managed Resources, AAL-Profile-Instance and AAL Queue can optionally be used by the network function to
distinguish between multiple supported AAL profiles per AAL-LPU
prioritize access to AAL-LPU resources
group operation requests
partition AAL-LPU resources
allow parallel access through the AAL application interface for multiple threads / cores
As Logical Managed Resources, an AAL Queue does not reflect a HW design specification or requirement but an AAL interface specification.
The AALI-C-App initialization and configuration are done on a per AAL-LPU basis. That is, for each AAL-LPU that is assigned to the NF, the NF shall initialize and configure each AAL-Profile-Instance and AAL-Queue.
5.2 AALI-C-App operations and events
The below table lists the operations and events as part of the AALI-C-App interface.
Editor’s note: Use of AAL-Queue operations for user plane data transfer and buffer API operations needs to be clarified.
5.3 AALI-C-App Operations and Events Sequence and State Diagram
5.3.1 AALI-C-App State
The below state diagram shows the high-level state and state transitions for all AALI-C-App Operations and Events
@startuml @startuml
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
hide empty description
[*] --> AAL : Initialize
state AAL {
[*] --> AALStopped
AALStopped --> AALStarted : startAalLpu
AALStarted --> AALStopped : stopAalLpu
AALStopped --> AALStopped : getAalLpuConfig
AALStarted --> AALProfileInstance
}
state AALProfileInstance {
[*] --> Stopped : createAalProfileInstance (s)
Stopped --> Started : startAalProfileInstance
Started --> Stopped : stopAalProfileInstance
Stopped --> Stopped : setAalProfileInstanceConfig
Started --> Started : getAalProfileInstanceConfig
Stopped --> [*] : deleteAalProfileInstance
Started --> AALQueue
}
state AALQueue {
[*] --> QueueStopped
QueueStopped --> QueueStarted : startAalQueue
QueueStarted --> QueueStopped : StopAalQueue
QueueStopped --> QueueStopped : setAalQueueConfig
QueueStarted --> QueueStarted : getAalQueueConfig\nPerform Operations
}
@enduml
5.3.2 AALI-C-App API Init Sequence
The below sequence diagram shows the high-level initialization and configuration procedure for the AALI-C-App.
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << OAAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
note over ODU, AAL
Assumed the O-DU is already instantiated on the O-Cloud
With desired HW accelerator resources assigned from O2 and
Configuration through O1 interface is complete
endnote
==Inventory Services==
ODU -> AAL : Initialize
AAL --> ODU : Initialization Response
ODU -> AAL : getAalLpuInfo
AAL --> ODU : Response getAalLpuInfo
==Configuration & Operation Services==
loop for each AAL-LPU
loop for each AAL-Profile-Instance
ODU -> AAL : createAalProfileInstance
AAL --> ODU : AAL-Profile-Instance handle / identifier
ODU -> AAL : setAalProfileInstanceConfig
AAL --> ODU : return
ODU -> AAL : startAalProfileInstance
AAL --> ODU : return
loop for each AAL-Queue
ODU -> AAL : setAalQueueConfig
AAL --> ODU : return
ODU -> AAL : startAalQueue
AAL --> ODU : return
end loop
end loop
end loop
@enduml
5.3.3 AALI-C-Transport API Sequence
The AALI-C-App Transport API sequence is divided into two sets of call flows in the following subsections:
Sec. 5.3.3.1 focusses on call flows related to allocation of buffers(s) to be used with other AALI-C-App Transport APIs.
Sec. 5.3.3.2 and its subsections focus on call flows detailing the various procedures for sending and receiving buffer(s) using AALI-C-App Transport API.
5.3.3.1	Allocation of AAL Buffer(s)
The AALI-C-App Transport API supports allocation of buffers from either pre-created buffer pool(s) or from memory not mapped to pre-created buffer pool(s). Send buffer(s) are allocated by the Application, while Receive buffer(s) are allocated either by the Application or by the AAL implementation.
.
Note 2: The terms "AAL" and "AAL implementation" are used interchangeably in the tables below.
5.3.3.1	Sequence Diagram
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
AALI-C-App Sequence assumptions (Sec. 5.3.2)
End ref
==Inventory Services==
ref over ODU, AAL
AALI-C-App API Sequence call flow related to Inventory Service (Sec. 5.3.2)
End ref
==Creating Buffer Pools and Allocating Buffers ==
opt if buffer pool creation
ODU -> AAL : createBufferPool
activate AAL
AAL --> ODU : return buffer pool handle(s)
Deactivate AAL
End opt
Note over ODU, AAL
Allocate a buffer using pre-created buffer pool with buffer_pool_handle
or allocate dynamically with NULL buffer_pool_handle parameter
Endnote
ODU -> AAL : allocBuffer
activate AAL
AAL --> ODU : return buffer handle
deactivate AAL
autoactivate on
opt Get buffer address and buffer size using buffer handle if needed
ODU -> AAL : getBufferAddr
AAL --> ODU: return buffer address
ODU -> AAL: getBufferSize
AAL --> ODU: return buffer size
End opt
ref over ODU, AAL
AALI-C-App API Sequence call flow related to AAL-LPU, AAL-Profile-Instance
and AAL-Queue initialization & configuration (Sec. 5.3.2)
end ref
==Run Time Operations ==
ref over ODU, AAL
AALI-C-App API Sequence call flow related to Sending/Receiving Buffer(s) (Sec. 5.3.3.2)
End ref
==Free Buffer, Destroy Buffer Pool Operations ==
ODU -> AAL : freeBuffer
AAL --> ODU : success/failure
opt if buffer pool was created by the Application
ODU -> AAL : destroyBufferPool
AAL --> ODU : success/failure
End opt
deactivate ODU
@enduml
5.3.3.2 Procedure for Buffer(s) Send and Receive
The AALI-C-App Transport API supports the following high level use cases
Send Buffer Synchronous Mode with buffer free
Send Buffer Synchronous Mode without buffer free
Send Buffer Asynchronous Mode with buffer free
Send Buffer Asynchronous Mode without buffer free
Receive Buffer Synchronous Mode with non-NULL buffer_handles(s) input
Receive Buffer Synchronous Mode with NULL buffer_handles(s) input
Receive Buffer Asynchronous Mode with non-NULL buffer_handle(s) input
Receive Buffer Asynchronous Mode with NULL buffer_handle(s) input
In the use cases above, 'with buffer free' and 'without buffer free' imply that the input parameter 'buffer_free' = 'TRUE' (or 1) and 'FALSE' (or 0) respectively in sendBuffer operation (Sec. 5.4.3.5).
These use cases are detailed in the sections below.
5.3.3.2.1	Send Buffer Synchronous Mode with buffer free
Send Buffer Synchronous Mode with buffer free
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Synchronous Send Buffer (with buffer free) ==
ODU -> AAL : sendBuffer
Deactivate ODU
note over AAL
Perform operations and send all buffers.
Return when all buffers are sent.
endnote
AAL -> AAL : free buffer
AAL --> ODU : return status
Activate ODU
deactivate ODU
@enduml
5.3.3.2.2	Send Buffer Synchronous Mode without buffer free
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Synchronous Send Buffer (without buffer free) ==
ODU -> AAL : sendBuffer
deactivate ODU
note over AAL
Perform operations and send all buffers.
Return when all buffers are sent.
Endnote
AAL --> ODU : return status
activate ODU
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
deactivate ODU
@enduml
5.3.3.2.3	Send Buffer Asynchronous Mode with buffer free
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Asynchronous Send Buffer (with buffer free) ==
ODU -> AAL : sendBuffer
Activate AAL
note over AAL
Return immediately.
endnote
AAL --> ODU : return status of API
Note over AAL
Continue to process operations asynchronously
until all buffers sent.
endnote
AAL -> AAL: free Buffer
opt if a callback is preregistered
AAL -> ODU: execute preregistered callback function
End opt
deactivate AAL
deactivate ODU
@enduml
5.3.3.2.4	Send Buffer Asynchronous Mode without buffer free
Note [1] : The Application should not modify the content of the buffer(s) after step 2.
Note [2] : The Application can modify the content of the buffer(s) after step 5.
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Asynchronous Send Buffer (without buffer free) ==
ODU -> AAL : sendBuffer
activate AAL
note over AAL
return immediately.
endnote
AAL --> ODU : return status of API
Note over AAL
Continue to process operations asynchronously
until all buffers sent.
endnote
alt without callback
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
Note over AAL
Internally buffer is freed when sendBuffer completes.
endnote
else with preregistered callback
AAL --> ODU: execute preregistered callback function
deactivate AAL
ODU -> AAL: freeBuffer
activate AAL
AAL --> ODU : success/failure
deactivate AAL
end
deactivate ODU
@enduml
5.3.3.2.5	Receive Buffer Synchronous Mode with non-NULL buffer_handle(s) input
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Synchronous Receive Buffer==
ODU -> AAL : receiveBuffer
deactivate ODU
note over AAL
Perform operations and receive all buffers.
Return when all buffers are sent.
Endnote
AAL --> ODU : return status
activate ODU
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
deactivate ODU
@enduml
5.3.3.2.6	Receive Buffer Synchronous Mode with NULL buffer_handle(s) input
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App >>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Synchronous Receive Buffer==
ODU -> AAL : receiveBuffer
deactivate ODU
AAL -> AAL : allocate buffer
note over AAL
Perform operations and receive all buffers.
Return when all buffers are sent.
endnote
AAL --> ODU : return status
deactivate AAL
activate ODU
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
deactivate ODU
@enduml
5.3.3.2.7 Receive Buffer Asynchronous Mode with non-NULL buffer_handle(s) input
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App >>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Asynchronous Receive Buffer==
alt without callback
ODU -> AAL : receiveBuffer
deactivate ODU
note over AAL
If no buffers received return immediately.
In Asynchronous mode with no callback receive
API behaves in a poll manner.
endnote
AAL --> ODU : (number of buffers = 0)
activate ODU
ODU -> AAL : receiveBuffer
deactivate ODU
AAL --> ODU : success (number of buffers)
activate ODU
else with preregistered callback
ODU -> AAL : receiveBuffer
Activate AAL
AAL --> ODU : return status
AAL -> AAL : wait for receive buffers
note over AAL
AAL executes receive operation.
endnote
AAL --> ODU: execute preregistered callback function
deactivate AAL
end
activate ODU
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
deactivate ODU
@enduml
5.3.3.2.8	Receive Buffer Asynchronous Mode with NULL buffer_handle input
@startuml
Autonumber
Skinparam sequenceArrowThickness 2
skinparam ParticipantPadding 5
skinparam BoxPadding 10
autoactivate on
Box “O-RAN” #NavajoWhite
Participant “O-DU” as ODU << AAL-App>>
end box
Box “Cloud Platform” #lightseagreen
participant “AAL” as AAL
End box
activate ODU
ref over ODU, AAL
Section 5.3.3.1 Creating Buffer Pools and Allocating Buffers
end ref
==Asynchronous Receive Buffer==
alt without callback
ODU -> AAL : receiveBuffer
deactivate ODU
note over AAL
If no buffers received return immediately.
In Asynchronous mode with no callback receive
API behaves in a poll mode manner.
endnote
AAL --> ODU : (number of buffers = 0)
activate ODU
ODU -> AAL : receiveBuffer
deactivate ODU
AAL -> AAL : Allocate buffer(s)
AAL --> ODU : success (number of buffers)
activate ODU
else with preregistered callback
ODU -> AAL : receiveBuffer
AAL --> ODU : return status
AAL -> AAL : wait for receive buffers
AAL -> AAL : Allocate buffer(s)
note over AAL
AAL executes receive operation.
endnote
AAL --> ODU: execute preregistered callback function
deactivate AAL
deactivate AAL
end
activate ODU
ODU -> AAL: freeBuffer
AAL --> ODU : success/failure
deactivate ODU
@enduml
5.4 AALI-C-App API details
5.4.1 Capabilities discovery and configuration
5.4.1.1 getAalLpuInfo
Description: An application queries the handle and capabilities of the AAL-LPU(s) assigned to the application. AAL-LPUs may provide different capabilities such as different AAL Profiles can be supported by the AAL-LPUs that includes different types of AAL-Profile-Instances and AAL-Queue(s). The aal-lpu-handle is unique between the application and the AAL-LPUs assigned to the application. The aal-lpu-handle is generated by the AAL implementation.
Pre-conditions: Application has at least 1 AAL-LPU assigned and available for use.
Triggers: On demand request from the Application
Frequency: Application Initialization time.
Note: List of AAL Profile types to be defined, e.g. High-PHY. Types should also be versioned, e.g. High-PHY.V1
5.4.2 AALI-C-App Configuration Services
Before using AAL-Profile-Instance services the application must first create the AAL-Profile-Instance, then configure the AAL-Profile-Instance and the AAL-Queue(s).
5.4.2.1 createAalProfileInstance
Description: The application creates an AAL-Profile-Instance on the AAL-LPU. The AAL-Profile-Instance is created based on the AAL Profile type that is requested by the application. The list of available AAL Profile type(s) is provided by the AALI in the getAalLpuInfo response. After successful creation, the AAL-Profile-Instance is in a ‘in use, stopped’ state. The application may now configure the AAL-Profile-Instance, AAL-Queue(s) and start the AAL-Profile-Instance.
This procedure may be repeated by the application in order to create multiple AAL-Profile-Instances, of the same or different AAL Profile types.
Pre-conditions: Application has at least 1 AAL-LPU assigned and available for use. The AAL Profile type that is requested to be created is provided by the AAL-LPU (listed in the AAL-LPU-Capability struct of the getAalLpuInfo response operation).
Triggers: On demand request from the Application
Frequency: Infrequent.
5.4.2.2 setAalProfileInstanceConfig
Description: The application configures the AAL-Profile-Instance on the AAL-LPU for a specific AAL Profile configuration for use by the application.
Pre-conditions: Application has successfully created the AAL-LPU-Profile instance on the AAL-LPU. The AAL-Profile-Instance is not started.
Triggers: On demand request from the Application
Frequency: Infrequent.
5.4.2.3 deleteAalProfileInstance
Description: The application may delete the AAL-Profile-Instance when it no longer requires it. For example, if a cell is deleted from the O-DU by upper layers or the OAM system, the AAL-Profile-Instance resources used to offload that cell can be deleted. After deleting the AAL-Profile-Instance, that AAL-Profile-Instance is no longer usable by the application.
Pre-conditions: The Application has successfully stopped the AAL-Profile-Instance.
Triggers: On demand request from the Application
Frequency: Infrequent.
5.4.2.4 setAalProfileQueueConfig
Note: Use of AAL-Queue operations for user plane data transfer and buffer API operations needs to be clarified.
Description: The application configures the AAL-Queue on the AAL-Profile-Instance.
If no AAL-Queue Handle is included, this operation will create and configure a new AAL-Queue. The response will include the AAL-Queue Handle for the AAL-Queue. To add an AAL-Queue to an AAL-Profile-Instance, the AAL-Profile-Instance must be stopped by the application.
If an AAL-Queue Handle is supplied, the configuration of the AAL-Queue identified by the AAL-Queue Handle is modified with the supplied configuration. Any items already on the queue are deleted when this operation is called. The AAL-Queue must be in the stopped state.
Pre-conditions: AAL-Profile-Instance has already successfully been created in the AAL-LPU. The application has successfully configured the AAL-Profile-Instance. The AAL-Queue (if already existing) is in the stopped state. To add an AAL-Queue to an AAL-Profile-Instance, the AAL-Profile-Instance must be stopped by the application. To re-configure an existing AAL-Queue on an AAL-Profile-Instance, the AAL-Profile-Instance does not need to be stopped by the application.
Triggers: On demand request from the Application
Frequency: Infrequent.
5.4.2.5 getAalProfileQueueConfig
Description: The application may query the current AAL-Profile-Instance queue configuration.
Pre-conditions: AAL-Profile-Instance has already successfully been created in the AAL-LPU. The application has successfully created the AAL-Profile-Instance and the AAL-Queue.
Triggers: On demand request from the Application
Frequency: N/A
5.4.3 AALI-C-App Transport Operations
5.4.3.1 createBufferPool
Description: The createBufferPool operation shall support creation of N buffer pools (N>=1) of a specific buffer type, with buffer read/write access to the Application.
The Application shall have the flexibility to invoke the createBufferPool operation either one time, or multiple times, to request creation of buffer pool(s) with multiple buffer sizes.
The Application shall invoke the createBufferPool operation multiple times for creation of buffer pools of different buffer types.
The Application shall not assume buffers in created buffer pools to be in a specific memory state (e.g., zero ’ed buffer).
Buffer pool(s) and buffers are sharable by AAL-LPU(s).
FFS: support for inter-accelerator buffer pool sharing.
Pre-conditions: AAL implementation is initialized
Triggers: On demand request from the Application
Frequency:  No restriction
5.4.3.2 allocBuffer
Description: The allocBuffer operation shall support allocation of a buffer either from pre-created buffer pool(s), or from memory that is not associated with a pre-created buffer pool.
Pre-conditions:  If a non-NULL buffer_pool_handle is passed, the buffers are allocated from the buffer pool(s) created using the createBufferPool operation.
Triggers: On demand request from the Application
Frequency: No restriction
5.4.3.3  getBufferAddr
Description: The getBufferAddr operation shall return address from buffer_handle
Pre-conditions:  The buffer_handle is created using allocBuffer operation
Triggers: On demand request from the Application
Frequency: No restriction
5.4.3.4  getBufferSize
Description: The getBufferSize operation shall return the size of the buffer from buffer_handle
Pre-conditions: buffer_handle is created using allocBuffer operation
Triggers: On demand request from the Application
Frequency: No restriction
5.4.3.5  sendBuffer
Description: The sendBuffer operation shall support enqueuing of N buffer(s) (N >=1) by the Application.  The Application shall either retain buffer ownership in sendBuffer operation or indicate buffer ownership transfer. Application shall indicate the synchronization mode ('synchronous' or 'asynchronous') in sendBuffer operation.
AAL implementation shall support both modes of operation.
For synchronous mode, the AAL implementation, upon execution completion of sendBuffer operation, shall return the status of the sendBuffer operation
For asynchronous mode, AAL implementation shall return the status of sendBuffer operation execution, only if Application preregisters for a callback; otherwise AAL implementation is not expected to return the execution status of the sendBuffer operation
FFS: Mechanism of sending details of AAL-Profile specific parameters
Pre-conditions: Buffers are allocated through allocBuffer operation. At least one AAL-Profile-Instance is configured and started. At least one AAL-Queue is configured and started
Triggers: On demand request from the Application
Frequency: No restriction
5.4.3.6   receiveBuffer
Description: The receiveBuffer operation shall support dequeuing up to N buffer(s) (N >=1) by the Application. The Application shall indicate the synchronization mode ('synchronous' or 'asynchronous') in the receiveBuffer operation.
AAL implementation shall support both modes of the operation.
For synchronous mode, the AAL implementation, upon execution completion of receiveBuffer operation, shall return the status of the receiveBuffer operation
For asynchronous mode, the AAL implementation shall return the status of receiveBuffer operation execution, only if Application preregisters for a callback; otherwise AAL implementation is not expected to return the execution status of the receiveBuffer operation
Either the Application, or the AAL implementation shall allocate the receiving buffer(s) either from buffer pool(s) pre-created through createBufferPool operation or from memory not mapped to a pre-created buffer pool.
Pre-conditions: At least one AAL-Profile-Instance is configured and started. At least one AAL-Queue is configured and started
Triggers: On demand request from the Application
Frequency: No restriction
5.4.3.7   freeBuffer
Description: The freeBuffer operation shall free the buffer back to the buffer pool to which the buffer was allocated from.
If the buffer is not freed in the sendBuffer operation (i.e., buffer_free parameter is set to 0 or 'FALSE'), the freeBuffer operation shall free the buffer upon completion of the sendBuffer operation execution by the AAL implementation.
Pre-conditions:  The buffer_handle is created using allocBuffer operation
Post-condition: Upon successful completion of the freeBuffer operation, the buffer_handle is no longer usable by the Application
Triggers: On demand request from the Application
Frequency:  No restriction
5.4.3.8   destroyBufferPool
Description: The destroyBufferPool operation shall support termination of buffer pool, which will make buffer_handle(s) associated with the buffer pool unusable by the Application.
Pre-condition:  The buffer_pool_handle is created using createBufferPool operation
Trigger: On demand request from the Application
Frequency: Infrequent
Revision History
History