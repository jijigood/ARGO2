ORAN-WG6.AAL-FEC.0-v03.00
Technical Specification
O-RAN Working Group 6
(Cloudification and Orchestration W
Acceleration Abstraction Layer
FEC Profiles
Copyright © 2022 by the O-RAN ALLIANCE e.V.
The copying or incorporation into any other work of part or all of the material available in this specification in any form without the prior written permission of O-RAN ALLIANCE e.V.  is prohibited, save that you may print or download extracts of the material of this specification for your personal use, or copy the material of this specification for the purpose of sending to individual third parties for their information provided that you acknowledge O-RAN ALLIANCE as the source of the material and that you inform the third party that these conditions apply to them and that they must comply with them.
O-RAN ALLIANCE e.V., Buschkauler Weg 27, 53347 Alfter, Germany
Register of Associations, Bonn VR 11238, VAT ID DE321720189
Introductory Material
Scope
This Technical Specification has been produced by the O-RAN Alliance.
The contents of the present document are subject to continuing work within O-RAN and may change following formal O-RAN approval. Should the O-RAN Alliance modify the contents of the present document, it will be re-released by O-RAN with an identifying change of release date and an increase in version number as follows:
Release x.y.z
where:
x	the first digit is incremented for all changes of substance, i.e. technical enhancements, corrections, updates, etc. (the initial approved document will have x=01).
y	the second digit is incremented when editorial only changes have been incorporated in the document.
z	the third digit included only in working versions of the document indicating incremental changes during the editing process.
The present document focuses on the Acceleration Abstraction Layer for the AAL_PDSCH_FEC and AAL_PUSCH_FEC Profiles as defined in [7], including the AALI and the management and orchestration requirements of AAL-LPUs providing HW Accelation for the fore mentioned AAL profiles.
References
The following documents contain provisions which, through reference in this text, constitute provisions of the present document. 3GPP references refer to 3GPP release 16.
3GPP TR 21.905: “Vocabulary for 3GPP Specifications”.
Cloud Architecture and Deployment Scenarios for O-RAN Virtualized RAN, 2019.
WG6 2020 Use Case for BBU Pooling, 2019.
3GPP TS 38.211: "NR; Physical channels and modulation".
3GPP TS 38.212: "NR; Multiplexing and channel coding".
3GPP TR 38.300: "NR; NR and NG-RAN Overall Description".
O-RAN WG6 Acceleration Abstraction Layer General Aspects and Principles
O-RAN Software Community https://wiki.o-ran-sc.org/display/ORAN
OSC AAL Specifications o-ran-sc/o-du/phy/aal
DPDK coding style https://doc.dpdk.org/guides/contributing/coding_style.html
Definitions and Abbreviations
Definitions
For the purposes of the present document, the terms and definitions given in [7] apply.
Abbreviations
For the purposes of the present document, the following abbreviations apply.
AAL	Acceleration Abstraction Layer
AALi	Acceleration Abstraction Layer interface
AAL-LPU 	Accelleration Abstraction Layer Logical Processing Unit
CB		Code Block
CNF	Containerized Network Function
NF	Network Function
O-CU	O-RAN Centralized Unit
O-DU	O-RAN Distributed Unit
O-RU	O-RAN Radio Unit
OS	Operating System
OSC	O-RAN Software Community
TB	Transport Block
Overview
Purpose
The AAL General Aspects and Principles is described in [7] including a high level architecture of the AAL and definition of the AAL profiles. This document details the AAL specification consisting of the description of the interface, information models and requirements to implement an AALi, for the AAL_PUSCH_FEC and AAL_PDSCH_FEC Profiles, shown below in Figure 2.1 and Figure 2.2.
Figure 2.1 AAL_PDSCH_FEC Profile
Figure 2.2 AAL_PUSCH_FEC Profile
Document Structure
This present document is structured as follows: chapter 2 presents the overview and main purpose of this specification. Chapter 3 presents the AAL Hardware Acceleration Management specification for the AAL_PUSCH_FEC and AAL_PDSCH_FEC Profiles. Chapter 4 presents the common AALi requirements for an AAL-LPU supporting one or more AAL_PUSCH_FEC and/or AAL_PDSCH_FEC Profiles. Chapter 5 presents the profile specific interface requirements for the AAL_PUSCH_FEC and AAL_PDSCH_FEC Profiles.
AALi Configuraton and Management
The chapter defines the common configuration and management aspects of the AALi as they relate to the AAL_PUSCH_FEC and AAL_PDSCH_FEC profiles. The AALi configuration and management API’s are the API’s that an application (O-DU) executes to configure and manage the AAL-LPU(s) that have been allocated to the application by the O-Cloud. The high-level Configuration and Management Principles are presented in [7].
The below section describes the requirements of the AALi presented to the Application.
AAL Configuration and Management
Initalization and Configuration
As per sequence diagram in Chapter 4.1.1.3 in [7] the below list defines the high-level configuration and management interfaces
Get Number of AAL LPU’s
Get AAL LPU Fine Grain capabilities
Setup and Allocate AAL LPU Queues
Configure AAL LPU Queues
Get Number of AAL LPU’s
The AALi shall provide an interface to retrieve a count of the number of AAL-LPU’s available to be used by the application.
Get AAL-LPU Fine Grained Capabilities
The AALi shall provide an interface to retrieve the fine-grained capabilities of an AAL-LPU. The capabilities that shall be reported by the AALi are defined in Table 4-1.
Table 4-1 AAL-LPU Capabilities
Setup and Allocate AAL LPU Queues
The AALi shall provide an interface to setup and allocate AAL-LPU Queues.
Configure AAL-LPU Queues
The AALi shall provide an interface to configure the AAL-LPU’s queues setup from section 4.1.3. The AAL-LPU Queue configuration shall support the configuration options as defined in Table 4-2.
Table 4-2 AAL-LPU Queue Configuration Options
AAL-LPU Management and AAL-LPU Queue management
As per sequence diagram in Chapter 4.1.1.4 in [7] the below list defines the high-level AAL-LPU and AAL-LPU Queue management interfaces required to be supported by an AALi implementation
Start AAL-LPU
AAL-LPU Queue Start
AAL-LPU Queue Stop
AAL-LPU Stop
Close AAL-LPU
AAL Statistics
The AALi shall provide an interface to retrieve statistics from an AAL-LPU Device and/or AAL-LPU Queue. The statistics may include error counts. In addition, the AALi shall provide an interface to reset statistic counters in the AAL-LPU.
AAL Profile Specifications
Profile Specifications Overview
This section contains information for each AAL profile that is supported. A profile can provide several APIs for specific profile configuration that may be required in addition to the general AAL configuration APIs. Profile specific configuration shall be done on a per queue basis and only for functionality that cannot be changed at run time. Each profile shall define a capabilities list that will be used to define the operations supported by the AAL-LPU.
Operation Representation
Operations offloaded to the AAL-LPU are represented by a single operation context that shall include all necessary information required for the AAL operation to be processed on a particular AAL-LPU.
The operation context by itself defines the operation type as supported by the AAL Profile. It includes an operation status, a reference to the operation specific data, which can vary in size and content depending on the operation/profile being provisioned. Application software is responsible for specifying all the operation specific fields in the which are then used by the AAL-LPU to process the requested operation.
Scheduling of AAL operations on application data path is performed using a burst oriented asynchronous API set. A queue on an AAL-LPU accepts a burst of operations (1 to N) using enqueue API. The enqueue API will place the operations to be processed on the AAL-LPU’s hardware input. The dequeue API will retrieve any processed operations available from the queue on the AAL-LPU.
The enqueue API uses an AAL-LPU identifier and a queue identifier to specify the AAL-LPU queue to schedule the processing on. In addition to the operation context a count of the number of operations to process is also required. The enqueue function returns the number of operations it actually enqueued for processing.
The dequeue API uses the same format as the enqueue API but the operation contexts are now used to specify the max processed operations the user wishes to retrieve and the location in which to store them. The API call returns the actual number of processed operations returned.
Profile Capabaillities
Each Profile has a set of capabilities which capture the functions supported by each implementation. This included optional features such a interrupts and debug interfaces. These are used by the application to discover the capabillites of the underlying AAL implementation as per Section 4.2.2.
Memory Management
The AALi implementation shall provide any profile specific memory management (examples allocate and free memory) as required by the AALi implementation.
O-DU AAL PDSCH FEC Profile Specification
As per O-RAN AAL GAnP document [7] the PDSCH FEC Profile supports
CRC Generation
LDPC Encoding
PDSCH Rate Matching
The encode operations are invoked through enqueue and dequeue functions. The operation context defines the parameters used to configure the operation to be accelerated.
AAL FEC PDSCH Profile Capabilities
The AAL FEC PDSCH Profile interface shall work on both a code block (CB) and a transport block (TB) basis.
An operation can be performed on one CB at a time "CB-mode". An operation can be performed on one or multiple CBs that logically belong to a TB "TB-mode".  The input data is the CB or TB input to the encoder. The output data is the ratematched CB or TB data.
The input and output buffers are expected to be allocated by the application with enough room for the output data.
The input buffer is mandatory input and is the incoming code block or transport block data.
The output buffer is mandatory and is the encoded CB(s). In CB-mode it contains the encoded CB of size e (E in 3GPP TS 38.212 section 6.2.5). In TB-mode it contains multiple contiguous encoded CBs of size ea or eb. The output buffer is allocated by the application with enough room for the output data.
The valid modes of operation are:
CB-mode: one CB (attach CRC24B if required)
CB-mode: one CB making up one TB (attach CRC16 or CRC24A if required)
TB-mode: one or more CB of a partial TB (attach CRC24B(s) if required)
TB-mode: one or more CB of a complete TB (attach CRC16, CRC24A and CRC24B(s) if required)
As there are many combinations the AAL_PDSCH_FEC Profile shall list the CRC’s supported in its capabilities. The AALi implementation of the AAL_PDSCH_FEC Profile shall provide the flexibility to the application to configure the operation in CB-mode with application selected CRC type and TB-mode with application selected CRC type.
As an examble in CB-mode if application can select whether CRC24A is appended to the CB or not. If configured not to append CRC24A then the application is responsible for calculating and appending CRC24A before calling AALi. The input data length is inclusive of CRC24A/B where present and is equal to the code block size K’. Note that code block length will always be a multiple of 8 and it is assumed that there are 8 bits packed into each byte.
As an example, in TB-mode, CRC24A or CRC16 is assumed to be pre-calculated and appended to the inbound TB data buffer, unless the application selects CRC24A is to be appended when it is the responsibility of AALi implementation. The input data length is total size of the CBs inclusive of any CRC24A and CRC24B in the case they were appended by the application.
The difference between the partial and full-size TB is that AAL AAL-LPU needs the index of the first CB in this group and the number of CBs in the group. The first CB index is given by r but the number of the CBs is calculated by AALi implementation before signalling to the driver.
The number of CBs in the group should not be confused with c, the total number of CBs in the full TB (C as per 3GPP TS 38.212 section 5.2.2).
When using CB-mode code block concatenation is not performed in HW and it is the responsibility of the application to ensure code block concatenation is implemented correctly. Note that code block concatenation can be implemented by virtue of input and output address buffer address management.
The AAL_PDSCH_FEC Profile capabilities shall be reported to the application as per Table 4-1 AAL-LPU Capabilities. The AAL_PDSCH_FEC Profile capabilities are defined in Table 5-1 AAL_PDSCH_FEC Profile Capabilities, these capabilities must be reported to the application but may not be implemented by the AALi implementation.
Summary of AAL_PDSCH_FEC Profile capabilities
Table 5-1 lists the AAL_PDSCH_FEC profile capabilities that should be reported to the application.
Note additional capabilities can also be reported by the AALi implementation.
Table 5-1 AAL_PDSCH_FEC Profile Capabilities
AAL PDSCH FEC Profile Operations
The following parameters are required to be supported by the AALi implementation when offloading operations.
Table 5-2 AAL_PDSCH_FEC Profile parameters
CB-Mode Parameters
The below table defines the additional parameters required to be supported by the AALi implementation when using code block mode
Table 5-3 CB-mode parameters
TB-Mode Parameters
Table 5-4 TB-mode parameters
O-DU AAL PUSCH FEC Profile Specification
This section defines the AAL PUSCH FEC Profile specification. As per O-RAN AAL GAnP document [7] the AAL_PUSCH_FEC Profile supports the following functions
PUSCH Rate De-matching
LDPC Decoder
CRC Check
Note the AAL_PUSCH_FEC Profile only supports PUSCH Forward Error Correction. It does not include support for PUSCH UCI which can be done in Software.
AAL FEC PUSCH Profile Capabilities
The decode operations are invoked through enqueue and dequeue functions. The operation context defines the parameters used to configure the operation to be accelerated.
The output data buffer is expected to be allocated by the application with enough room for the output data.
The input encoded CB data is mandatory for all AAL PUSCH FEC AAL-LPUs and is the Virtual Circular Buffer data stream with null padding. Each byte in the input circular buffer is the LLR value of each bit of the original CB.
The output hard_output is mandatory and is the decoded CBs of size K’ (CRC24A/B or CRC16 is the last 24bit or 16bits in each decoded CB. The AALi shall give the option to drop the CRC. Where CRC Drop is set then the CRC will not be present at the end of the buffer). In transport block mode the hard_output will contain the decoded transport block.
The AALi shall support the optional soft output buffer which is an LLR rate matched output of size e (this is E as per 3GPP TS 38.212 section 6.2.5).
The AALi shall support optional harq input buffer which is a buffer with the input to the HARQ combination function of the AAL-LPU. If the AAL-LPU supports internal memory capability and is enabled, then the HARQ is stored in memory internal to the AAL-LPU and not visible to the application.
The AALi shall support the optional HARQ Combined output which is a buffer for the output of the HARQ combination function of the AAL-LPU. If the AAL-LPU supports internal memory capability and is enabled, then the  HARQ is stored in memory internal to the AAL-LPU and not visible to application.
The buffers are expected to be allocated by the application with enough room for the output data.
As with the AAL PDSCH FEC Profile, the decode interface works on both a code block (CB) and a transport block (TB) basis.
The valid modes of operation are:
CB-mode: one CB (check CRC24B if required)
CB-mode: one CB making up one TB (check CRC16 or CRC24A if required)
TB-mode: one or more CB making up a partial TB (check CRC24B(s) if required)
TB-mode: one or more CB making up a complete TB (check CRC16, CRC24A and CRC24B(s) if required)
The buffer length is inclusive of CRC24A/B where present and is equal the code block size K’.
The first CB Virtual Circular Buffer (VCB) index is given by r but the number of the remaining CB VCBs shall be calculated automatically by the AALi implementation.
The number of remaining CB VCBs should not be confused with c, the total number of CBs in the full TB (C as per 3GPP TS 38.212 section 5.2.2)
The length is total size of the CBs inclusive of any CRC24A and CRC24B in case they were appended by the application.
LLR Compression
The AAL PUSCH FEC Profile may support compression of the LLR bits used for the HARQ data. This improves PCIE memory bandwidth and memory storage. The AALi shall report to the application through the capabilities whether LLR compression is supported. Example of compression is when 6bit LLR’s are stored per byte in memory. Compression allows the 6bit LLR’s to be packed in 6bits of memory.
Summary of AAL_PUSCH_FEC Profile capabilities
Table 5-5 lists the AAL_PUSCH_FEC profile capabilities that should be reported to the application.
Note additional capabilities can also be reported by the AALi implementation.
Table 5-5 AAL_PUSCH_FEC Profile capabilities
AAL PUSCH FEC Profile Operations
The following parameters are required to be supported by the AALi implementation when offloading operations
Table 5-7 AAL_PUSCH_FEC Profile Parameters
CB-Mode Parameters
When CB-Mode is used the following additional parameters are required.
Table 5-8 AAL_PUSCH_FEC Profile CB-Mode Parameters
TB-Mode Parameters
When TB-Mode is used the following additional parameters are required.
Table 5-9 AAL_PUSCH_FEC Profile TB-Mode Parameters
AAL Profile API Definitions
O-RAN and the O-RAN Software Community[3] has published a normative definition of the AAL FEC API’s. The AAL FEC API definitions are based on the WG6 AAL FEC profile requirements in [7] and this document. Refer to AAL Repository  [9] in the OSC for APIs decription details. This current version uses the git tag version oran_e_maintenance_release_v1.0
O-RAN AAL FEC API Terminology
The O-RAN AAL FEC API definition is based on DPDK, as such the naming convention and coding styles follow DPDK guidelines [10]. This section gives an overview of the DPDK terminology mapping to the profile specification [7].
Configuration and Management
The configuration and management interfaces are defined in rte_bbdev.h in the O-RAN AAL Speciffication repo [9]
FEC Profile Operations
The AAL profile operations are defined in rte_bbdev_op.h in the the O-RAN AAL Speciffication repo [9]. The mapping of profile definition to the API implementation for the AAL_PDSCH_FEC Profile parameters as defined previously in Table 5-2 is demonstrated below in